import{_ as uo}from"./ListItemPhone.vuevuetypescriptsetuptruelang-CYRT3CJ2.js";import{_ as co}from"./more-vert-BNcWbRGO.js";import{d as j,r as P,c as l,o as n,O as D,j as f,a0 as B,P as ie,M as k,I as Ce,B as v,x as p,ao as ct,al as mt,a as m,t as c,ac as pt,bE as mo,h as M,L as ae,R as ft,bF as le,k as i,aL as Ze,q as se,U as xe,J as ee,V as et,N as po,m as Fe,bg as fo,bG as vo,a1 as be,bH as go,u as _o,W as yo,e as ho,s as De,f as ko,ar as Io,aX as tt,bI as wo,bJ as Do,bK as $o,aS as bo,Y as Co,bL as Fo,aq as ot,i as nt,aA as To,w as Eo,Z as Vo,$ as So,v as Po,at as qo,au as Lo,bx as Bo,a2 as Uo,a4 as Ao,a8 as Mo,bM as Ro,a5 as x,bN as st,bO as zo,H,bP as Oo,bQ as No,bR as Ho,a7 as G,bS as it,D as Qo,bT as at,b0 as lt,bU as rt,ax as $e,bV as dt,bW as Ko,bX as Go,bY as Jo}from"./index-D87Nr3Nw.js";import{_ as vt,a as Wo}from"./upload-rounded-B_ESm6mv.js";import{_ as Xo}from"./FieldId.vuevuetypescriptsetuptruelang-DRoBQnQY.js";import{_ as gt}from"./VCheckbox-CrJS-AL3.js";import{_ as jo,u as Yo,c as Zo}from"./key-events-CGCvIZ4E.js";import{_ as xo}from"./content-paste-rounded-DPHkWsZO.js";import{_ as en}from"./DownloadMethodModal.vuevuetypescriptsetuptruelang-mQ3k85bt.js";const tn={class:"actions"},on={class:"card card-info"},nn={class:"key-value vertical"},sn={class:"key"},an={class:"value"},ln=j({__name:"FileActionButtons",props:{item:{},canPaste:{type:Boolean}},emits:["downloadDir","downloadFile","uploadFiles","uploadDir","deleteItem","duplicateItem","cutItem","copyItem","pasteItem","copyLink","renameItem","addToFavorites"],setup(C,{emit:_}){const a=_,$=P(!1),q=P(!1),F=P(!1);function g(s){a("downloadDir",s)}function U(s){a("downloadFile",s)}function A(s){a("uploadFiles",s)}function I(s){a("uploadDir",s)}function T(s){a("deleteItem",s)}function y(s){a("duplicateItem",s)}function E(s){a("cutItem",s)}function V(s){a("copyItem",s)}function z(s){a("pasteItem",s)}function e(s){a("copyLink",s)}function d(s){a("renameItem",s)}function L(s){a("addToFavorites",s)}return(s,r)=>{const O=ct,b=Ce,u=vt,Q=mt,te=pt,J=mo,W=co,R=ie("tooltip");return n(),l("div",tn,[s.item.isDir?(n(),l(B,{key:0},[D((n(),k(b,{class:"sm",onClick:r[0]||(r[0]=v(w=>g(s.item.path),["stop"]))},{default:p(()=>[f(O)]),_:1})),[[R,s.$t("download")]]),f(Q,{modelValue:$.value,"onUpdate:modelValue":r[3]||(r[3]=w=>$.value=w)},{trigger:p(()=>[D((n(),k(b,{class:"sm"},{default:p(()=>[f(u)]),_:1})),[[R,s.$t("upload")]])]),default:p(()=>[m("div",{class:"dropdown-item",onClick:r[1]||(r[1]=v(w=>{A(s.item.path),$.value=!1},["stop"]))},c(s.$t("upload_files")),1),m("div",{class:"dropdown-item",onClick:r[2]||(r[2]=v(w=>{I(s.item.path),$.value=!1},["stop"]))},c(s.$t("upload_folder")),1)]),_:1},8,["modelValue"])],64)):D((n(),k(b,{key:1,class:"sm",onClick:r[4]||(r[4]=v(w=>U(s.item.path),["stop"]))},{default:p(()=>[f(O)]),_:1})),[[R,s.$t("download")]]),D((n(),k(b,{class:"sm",onClick:r[5]||(r[5]=v(w=>T(s.item),["stop"]))},{default:p(()=>[f(te)]),_:1})),[[R,s.$t("delete")]]),f(Q,{modelValue:q.value,"onUpdate:modelValue":r[6]||(r[6]=w=>q.value=w)},{trigger:p(()=>[D((n(),k(b,{class:"sm"},{default:p(()=>[f(J)]),_:1})),[[R,s.$t("info")]])]),default:p(()=>[m("section",on,[m("div",nn,[m("div",sn,c(s.$t("path")),1),m("div",an,c(s.item.path),1)])])]),_:1},8,["modelValue"]),f(Q,{modelValue:F.value,"onUpdate:modelValue":r[14]||(r[14]=w=>F.value=w)},{trigger:p(()=>[D((n(),k(b,{class:"sm"},{default:p(()=>[f(W)]),_:1})),[[R,s.$t("actions")]])]),default:p(()=>[m("div",{class:"dropdown-item",onClick:r[7]||(r[7]=v(w=>{y(s.item),F.value=!1},["stop"]))},c(s.$t("duplicate")),1),m("div",{class:"dropdown-item",onClick:r[8]||(r[8]=v(w=>{E(s.item),F.value=!1},["stop"]))},c(s.$t("cut")),1),m("div",{class:"dropdown-item",onClick:r[9]||(r[9]=v(w=>{V(s.item),F.value=!1},["stop"]))},c(s.$t("copy")),1),s.item.isDir&&s.canPaste?(n(),l("div",{key:0,class:"dropdown-item",onClick:r[10]||(r[10]=v(w=>{z(s.item),F.value=!1},["stop"]))},c(s.$t("paste")),1)):M("",!0),s.item.isDir?M("",!0):(n(),l("div",{key:1,class:"dropdown-item",onClick:r[11]||(r[11]=v(w=>{e(s.item),F.value=!1},["stop"]))},c(s.$t("copy_link")),1)),s.item.isDir?(n(),l("div",{key:2,class:"dropdown-item",onClick:r[12]||(r[12]=v(w=>{L(s.item),F.value=!1},["stop"]))},c(s.$t("add_to_favorites")),1)):M("",!0),m("div",{class:"dropdown-item",onClick:r[13]||(r[13]=v(w=>{d(s.item),F.value=!1},["stop"]))},c(s.$t("rename")),1)]),_:1},8,["modelValue"])])}}}),rn=ae(ln,[["__scopeId","data-v-c4ee8d44"]]),dn={class:"start"},un={class:"number"},cn={key:0,src:"/ficons/folder.svg",class:"svg"},mn={key:0,class:"svg",src:le},pn=["src"],fn=["src"],vn={key:3,class:"svg",src:le},gn={class:"title"},_n={class:"subtitle"},yn={key:0},hn={key:1},kn={key:0,src:"/ficons/folder.svg",class:"svg"},In={key:0,class:"svg",src:le},wn=["src"],Dn=["src"],$n={key:3,class:"svg",src:le},bn={key:0},Cn={key:1},Fn=j({__name:"FileListItem",props:{item:{},index:{},selectedIds:{},shiftEffectingIds:{},shouldSelect:{type:Boolean},isPhone:{type:Boolean},imageErrorIds:{},extensionImageErrorIds:{},canPaste:{type:Boolean},handleItemClick:{type:Function},handleMouseOver:{type:Function},toggleSelect:{type:Function},onImageError:{type:Function},onExtensionImageError:{type:Function},viewItem:{type:Function},clickItem:{type:Function}},emits:["downloadDir","downloadFile","uploadFiles","uploadDir","deleteItem","duplicateItem","cutItem","copyItem","pasteItem","copyLink","renameItem","addToFavorites"],setup(C,{emit:_}){const a=_;function $(e){a("downloadDir",e)}function q(e){a("downloadFile",e)}function F(e){a("uploadFiles",e)}function g(e){a("uploadDir",e)}function U(e){a("deleteItem",e)}function A(e){a("duplicateItem",e)}function I(e){a("cutItem",e)}function T(e){a("copyItem",e)}function y(e){a("pasteItem",e)}function E(e){a("copyLink",e)}function V(e){a("renameItem",e)}function z(e){a("addToFavorites",e)}return(e,d)=>{const L=gt,s=Xo,r=rn,O=uo,b=ie("tooltip");return e.isPhone?(n(),k(O,{key:1,"is-selected":e.selectedIds.includes(e.item.id),"is-selecting":e.shiftEffectingIds.includes(e.item.id),"checkbox-checked":e.shiftEffectingIds.includes(e.item.id)?e.shouldSelect:e.selectedIds.includes(e.item.id),onClick:d[10]||(d[10]=u=>e.handleItemClick(u,e.item,e.index,()=>e.clickItem(e.item))),onMouseenter:d[11]||(d[11]=v(u=>e.handleMouseOver(u,e.index),["stop"])),onCheckboxClick:d[12]||(d[12]=u=>e.toggleSelect(u,e.item,e.index))},{image:p(()=>[m("div",{class:"image",onClick:d[9]||(d[9]=u=>e.viewItem(u,e.item))},[e.item.isDir?(n(),l("img",kn)):(n(),l(B,{key:1},[e.extensionImageErrorIds.includes(e.item.id)?(n(),l("img",In)):!e.imageErrorIds.includes(e.item.id)&&e.item.fileId?(n(),l("img",{key:1,class:"image-thumb",src:i(Ze)(e.item.fileId,"&w=50&h=50"),onError:d[7]||(d[7]=u=>e.onImageError(e.item.id))},null,40,wn)):e.item.extension?(n(),l("img",{key:2,src:`/ficons/${e.item.extension}.svg`,class:"svg",onError:d[8]||(d[8]=u=>e.onExtensionImageError(e.item.id))},null,40,Dn)):(n(),l("img",$n))],64))])]),title:p(()=>[ee(c(e.item.name),1)]),subtitle:p(()=>[e.item.isDir?(n(),l("span",bn,c(e.$t("x_items",e.item.children||0)),1)):(n(),l("span",Cn,c(i(se)(e.item.size)),1)),D((n(),l("span",null,[ee(c(i(et)(e.item.updatedAt)),1)])),[[b,i(xe)(e.item.updatedAt)]])]),actions:p(()=>[f(r,{item:e.item,"can-paste":e.canPaste,onDownloadDir:$,onDownloadFile:q,onUploadFiles:F,onUploadDir:g,onDeleteItem:U,onDuplicateItem:A,onCutItem:I,onCopyItem:T,onPasteItem:y,onCopyLink:E,onRenameItem:V,onAddToFavorites:z},null,8,["item","can-paste"])]),_:1},8,["is-selected","is-selecting","checkbox-checked"])):(n(),l("section",{key:0,class:ft(["file-item selectable-card",{selected:e.selectedIds.includes(e.item.id),selecting:e.shiftEffectingIds.includes(e.item.id)}]),onClick:d[5]||(d[5]=v(u=>e.handleItemClick(u,e.item,e.index,()=>e.clickItem(e.item)),["stop"])),onMouseenter:d[6]||(d[6]=v(u=>e.handleMouseOver(u,e.index),["stop"]))},[m("div",dn,[e.shiftEffectingIds.includes(e.item.id)?(n(),k(L,{key:0,class:"checkbox","touch-target":"wrapper",checked:e.shouldSelect,onClick:d[0]||(d[0]=v(u=>e.toggleSelect(u,e.item,e.index),["stop"]))},null,8,["checked"])):(n(),k(L,{key:1,class:"checkbox","touch-target":"wrapper",checked:e.selectedIds.includes(e.item.id),onClick:d[1]||(d[1]=v(u=>e.toggleSelect(u,e.item,e.index),["stop"]))},null,8,["checked"])),m("span",un,[f(s,{id:e.index+1,raw:e.item},null,8,["id","raw"])])]),m("div",{class:"image",onClick:d[4]||(d[4]=u=>e.viewItem(u,e.item))},[e.item.isDir?(n(),l("img",cn)):(n(),l(B,{key:1},[e.extensionImageErrorIds.includes(e.item.id)?(n(),l("img",mn)):!e.imageErrorIds.includes(e.item.id)&&e.item.fileId?(n(),l("img",{key:1,class:"image-thumb",src:i(Ze)(e.item.fileId,"&w=50&h=50"),onError:d[2]||(d[2]=u=>e.onImageError(e.item.id))},null,40,pn)):e.item.extension?(n(),l("img",{key:2,src:`/ficons/${e.item.extension}.svg`,class:"svg",onError:d[3]||(d[3]=u=>e.onExtensionImageError(e.item.id))},null,40,fn)):(n(),l("img",vn))],64))]),m("div",gn,c(e.item.name),1),m("div",_n,[e.item.isDir?(n(),l("span",yn,c(e.$t("x_items",e.item.children||0)),1)):(n(),l("span",hn,c(i(se)(e.item.size)),1)),D((n(),l("span",null,[ee(c(i(et)(e.item.updatedAt)),1)])),[[b,i(xe)(e.item.updatedAt)]])]),f(r,{item:e.item,"can-paste":e.canPaste,onDownloadDir:$,onDownloadFile:q,onUploadFiles:F,onUploadDir:g,onDeleteItem:U,onDuplicateItem:A,onCutItem:I,onCopyItem:T,onPasteItem:y,onCopyLink:E,onRenameItem:V,onAddToFavorites:z},null,8,["item","can-paste"])],34))}}}),Tn=ae(Fn,[["__scopeId","data-v-7d7965b5"]]),En={key:0,class:"file-item selectable-card-skeleton"},Vn={class:"start"},Sn={class:"number"},Pn=j({__name:"FileSkeletonItem",props:{index:{},isPhone:{type:Boolean}},setup(C){return(_,a)=>{const $=jo;return _.isPhone?(n(),k($,{key:1,"title-width":"60%",subtitles:[{width:"45%"},{width:"40%"}],"action-count":5})):(n(),l("section",En,[m("div",Vn,[a[0]||(a[0]=m("div",{class:"skeleton-checkbox"},null,-1)),m("span",Sn,c(_.index),1)]),a[1]||(a[1]=po('<div class="image" data-v-037471a7><div class="skeleton-image lg" data-v-037471a7></div></div><div class="title" data-v-037471a7><div class="skeleton-text lg" style="width:40%;" data-v-037471a7></div></div><div class="subtitle" data-v-037471a7><div class="skeleton-text" style="width:30%;" data-v-037471a7></div></div><div class="actions" data-v-037471a7><div class="skeleton-text lg" style="width:240px;" data-v-037471a7></div></div>',4))]))}}}),qn=ae(Pn,[["__scopeId","data-v-037471a7"]]),Ln={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Bn(C,_){return n(),l("svg",Ln,_[0]||(_[0]=[m("path",{fill:"currentColor",d:"M4 20q-.825 0-1.412-.587T2 18V6q0-.825.588-1.412T4 4h5.175q.4 0 .763.15t.637.425L12 6h8q.825 0 1.413.588T22 8v10q0 .825-.587 1.413T20 20zm0-2h16V8h-8.825l-2-2H4zm0 0V6zm10-4v1q0 .425.288.713T15 16t.713-.288T16 15v-1h1q.425 0 .713-.288T18 13t-.288-.712T17 12h-1v-1q0-.425-.288-.712T15 10t-.712.288T14 11v1h-1q-.425 0-.712.288T12 13t.288.713T13 14z"},null,-1)]))}const Un=Fe({name:"material-symbols-create-new-folder-outline-rounded",render:Bn}),An=j({__name:"FilesKeyboardShortcuts",setup(C){const _=[{keys:["Delete"],description:"delete_selected"},{keys:["modifier","+","Backspace"],description:"delete_selected"},{keys:["modifier","+","A"],description:"select_all"},{keys:["Esc"],description:"clear_selection"},{keys:["Shift","+","Click"],description:"range_select"}];return(a,$)=>{const q=fo;return n(),k(q,{shortcuts:_})}}}),Mn=["onClick"],Rn=j({__name:"FilesActionButtons",props:{currentDir:{type:String,required:!0},canPaste:{type:Boolean,required:!0},pasting:{type:Boolean,required:!0},refreshing:{type:Boolean,required:!0},sorting:{type:Boolean,required:!0},sortItems:{type:Array,required:!0},fileSortBy:{type:String,required:!0}},emits:["createDir","uploadFiles","uploadDir","pasteDir","refreshCurrentDir","sort"],setup(C,{emit:_}){const a=_,$=P(!1),q=P(!1);function F(){a("createDir")}function g(y){a("uploadFiles",y)}function U(y){a("uploadDir",y)}function A(){a("pasteDir")}function I(){a("refreshCurrentDir")}function T(y){a("sort",y)}return(y,E)=>{const V=An,z=Un,e=Ce,d=vt,L=mt,s=xo,r=vo,O=Wo,b=ie("tooltip");return n(),l(B,null,[f(V),D((n(),k(e,{onClick:F},{default:p(()=>[f(z)]),_:1})),[[b,y.$t("create_folder")]]),f(L,{modelValue:$.value,"onUpdate:modelValue":E[2]||(E[2]=u=>$.value=u)},{trigger:p(()=>[D((n(),k(e,null,{default:p(()=>[f(d)]),_:1})),[[b,y.$t("upload")]])]),default:p(()=>[m("div",{class:"dropdown-item",onClick:E[0]||(E[0]=v(u=>{g(C.currentDir),$.value=!1},["stop"]))},c(y.$t("upload_files")),1),m("div",{class:"dropdown-item",onClick:E[1]||(E[1]=v(u=>{U(C.currentDir),$.value=!1},["stop"]))},c(y.$t("upload_folder")),1)]),_:1},8,["modelValue"]),C.canPaste?D((n(),k(e,{key:0,loading:C.pasting,onClick:A},{default:p(()=>[f(s)]),_:1},8,["loading"])),[[b,y.$t("paste")]]):M("",!0),D((n(),k(e,{loading:C.refreshing,onClick:I},{default:p(()=>[f(r)]),_:1},8,["loading"])),[[b,y.$t("refresh")]]),f(L,{modelValue:q.value,"onUpdate:modelValue":E[3]||(E[3]=u=>q.value=u)},{trigger:p(()=>[D((n(),k(e,{loading:C.sorting},{default:p(()=>[f(O)]),_:1},8,["loading"])),[[b,y.$t("sort")]])]),default:p(()=>[(n(!0),l(B,null,be(C.sortItems,u=>(n(),l("div",{key:u.value,class:ft(["dropdown-item",{selected:u.value===C.fileSortBy}]),onClick:Q=>{T(u.value),q.value=!1}},c(y.$t(u.label)),11,Mn))),128))]),_:1},8,["modelValue"])],64)}}}),zn={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function On(C,_){return n(),l("svg",zn,_[0]||(_[0]=[m("path",{fill:"currentColor",d:"m12 14l-2.35 2.35q.2.375.275.8T10 18q0 1.65-1.175 2.825T6 22t-2.825-1.175T2 18t1.175-2.825T6 14q.425 0 .85.075t.8.275L10 12L7.65 9.65q-.375.2-.8.275T6 10q-1.65 0-2.825-1.175T2 6t1.175-2.825T6 2t2.825 1.175T10 6q0 .425-.075.85t-.275.8L20.6 18.6q.675.675.3 1.538T19.575 21q-.275 0-.537-.112t-.463-.313zm3-3l-2-2l5.575-5.575q.2-.2.463-.312T19.574 3q.95 0 1.313.875t-.313 1.55zM6 8q.825 0 1.413-.587T8 6t-.587-1.412T6 4t-1.412.588T4 6t.588 1.413T6 8m6 4.5q.2 0 .35-.15t.15-.35t-.15-.35t-.35-.15t-.35.15t-.15.35t.15.35t.35.15M6 20q.825 0 1.413-.587T8 18t-.587-1.412T6 16t-1.412.588T4 18t.588 1.413T6 20"},null,-1)]))}const Nn=Fe({name:"material-symbols-content-cut-rounded",render:On}),Hn={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Qn(C,_){return n(),l("svg",Hn,_[0]||(_[0]=[m("path",{fill:"currentColor",d:"M9 18q-.825 0-1.412-.587T7 16V4q0-.825.588-1.412T9 2h9q.825 0 1.413.588T20 4v12q0 .825-.587 1.413T18 18zm0-2h9V4H9zm-4 6q-.825 0-1.412-.587T3 20V7q0-.425.288-.712T4 6t.713.288T5 7v13h10q.425 0 .713.288T16 21t-.288.713T15 22zm4-6V4z"},null,-1)]))}const Kn=Fe({name:"material-symbols-content-copy-outline-rounded",render:Qn}),Gn=go("files",{state:()=>({selectedFiles:[],isCut:!1})}),Jn={class:"top-app-bar"},Wn={class:"title"},Xn={key:0},jn={key:1,class:"breadcrumb"},Yn={key:0},Zn=["onClick"],xn={key:0},es=["onClick"],ts={key:0,class:"actions"},os={key:0,class:"secondary-actions"},ns={key:1,class:"scroller-wrapper"},ss={class:"scroller main-list"},is={key:1,class:"no-data-placeholder"},ut=1e4,as=j({__name:"FilesView",setup(C){const _=Po("isPhone"),{t:a}=_o(),$=P([]),{parseQ:q,buildQ:F}=Ro(),g=yo({type:"",rootPath:"",showHidden:!1,text:"",parent:""}),U=Ao(),A=P(""),I=P([]),{selectedIds:T,allChecked:y,realAllChecked:E,clearSelection:V,toggleAllChecked:z,toggleSelect:e,total:d,checked:L,shiftEffectingIds:s,handleItemClick:r,handleMouseOver:O,selectAll:b,shouldSelect:u}=Yo(I),{keyDown:Q,keyUp:te}=Zo(b,V,()=>{Oe()}),J=P(!1),W=P(!1),R=P([]),w=P([]),_t=t=>{R.value.push(t)},yt=t=>{w.value.push(t)},Te=qo(),Ee=ho(),{fileSortBy:Y}=De(Ee),Ve=ko(),{app:Se,urlTokenKey:N,uploads:re}=De(Ve),{selectedFiles:ht,isCut:kt}=De(Gn()),{dropping:It,fileDragEnter:Pe,fileDragLeave:qe,dropFiles:wt}=Io(re),oe=tt(()=>g.rootPath),{createPath:Dt,createVariables:$t,createMutation:bt}=wo(N,I),{renameItem:Ct,renameDone:Ft,renameMutation:Tt,renameVariables:Et}=Do(()=>{K()}),{mounts:Vt,refetch:de}=$o(),{downloadFile:Z,downloadDir:ue,downloadFiles:St}=To(N),{view:Le}=Ko($,(t,o)=>{Ve.lightbox={sources:t,index:o,visible:!0}}),Be=P(1),ce=P(!1);function me(){var t,o;Be.value=parseInt(((t=U.query.page)==null?void 0:t.toString())??"1"),A.value=Mo(((o=U.query.q)==null?void 0:o.toString())??""),q(g,A.value)}me();const Pt=tt(()=>{const t=[];let o=g.parent;for(;o&&o!==oe.value;)t.unshift({path:o,name:bo(o)}),o=o.substring(0,o.lastIndexOf("/"));return t.unshift({path:oe.value,name:Ot()}),t}),Ue=P(!0),{loading:pe,fetch:K}=Co({handle:async(t,o)=>{if(Ue.value=!1,J.value=!1,W.value=!1,o)H(a(o),"error");else{const S=[];for(const Ie of t.files)S.push(Oo(Ie,N.value));I.value=S,d.value=S.length}},document:zo,variables:()=>({root:oe.value,offset:(Be.value-1)*ut,limit:ut,query:A.value,sortBy:Y.value}),options:{fetchPolicy:"cache-and-network"}}),{loading:Ae,canPaste:fe,copy:ve,cut:Me,paste:ge}=Fo(I,kt,ht,K,de),{input:qt,upload:Lt,uploadChanged:Re}=ot(re),{input:Bt,upload:Ut,uploadChanged:ze}=ot(re),{loading:At,mutate:Mt,onDone:Rt}=nt({document:No});Rt(t=>{St(t.data.setTempValue.key),V()});const zt=()=>{const t=I.value.filter(o=>T.value.includes(o.id));if(t.length===0){H(a("select_first"),"error");return}if(t.length===1){const o=t[0];o.isDir?ue(o.path):Z(o.path),V();return}x(en,{onEach:async()=>{for(const o of t)o.isDir?ue(o.path):Z(o.path),await new Promise(S=>setTimeout(S,250));V()},onZip:()=>{Mt({key:Jo(),value:JSON.stringify(T.value.map(o=>({path:o})))})}})},_e=t=>{t.forEach(o=>{Go(I.value,S=>S.id===o.id)}),d.value=I.value.length,V(),de()},Oe=()=>{x(it,{files:I.value.filter(t=>T.value.includes(t.id)),onDone:t=>{_e(t)}})};function Ot(){if(g.type==="SDCARD")return a("sdcard");if(g.type==="APP")return a("app_data");if(g.type==="USB_STORAGE"){const t=Se.value.usbDiskPaths.indexOf(g.rootPath),o=t!==-1?t+1:1;return`${a("usb_storage")} ${o}`}return a("internal_storage")}function Ne(){if(g.type==="APP")return a("app_data");const t=Vt.value.find(o=>o.mountPoint===g.rootPath);return t?`${a("storage_free_total",{free:se(t.freeBytes??0),total:se(t.totalBytes??0)})}`:""}function ye(t){V(),g.parent=t,g.text="";const o=F(g);Qo(Ee,Nt(o))}function Nt(t){return t?`/files?q=${t}`:"/files"}function Ht(t){if(t.isDir){ye(t.path);return}if(at(t.name)){const o=lt(N.value,t.path);window.open(`/text-file?id=${encodeURIComponent(o)}`,"_blank")}else rt(t.name)?window.open($e(N.value,t.path),"_blank"):dt(t.name)?Le(I.value,t):Z(t.path)}function Qt(t,o){if(!o.isDir)if(t.stopPropagation(),at(o.name)){const S=lt(N.value,o.path);window.open(`/text-file?id=${encodeURIComponent(S)}`,"_blank")}else rt(o.name)?window.open($e(N.value,o.path),"_blank"):dt(o.name)?Le(I.value,o):Z(o.path)}function He(t){Y.value!==t&&(W.value=!0,Y.value=t)}function Qe(){J.value=!0,K()}const Ke=()=>{Dt.value=g.parent,x(st,{title:a("create_folder"),placeholder:a("name"),mutation:bt,getVariables:$t})};function he(t){Lt(t)}function ke(t){Ut(t)}function Kt(){ve(T.value),V()}function Gt(){Me(T.value),V()}function Ge(){ge(g.parent)}function Jt(t){ve([t.id]),ge(g.parent)}function Wt(t){Me([t.id])}function Xt(t){ve([t.id])}function jt(t){const o=$e(N.value,t.path);navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(o).then(()=>{H(a("link_copied"))}).catch(()=>{Je(o)}):Je(o)}function Je(t){try{const o=document.createElement("textarea");o.value=t,o.style.position="fixed",o.style.left="-999999px",o.style.top="-999999px",document.body.appendChild(o),o.focus(),o.select();const S=document.execCommand("copy");document.body.removeChild(o),S?H(a("link_copied")):H(a("copy_failed"),"error")}catch(o){console.error("Failed to copy text: ",o),H(a("copy_failed"),"error")}}function Yt(t){ge(t.path)}function Zt(t){Ct.value=t,x(st,{title:a("rename"),placeholder:a("name"),value:t.name,mutation:Tt,getVariables:Et,done:Ft})}function xt(t){x(it,{files:[t],onDone:_e})}const{mutate:eo,loading:ls}=nt({document:Ho,options:{update:()=>{G.emit("refetch_app")}}});function to(t){if(!t.isDir)return;let o=oe.value;eo({rootPath:o,fullPath:t.path}).then(()=>{H(a("added"))}).catch(S=>{console.error("Error adding favorite folder:",S),H(a("error"),"error")})}Eo(()=>U.fullPath,()=>{ce.value&&(me(),K())});const We=t=>{t.status==="done"&&setTimeout(()=>{K(),de()},1e3)},Xe=t=>{_e([t.item])},je=t=>{K()};function oo(t){wt(t,g.parent,()=>!0)}return Vo(()=>{ce.value=!0,me(),K(),G.on("upload_task_done",We),G.on("file_deleted",Xe),G.on("file_renamed",je),window.addEventListener("keydown",Q),window.addEventListener("keyup",te)}),So(()=>{ce.value=!1,G.off("upload_task_done",We),G.off("file_deleted",Xe),G.off("file_renamed",je),window.removeEventListener("keydown",Q),window.removeEventListener("keyup",te)}),(t,o)=>{const S=gt,Ie=Kn,ne=Ce,no=Nn,so=pt,io=ct,Ye=Rn,ao=qn,lo=Tn,X=ie("tooltip");return n(),l(B,null,[m("div",Jn,[f(S,{"touch-target":"wrapper",checked:i(y),indeterminate:!i(y)&&i(L),onChange:i(z)},null,8,["checked","indeterminate","onChange"]),m("div",Wn,[i(T).length?(n(),l("span",Xn,c(t.$t("x_selected",{count:i(E)?i(d).toLocaleString():i(T).length.toLocaleString()})),1)):(n(),l("div",jn,[(n(!0),l(B,null,be(Pt.value,(h,we)=>(n(),l(B,{key:h.path},[we===0?(n(),l(B,{key:0},[h.path===g.parent?D((n(),l("span",Yn,[ee(c(h.name)+" ("+c(i(d))+")",1)])),[[X,Ne()]]):D((n(),l("a",{key:1,href:"#",onClick:v(ro=>ye(h.path),["stop","prevent"])},[ee(c(h.name),1)],8,Zn)),[[X,Ne()]])],64)):(n(),l(B,{key:1},[h.path===g.parent?(n(),l("span",xn,c(h.name)+" ("+c(i(d))+")",1)):(n(),l("a",{key:1,href:"#",onClick:v(ro=>ye(h.path),["stop","prevent"])},c(h.name),9,es))],64))],64))),128))])),i(L)?(n(),l(B,{key:2},[D((n(),k(ne,{onClick:v(Kt,["stop"])},{default:p(()=>[f(Ie)]),_:1})),[[X,t.$t("copy")]]),D((n(),k(ne,{onClick:v(Gt,["stop"])},{default:p(()=>[f(no)]),_:1})),[[X,t.$t("cut")]]),D((n(),k(ne,{onClick:v(Oe,["stop"])},{default:p(()=>[f(so)]),_:1})),[[X,t.$t("delete")]]),D((n(),k(ne,{loading:i(At),onClick:v(zt,["stop"])},{default:p(()=>[f(io)]),_:1},8,["loading"])),[[X,t.$t("download")]])],64)):M("",!0)]),!i(_)&&!i(L)?(n(),l("div",ts,[f(Ye,{"current-dir":g.parent,"can-paste":i(fe)(),pasting:i(Ae),refreshing:J.value,sorting:W.value,"sort-items":i(Te),"file-sort-by":i(Y),onCreateDir:Ke,onUploadFiles:he,onUploadDir:ke,onPasteDir:Ge,onRefreshCurrentDir:Qe,onSort:He},null,8,["current-dir","can-paste","pasting","refreshing","sorting","sort-items","file-sort-by"])])):M("",!0)]),i(_)&&!i(L)?(n(),l("div",os,[f(Ye,{"current-dir":g.parent,"can-paste":i(fe)(),pasting:i(Ae),refreshing:J.value,sorting:W.value,"sort-items":i(Te),"file-sort-by":i(Y),onCreateDir:Ke,onUploadFiles:he,onUploadDir:ke,onPasteDir:Ge,onRefreshCurrentDir:Qe,onSort:He},null,8,["current-dir","can-paste","pasting","refreshing","sorting","sort-items","file-sort-by"])])):M("",!0),i(pe)&&Ue.value?(n(),l("div",ns,[m("div",ss,[(n(),l(B,null,be(20,h=>f(ao,{key:h,index:h,"is-phone":i(_)},null,8,["index","is-phone"])),64))])])):M("",!0),m("div",{class:"scroller-wrapper",onDragover:o[3]||(o[3]=v((...h)=>i(Pe)&&i(Pe)(...h),["stop","prevent"]))},[D(m("div",{class:"drag-mask",onDrop:v(oo,["stop","prevent"]),onDragleave:o[0]||(o[0]=v((...h)=>i(qe)&&i(qe)(...h),["stop","prevent"]))},c(t.$t("release_to_send_files")),545),[[Lo,i(It)]]),I.value.length>0?(n(),k(i(Bo),{key:0,class:"scroller main-list","data-key":"id","data-sources":I.value,"estimate-size":80},{item:p(({index:h,item:we})=>[f(lo,{item:we,index:h,"selected-ids":i(T),"shift-effecting-ids":i(s),"should-select":i(u),"is-phone":i(_),"image-error-ids":R.value,"extension-image-error-ids":w.value,"can-paste":i(fe)(),"handle-item-click":i(r),"handle-mouse-over":i(O),"toggle-select":i(e),"on-image-error":_t,"on-extension-image-error":yt,"view-item":Qt,"click-item":Ht,onDownloadDir:i(ue),onDownloadFile:i(Z),onUploadFiles:he,onUploadDir:ke,onDeleteItem:xt,onDuplicateItem:Jt,onCutItem:Wt,onCopyItem:Xt,onPasteItem:Yt,onCopyLink:jt,onRenameItem:Zt,onAddToFavorites:to},null,8,["item","index","selected-ids","shift-effecting-ids","should-select","is-phone","image-error-ids","extension-image-error-ids","can-paste","handle-item-click","handle-mouse-over","toggle-select","onDownloadDir","onDownloadFile"])]),_:1},8,["data-sources"])):M("",!0),!i(pe)&&I.value.length===0?(n(),l("div",is,c(t.$t(i(Uo)(i(pe),i(Se).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):M("",!0),m("input",{ref_key:"fileInput",ref:qt,style:{display:"none"},type:"file",multiple:"",onChange:o[1]||(o[1]=(...h)=>i(Re)&&i(Re)(...h))},null,544),m("input",{ref_key:"dirFileInput",ref:Bt,style:{display:"none"},type:"file",multiple:"",webkitdirectory:"",mozdirectory:"",directory:"",onChange:o[2]||(o[2]=(...h)=>i(ze)&&i(ze)(...h))},null,544)],32)],64)}}}),_s=ae(as,[["__scopeId","data-v-097d3435"]]);export{_s as default};
