import{_ as mt}from"./VPagination.vuevuetypescriptsetuptruelang-CItthOBY.js";import{_ as pt,b as _t,u as vt,a as ft}from"./key-events-BYkttUqL.js";import{e as le,c as s,K as C,o as l,a as m,d as yt,t as d,m as ue,az as Fe,r as G,aA as De,aB as ze,aC as X,ae as gt,aD as bt,q as y,k as c,aj as ge,l as n,H as F,A as Be,y as Oe,v as ht,x as $t,aE as Pe,T as je,u as Ke,i as fe,aF as Ne,ab as ye,j as N,Z as $,$ as w,a8 as be,ah as kt,aG as Ct,L as K,M as he,G as $e,z as B,N as Qe,O as Re,aH as qe,Q as wt,R as Se,S as Le,aI as de,J as Ge,f as Vt,s as Tt,g as It,U as Nt,V as qt,W as St,h as Lt,X as Ut,Y as Mt,p as At,a0 as Et,a2 as ie,aJ as Ft,F as Ue,aK as Dt,I as zt,ak as Bt,B as Me,a3 as Ot,ac as Pt,a4 as jt,a5 as x,aL as Kt}from"./index-FOZNDT71.js";import{_ as Qt,a as Rt,b as Gt}from"./SearchInput-BxtFwvep.js";import{_ as He}from"./VCheckbox-DyetyCl-.js";import{_ as Ht}from"./VSelect-DF9JdhvM.js";import{u as Jt,a as Wt}from"./tags-DGzmTM1j.js";import{u as Xt}from"./search-B2DXL489.js";import{_ as Yt}from"./ListItemPhone.vuevuetypescriptsetuptruelang-BjCGMdxb.js";import{_ as Zt}from"./call-outline-rounded-DTGSEb6K.js";import{_ as xt}from"./FieldId.vuevuetypescriptsetuptruelang-CKaNInMF.js";import"./search-rounded-V5nXvfTt.js";const el={key:0,class:"contact-item selectable-card-skeleton"},tl={class:"start"},ll={class:"number"},nl=le({__name:"ContactSkeletonItem",props:{index:{},isPhone:{type:Boolean}},setup(I){return(v,f)=>{const a=pt;return v.isPhone?(l(),C(a,{key:1,"title-width":"70%",subtitles:[{width:"45%"},{width:"30%"},{width:"40%"}],"action-count":3})):(l(),s("section",el,[m("div",tl,[f[0]||(f[0]=m("div",{class:"skeleton-checkbox"},null,-1)),m("span",ll,d(v.index),1)]),f[1]||(f[1]=yt('<div class="image"><div class="skeleton-image lg"></div></div><div class="title"><div class="skeleton-text lg" style="width:50%;"></div></div><div class="subtitle"><div class="skeleton-text" style="width:40%;"></div></div><div class="info"><div class="skeleton-text" style="width:180px;"></div></div><div class="actions"><div class="skeleton-text lg" style="width:120px;"></div></div><div class="time"><div class="skeleton-text" style="width:60px;"></div></div>',6))]))}}}),ol={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function sl(I,v){return l(),s("svg",ol,v[0]||(v[0]=[m("path",{fill:"currentColor",d:"M12 13.825L8.1 17.7q-.275.275-.687.288T6.7 17.7q-.275-.275-.275-.7t.275-.7l4.6-4.6q.15-.15.325-.213t.375-.062t.375.062t.325.213l4.6 4.6q.275.275.288.688t-.288.712q-.275.275-.7.275t-.7-.275zm0-6L8.1 11.7q-.275.275-.687.288T6.7 11.7q-.275-.275-.275-.7t.275-.7l4.6-4.6q.15-.15.325-.212T12 5.425t.375.063t.325.212l4.6 4.6q.275.275.288.688t-.288.712q-.275.275-.7.275t-.7-.275z"},null,-1)]))}const al=ue({name:"material-symbols-keyboard-double-arrow-up-rounded",render:sl}),il={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function dl(I,v){return l(),s("svg",il,v[0]||(v[0]=[m("path",{fill:"currentColor",d:"m12 16.175l3.9-3.875q.275-.275.688-.288t.712.288q.275.275.275.7t-.275.7l-4.6 4.6q-.15.15-.325.213t-.375.062t-.375-.062t-.325-.213l-4.6-4.6q-.275-.275-.288-.687T6.7 12.3q.275-.275.7-.275t.7.275zm0-6L15.9 6.3q.275-.275.688-.287t.712.287q.275.275.275.7t-.275.7l-4.6 4.6q-.15.15-.325.213t-.375.062t-.375-.062t-.325-.213L6.7 7.7q-.275-.275-.288-.687T6.7 6.3q.275-.275.7-.275t.7.275z"},null,-1)]))}const ul=ue({name:"material-symbols-keyboard-double-arrow-down-rounded",render:dl});function ee(I){return Array.from({length:I},(v,f)=>f+1).concat(-1)}const oe={phoneNumberTypes:ee(20),emailTypes:ee(4),addressTypes:ee(3),eventTypes:ee(3),imTypes:ee(8),websiteTypes:ee(7)},rl=le({__name:"PromptModal",props:{do:{type:Function,required:!0},title:{type:String,required:!0},value:{type:String,default:""}},setup(I){const{handleSubmit:v}=Fe(),f=G(),a=I,{value:g,resetField:L,errorMessage:q}=De("inputValue",ze().required()),U=v(()=>{a.do(String(g.value||"")),X()});return a.value?g.value=a.value:L(),gt(async()=>{await bt(),requestAnimationFrame(()=>{setTimeout(()=>{var e;try{document.activeElement&&document.activeElement!==document.body&&document.activeElement.blur(),(e=f.value)==null||e.focus()}catch(p){console.debug("Focus blocked:",p)}},100)})}),(e,p)=>{const V=Oe,M=ge,S=Be,A=Pe;return l(),C(A,{onClose:n(X)},{headline:y(()=>[F(d(I.title),1)]),content:y(()=>[c(V,{ref_key:"inputRef",ref:f,modelValue:n(g),"onUpdate:modelValue":p[0]||(p[0]=E=>$t(g)?g.value=E:null),class:"form-control",error:!!n(q),"error-text":n(q)?e.$t(n(q)):"",onKeyup:ht(n(U),["enter"])},null,8,["modelValue","error","error-text","onKeyup"])]),actions:y(()=>[c(M,{value:"cancel",onClick:n(X)},{default:y(()=>[F(d(e.$t("cancel")),1)]),_:1},8,["onClick"]),c(S,{value:"ok",onClick:n(U)},{default:y(()=>[F(d(e.$t("ok")),1)]),_:1},8,["onClick"])]),_:1},8,["onClose"])}}}),cl={class:"form-label"},ml={class:"form-row"},pl={key:1,class:"v-center"},_l={key:0,class:"form-row"},vl={class:"v-center"},fl={class:"form-label"},yl={class:"v-center"},gl=["onClick"],bl={key:1,class:"form-label"},hl={class:"v-center"},$l=["onClick"],kl={key:2,class:"form-label"},Cl={class:"v-center"},wl=["onClick"],Vl={key:3,class:"form-label"},Tl={class:"v-center"},Il=["onClick"],Nl={key:4,class:"form-label"},ql={class:"v-center"},Sl=["onClick"],Ll={class:"form-row",style:{display:"block",position:"relative"}},Ul={class:"form-row"},Ae=le({__name:"EditContactModal",props:{data:{type:Object,default:()=>({})},sources:{type:Array,default:()=>[]},done:{type:Function,default:()=>{}}},setup(I){const{handleSubmit:v}=Fe(),f=I,a=je({firstName:"",middleName:"",lastName:"",prefix:"",suffix:"",nickname:"",organization:null,notes:"",source:"",starred:0,phoneNumbers:[],emails:[],addresses:[],websites:[],events:[],ims:[],groupIds:[]}),g=G(!1),L=G(!1),{t:q}=Ke(),{mutate:U,loading:e,onDone:p}=fe({document:ye`
    mutation createContact($input: ContactInput!) {
      createContact(input: $input) {
        ...ContactFragment
      }
    }
    ${Ne}
  `,options:{update:()=>{f.done()}}}),{mutate:V,loading:M,onDone:S}=fe({document:ye`
    mutation updateContact($id: ID!, $input: ContactInput!) {
      updateContact(id: $id, input: $input) {
        ...ContactFragment
      }
    }
    ${Ne}
  `,options:{update:()=>{f.done()}}}),{value:A,resetField:E,errorMessage:Q}=De("inputValue",ze().test("required",o=>"valid.required",o=>!0).test("target-value",o=>"invalid_value",o=>!0)),P=(o,r)=>{o.splice(0,o.length);for(const b of r)o.push({label:b.label,value:b.value,type:b.type})};(()=>{const o=f.data;o?(Object.assign(a,{firstName:o.firstName,middleName:o.middleName,lastName:o.lastName,prefix:o.prefix,suffix:o.suffix,notes:o.notes}),P(a.phoneNumbers,o.phoneNumbers),P(a.emails,o.emails),P(a.addresses,o.addresses),P(a.websites,o.websites),P(a.events,o.events),P(a.ims,o.ims)):(Object.assign(a,{firstName:"",middleName:"",lastName:"",prefix:"",suffix:"",notes:"",phoneNumbers:[{type:2,value:"",label:""}],emails:[],addresses:[],websites:[],events:[],ims:[]}),E())})();const D=o=>{o.type===-1&&Ct(rl,{value:o.label,title:q("custom"),do:r=>{o.label=r}})},t=(o,r,b)=>r===-1?o.label?o.label:q("custom"):q(`contact.${b}.${r}`),k=(o,r,b)=>o.map(Y=>({value:Y,label:t(b,Y,r)})),j=o=>{o.push({type:1,value:"",label:""}),L.value=!1},O=(o,r)=>{o.splice(r,1)},re=v(()=>{var o,r;f.data?V({id:f.data.id,input:a}):(a.source=((r=(o=f.sources)==null?void 0:o[0])==null?void 0:r.name)??"",U({input:a}))});return p(()=>{X()}),S(()=>{X()}),(o,r)=>{const b=Oe,Y=ul,z=al,R=Ht,H=be,se=ge,ce=kt,me=Be,pe=Pe;return l(),C(pe,{onClose:n(X)},{headline:y(()=>[F(d(I.data?o.$t("edit"):o.$t("create")),1)]),content:y(()=>[m("label",cl,d(o.$t("name")),1),m("div",ml,[c(b,{modelValue:a.firstName,"onUpdate:modelValue":r[0]||(r[0]=u=>a.firstName=u),label:o.$t("first_name")},null,8,["modelValue","label"]),g.value?(l(),C(b,{key:0,modelValue:a.middleName,"onUpdate:modelValue":r[1]||(r[1]=u=>a.middleName=u),label:o.$t("middle_name")},null,8,["modelValue","label"])):N("",!0),c(b,{modelValue:a.lastName,"onUpdate:modelValue":r[2]||(r[2]=u=>a.lastName=u),label:o.$t("last_name")},null,8,["modelValue","label"]),g.value?N("",!0):(l(),s("div",pl,[m("button",{class:"btn-icon",onClick:r[3]||(r[3]=u=>g.value=!0)},[c(Y)])]))]),g.value?(l(),s("div",_l,[c(b,{modelValue:a.prefix,"onUpdate:modelValue":r[4]||(r[4]=u=>a.prefix=u),label:o.$t("prefix")},null,8,["modelValue","label"]),c(b,{modelValue:a.suffix,"onUpdate:modelValue":r[5]||(r[5]=u=>a.suffix=u),label:o.$t("suffix")},null,8,["modelValue","label"]),m("div",vl,[m("button",{class:"btn-icon",onClick:r[6]||(r[6]=u=>g.value=!1)},[c(z)])])])):N("",!0),m("label",fl,d(o.$t("phone_number")),1),(l(!0),s($,null,w(a.phoneNumbers,(u,T)=>(l(),s("div",{key:T,class:"form-row"},[c(R,{modelValue:u.type,"onUpdate:modelValue":_=>u.type=_,modelModifiers:{number:!0},class:"flex-2",options:k(n(oe).phoneNumberTypes,"phone_number_type",u),onChange:_=>D(u)},null,8,["modelValue","onUpdate:modelValue","options","onChange"]),c(b,{modelValue:u.value,"onUpdate:modelValue":_=>u.value=_,placeholder:o.$t("telephone"),class:"flex-3"},null,8,["modelValue","onUpdate:modelValue","placeholder"]),m("div",yl,[a.phoneNumbers.length>1?(l(),s("button",{key:0,class:"btn-icon",onClick:_=>O(a.phoneNumbers,T)},[c(H)],8,gl)):N("",!0)])]))),128)),a.emails.length?(l(),s("label",bl,d(o.$t("email")),1)):N("",!0),(l(!0),s($,null,w(a.emails,(u,T)=>(l(),s("div",{key:T,class:"form-row"},[c(R,{modelValue:u.type,"onUpdate:modelValue":_=>u.type=_,modelModifiers:{number:!0},class:"flex-2",options:k(n(oe).emailTypes,"email_type",u),onChange:_=>D(u)},null,8,["modelValue","onUpdate:modelValue","options","onChange"]),c(b,{modelValue:u.value,"onUpdate:modelValue":_=>u.value=_,label:o.$t("email"),class:"flex-3"},null,8,["modelValue","onUpdate:modelValue","label"]),m("div",hl,[m("button",{class:"btn-icon",onClick:_=>O(a.emails,T)},[c(H)],8,$l)])]))),128)),a.addresses.length?(l(),s("label",kl,d(o.$t("address")),1)):N("",!0),(l(!0),s($,null,w(a.addresses,(u,T)=>(l(),s("div",{key:T,class:"form-row"},[c(R,{modelValue:u.type,"onUpdate:modelValue":_=>u.type=_,modelModifiers:{number:!0},class:"flex-2",options:k(n(oe).addressTypes,"address_type",u),onChange:_=>D(u)},null,8,["modelValue","onUpdate:modelValue","options","onChange"]),c(b,{modelValue:u.value,"onUpdate:modelValue":_=>u.value=_,label:o.$t("address"),class:"flex-3"},null,8,["modelValue","onUpdate:modelValue","label"]),m("div",Cl,[m("button",{class:"btn-icon",onClick:_=>O(a.addresses,T)},[c(H)],8,wl)])]))),128)),a.websites.length?(l(),s("label",Vl,d(o.$t("website")),1)):N("",!0),(l(!0),s($,null,w(a.websites,(u,T)=>(l(),s("div",{key:T,class:"form-row"},[c(R,{modelValue:u.type,"onUpdate:modelValue":_=>u.type=_,modelModifiers:{number:!0},class:"flex-2",options:k(n(oe).websiteTypes,"website_type",u),onChange:_=>D(u)},null,8,["modelValue","onUpdate:modelValue","options","onChange"]),c(b,{modelValue:u.value,"onUpdate:modelValue":_=>u.value=_,placeholder:o.$t("website"),class:"flex-3"},null,8,["modelValue","onUpdate:modelValue","placeholder"]),m("div",Tl,[m("button",{class:"btn-icon",onClick:_=>O(a.websites,T)},[c(H)],8,Il)])]))),128)),a.ims.length?(l(),s("label",Nl,d(o.$t("im")),1)):N("",!0),(l(!0),s($,null,w(a.ims,(u,T)=>(l(),s("div",{key:T,class:"form-row"},[c(R,{modelValue:u.type,"onUpdate:modelValue":_=>u.type=_,modelModifiers:{number:!0},class:"flex-2",options:k(n(oe).imTypes,"im_type",u),onChange:_=>D(u)},null,8,["modelValue","onUpdate:modelValue","options","onChange"]),c(b,{modelValue:u.value,"onUpdate:modelValue":_=>u.value=_,placeholder:o.$t("im"),class:"flex-3"},null,8,["modelValue","onUpdate:modelValue","placeholder"]),m("div",ql,[m("button",{class:"btn-icon",onClick:_=>O(a.ims,T)},[c(H)],8,Sl)])]))),128)),m("div",Ll,[c(ce,{modelValue:L.value,"onUpdate:modelValue":r[12]||(r[12]=u=>L.value=u),placement:"auto",align:"top-left-to-bottom-left"},{trigger:y(()=>[c(se,null,{default:y(()=>[F(d(o.$t("add_field")),1)]),_:1})]),default:y(()=>[m("div",{class:"dropdown-item",onClick:r[7]||(r[7]=()=>j(a.phoneNumbers))},d(o.$t("phone_number")),1),m("div",{class:"dropdown-item",onClick:r[8]||(r[8]=()=>j(a.emails))},d(o.$t("email")),1),m("div",{class:"dropdown-item",onClick:r[9]||(r[9]=()=>j(a.addresses))},d(o.$t("address")),1),m("div",{class:"dropdown-item",onClick:r[10]||(r[10]=()=>j(a.websites))},d(o.$t("website")),1),m("div",{class:"dropdown-item",onClick:r[11]||(r[11]=()=>j(a.ims))},d(o.$t("im")),1)]),_:1},8,["modelValue"])]),m("div",Ul,[c(b,{modelValue:a.notes,"onUpdate:modelValue":r[13]||(r[13]=u=>a.notes=u),type:"textarea",label:o.$t("notes"),rows:3},null,8,["modelValue","label"])])]),actions:y(()=>[c(se,{value:"cancel",onClick:n(X)},{default:y(()=>[F(d(o.$t("cancel")),1)]),_:1},8,["onClick"]),c(me,{value:"save",loading:n(e)||n(M),onClick:n(re)},{default:y(()=>[F(d(o.$t("save")),1)]),_:1},8,["loading","onClick"])]),_:1},8,["onClose"])}}}),Ml={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Al(I,v){return l(),s("svg",Ml,v[0]||(v[0]=[m("path",{fill:"currentColor",d:"M12 14q.825 0 1.413-.587T14 12t-.587-1.412T12 10t-1.412.588T10 12t.588 1.413T12 14m-4 4h8v-.575q0-.6-.325-1.1t-.9-.75q-.65-.275-1.338-.425T12 15t-1.437.15t-1.338.425q-.575.25-.9.75T8 17.425zm10 4H6q-.825 0-1.412-.587T4 20V4q0-.825.588-1.412T6 2h7.175q.4 0 .763.15t.637.425l4.85 4.85q.275.275.425.638t.15.762V20q0 .825-.587 1.413T18 22m0-2V8.85L13.15 4H6v16zM6 20V4z"},null,-1)]))}const El=ue({name:"material-symbols-contact-page-outline-rounded",render:Al}),Fl={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Dl(I,v){return l(),s("svg",Fl,v[0]||(v[0]=[m("path",{fill:"currentColor",d:"M3 21v-4.25L16.2 3.575q.3-.275.663-.425t.762-.15t.775.15t.65.45L20.425 5q.3.275.438.65T21 6.4q0 .4-.137.763t-.438.662L7.25 21zM17.6 7.8L19 6.4L17.6 5l-1.4 1.4z"},null,-1)]))}const zl=ue({name:"material-symbols-edit",render:Dl}),Bl={class:"actions"},Ee=le({__name:"ContactActionButtons",props:{item:{}},emits:["deleteItem","edit","addItemToTags"],setup(I,{emit:v}){const f=I,a=v;function g(){a("deleteItem",f.item)}function L(){a("edit",f.item)}function q(){a("addItemToTags",f.item)}return(U,e)=>{const p=be,V=$e,M=zl,S=Qe,A=he("tooltip");return l(),s("div",Bl,[K((l(),C(V,{onClick:B(g,["stop"])},{default:y(()=>[c(p)]),_:1})),[[A,U.$t("delete")]]),K((l(),C(V,{onClick:B(L,["stop"])},{default:y(()=>[c(M)]),_:1})),[[A,U.$t("edit")]]),K((l(),C(V,{onClick:B(q,["stop"])},{default:y(()=>[c(S)]),_:1})),[[A,U.$t("add_to_tags")]])])}}}),Ol={class:"start"},Pl={class:"number"},jl=["src"],Kl={class:"title"},Ql={class:"subtitle"},Rl={key:0},Gl={class:"info"},Hl={class:"list-unstyled"},Jl={class:"time"},Wl=["src"],Xl={class:"subtitle"},Yl={key:0},Zl={class:"info"},xl={class:"list-unstyled"},en={class:"time"},tn=le({__name:"ContactListItem",props:{item:{},index:{},selectedIds:{},shiftEffectingIds:{},shouldSelect:{type:Boolean},isPhone:{type:Boolean},dataType:{},callLoading:{type:Boolean},callId:{},callIndex:{},handleItemClick:{type:Function},handleMouseOver:{type:Function},toggleSelect:{type:Function}},emits:["deleteItem","edit","addItemToTags","call"],setup(I,{emit:v}){const f=v;function a(e){f("deleteItem",e)}function g(e){f("edit",e)}function L(e){f("addItemToTags",e)}function q(e,p,V){f("call",e,p,V)}function U(e){let p="";de(e.firstName)||de(e.lastName)?p=`${e.lastName}${e.middleName}${e.firstName}`:p=[e.firstName,e.middleName,e.lastName].filter(S=>S).join(" ");const V=e.suffix?`, ${e.suffix}`:"",M=`${e.prefix} ${p} ${V}`.trim();return M||(e.emails.length?e.emails[0].value:"")}return(e,p)=>{const V=He,M=xt,S=El,A=wt,E=Zt,Q=$e,P=Yt,D=he("tooltip");return e.isPhone?(l(),C(P,{key:1,"is-selected":e.selectedIds.includes(e.item.id),"is-selecting":e.shiftEffectingIds.includes(e.item.id),"checkbox-checked":e.shiftEffectingIds.includes(e.item.id)?e.shouldSelect:e.selectedIds.includes(e.item.id),onClick:p[4]||(p[4]=t=>e.handleItemClick(t,e.item,e.index,()=>{})),onMouseenter:p[5]||(p[5]=B(t=>e.handleMouseOver(t,e.index),["stop"])),onCheckboxClick:p[6]||(p[6]=t=>e.toggleSelect(t,e.item,e.index))},{image:y(()=>[e.item.thumbnailId?(l(),s("img",{key:0,class:"image",src:n(qe)(e.item.thumbnailId),width:"50"},null,8,Wl)):(l(),C(S,{key:1,class:"image"}))]),title:y(()=>[F(d(U(e.item)),1)]),subtitle:y(()=>[m("div",Xl,[e.item.notes?(l(),s("span",Yl,d(e.item.notes),1)):N("",!0),c(A,{tags:e.item.tags,type:e.dataType,"only-links":!0},null,8,["tags","type"])]),m("div",Zl,[m("ul",xl,[(l(!0),s($,null,w(e.item.phoneNumbers,(t,k)=>(l(),s("li",{key:k,class:"phone-number"},[F(d(t.type>0?e.$t(`contact.phone_number_type.${t.type}`):t.label)+" "+d(t.normalizedNumber||t.value)+" ",1),K((l(),C(Q,{loading:e.callLoading&&e.callId===e.item.id&&e.callIndex===k,onClick:B(j=>q(e.item.id,t.normalizedNumber||t.value,k),["stop"])},{default:y(()=>[c(E)]),_:2},1032,["loading","onClick"])),[[D,e.$t("make_a_phone_call")]])]))),128)),(l(!0),s($,null,w(e.item.emails,t=>(l(),s("li",{key:t.type+t.value},d(t.type>0?e.$t(`contact.email_type.${t.type}`):t.label)+" "+d(t.value),1))),128)),(l(!0),s($,null,w(e.item.addresses,t=>(l(),s("li",{key:t.type+t.value},d(t.type>0?e.$t(`contact.address_type.${t.type}`):t.label)+" "+d(t.value),1))),128)),(l(!0),s($,null,w(e.item.websites,t=>(l(),s("li",{key:t.type+t.value},d(t.type>0?e.$t(`contact.website_type.${t.type}`):t.label)+" "+d(t.value),1))),128)),(l(!0),s($,null,w(e.item.ims,t=>(l(),s("li",{key:t.type+t.value},d(t.type>0?e.$t(`contact.im_type.${t.type}`):t.label)+" "+d(t.value),1))),128)),(l(!0),s($,null,w(e.item.events,t=>(l(),s("li",{key:t.type+t.value},d(t.type>0?e.$t(`contact.event_type.${t.type}`):t.label)+" "+d(t.value),1))),128))])]),m("div",en,[K((l(),s("span",null,[F(d(n(Le)(e.item.updatedAt)),1)])),[[D,n(Se)(e.item.updatedAt)]])])]),actions:y(()=>[c(Ee,{item:e.item,onDeleteItem:a,onEdit:g,onAddItemToTags:L},null,8,["item"])]),_:1},8,["is-selected","is-selecting","checkbox-checked"])):(l(),s("section",{key:0,class:Re(["contact-item selectable-card",{selected:e.selectedIds.includes(e.item.id),selecting:e.shiftEffectingIds.includes(e.item.id)}]),onClick:p[2]||(p[2]=B(t=>e.handleItemClick(t,e.item,e.index,()=>{}),["stop"])),onMouseenter:p[3]||(p[3]=B(t=>e.handleMouseOver(t,e.index),["stop"]))},[m("div",Ol,[e.shiftEffectingIds.includes(e.item.id)?(l(),C(V,{key:0,class:"checkbox","touch-target":"wrapper",checked:e.shouldSelect,onClick:p[0]||(p[0]=B(t=>e.toggleSelect(t,e.item,e.index),["stop"]))},null,8,["checked"])):(l(),C(V,{key:1,class:"checkbox","touch-target":"wrapper",checked:e.selectedIds.includes(e.item.id),onClick:p[1]||(p[1]=B(t=>e.toggleSelect(t,e.item,e.index),["stop"]))},null,8,["checked"])),m("span",Pl,[c(M,{id:e.index+1,raw:e.item},null,8,["id","raw"])])]),e.item.thumbnailId?(l(),s("img",{key:0,class:"image",src:n(qe)(e.item.thumbnailId),width:"50"},null,8,jl)):(l(),C(S,{key:1,class:"image"})),m("div",Kl,d(U(e.item)),1),m("div",Ql,[e.item.notes?(l(),s("span",Rl,d(e.item.notes),1)):N("",!0),c(A,{tags:e.item.tags,type:e.dataType,"only-links":!0},null,8,["tags","type"])]),m("div",Gl,[m("ul",Hl,[(l(!0),s($,null,w(e.item.phoneNumbers,(t,k)=>(l(),s("li",{key:k,class:"phone-number"},[F(d(t.type>0?e.$t(`contact.phone_number_type.${t.type}`):t.label)+" "+d(t.normalizedNumber||t.value)+" ",1),K((l(),C(Q,{loading:e.callLoading&&e.callId===e.item.id&&e.callIndex===k,onClick:B(j=>q(e.item.id,t.normalizedNumber||t.value,k),["stop"])},{default:y(()=>[c(E)]),_:2},1032,["loading","onClick"])),[[D,e.$t("make_a_phone_call")]])]))),128)),(l(!0),s($,null,w(e.item.emails,t=>(l(),s("li",{key:t.type+t.value},d(t.type>0?e.$t(`contact.email_type.${t.type}`):t.label)+" "+d(t.value),1))),128)),(l(!0),s($,null,w(e.item.addresses,t=>(l(),s("li",{key:t.type+t.value},d(t.type>0?e.$t(`contact.address_type.${t.type}`):t.label)+" "+d(t.value),1))),128)),(l(!0),s($,null,w(e.item.websites,t=>(l(),s("li",{key:t.type+t.value},d(t.type>0?e.$t(`contact.website_type.${t.type}`):t.label)+" "+d(t.value),1))),128)),(l(!0),s($,null,w(e.item.ims,t=>(l(),s("li",{key:t.type+t.value},d(t.type>0?e.$t(`contact.im_type.${t.type}`):t.label)+" "+d(t.value),1))),128)),(l(!0),s($,null,w(e.item.events,t=>(l(),s("li",{key:t.type+t.value},d(t.type>0?e.$t(`contact.event_type.${t.type}`):t.label)+" "+d(t.value),1))),128))])]),c(Ee,{item:e.item,onDeleteItem:a,onEdit:g,onAddItemToTags:L},null,8,["item"]),m("div",Jl,[K((l(),s("span",null,[F(d(n(Le)(e.item.updatedAt)),1)])),[[D,n(Se)(e.item.updatedAt)]])])],34))}}}),ln=Ge(tn,[["__scopeId","data-v-a4d9bd26"]]),nn={class:"top-app-bar"},on={class:"title"},sn={key:0},an={key:1},dn={class:"actions"},un={class:"scroll-content"},rn={key:0,class:"no-data-placeholder"},te=50,cn=le({__name:"ContactsView",setup(I){var Ie;const v=At("isPhone"),f=Vt(),{app:a}=Tt(It()),g=G([]),{t:L}=Ke(),{parseQ:q,buildQ:U}=Xt(),e=je({tagIds:[]}),p=Nt.CONTACT,V=qt(),M=V.query,S=G(parseInt(((Ie=M.page)==null?void 0:Ie.toString())??"1")),A=G([]),E=G(""),{tags:Q,fetch:P}=Jt(p),{addToTags:D}=Wt(p,Q),{deleteItems:t}=_t(Kt,()=>{r(),Z(),x.emit("refetch_tags",p)}),{selectedIds:k,allChecked:j,realAllChecked:O,selectRealAll:re,allCheckedAlertVisible:o,clearSelection:r,toggleAllChecked:b,toggleSelect:Y,total:z,checked:R,shiftEffectingIds:H,handleItemClick:se,handleMouseOver:ce,selectAll:me,shouldSelect:pe}=vt(g),u=i=>{const h=V.query.q;Me(f,h?`/contacts?page=${i}&q=${h}`:`/contacts?page=${i}`)},{keyDown:T,keyUp:_}=ft(z,te,S,me,r,u,()=>{t(k.value,O.value,z.value,E.value)}),{loading:_e,fetch:Z}=St({handle:(i,h)=>{h?Ue(L(h),"error"):i&&(g.value=i.contacts,z.value=i.contactCount)},document:Ft,variables:()=>({offset:(S.value-1)*te,limit:te,query:E.value})});Lt({handle:(i,h)=>{h?Ue(L(h),"error"):i&&(A.value=i.contactSources)},document:Dt,variables:null});const ke=i=>{i.type===p&&(r(),Z())},Ce=i=>{i.type===p&&Z()};function Je(i){ie(Ot,{type:p,tags:Q.value,item:{key:i.id,title:"",size:0},selected:Q.value.filter(h=>i.tags.some(J=>J.id===h.id))})}function We(i){let h="";de(i.firstName)||de(i.lastName)?h=`${i.lastName}${i.middleName}${i.firstName}`:h=[i.firstName,i.middleName,i.lastName].filter(ne=>ne).join(" ");const J=i.suffix?`, ${i.suffix}`:"",ae=`${i.prefix} ${h} ${J}`.trim();return ae||(i.emails.length?i.emails[0].value:"")}function Xe(i){ie(Pt,{id:i.id,name:We(i),gql:ye`
      mutation DeleteContact($query: String!) {
        deleteContacts(query: $query)
      }
    `,variables:()=>({query:`ids:${i.id}`}),typeName:"Contact",done:()=>{z.value--,i.tags.length&&x.emit("refetch_tags",p)}})}function Ye(i){ie(Ae,{data:i,sources:A,done:Z})}function Ze(){ie(Ae,{data:null,sources:A,done:Z})}function we(i){return i?`/contacts?q=${i}`:"/contacts"}const Ve=G(""),Te=G(0),{mutate:xe,loading:et}=fe({document:zt});function tt(i,h,J){Ve.value=i,Te.value=J,xe({number:h})}function lt(i){Object.assign(e,i),Me(f,we(U(e)))}return Ut(()=>{var i;E.value=jt(((i=M.q)==null?void 0:i.toString())??""),q(e,E.value),P(),Z(),x.on("item_tags_updated",Ce),x.on("items_tags_updated",ke),window.addEventListener("keydown",T),window.addEventListener("keyup",_)}),Mt(()=>{x.off("item_tags_updated",Ce),x.off("items_tags_updated",ke),window.removeEventListener("keydown",T),window.removeEventListener("keyup",_)}),(i,h)=>{const J=He,ae=be,ne=$e,nt=Bt,ot=Qe,st=Qt,at=ge,it=Gt,dt=Rt,ut=nl,rt=mt,ve=he("tooltip");return l(),s($,null,[m("div",nn,[c(J,{"touch-target":"wrapper",checked:n(j),indeterminate:!n(j)&&n(R),onChange:n(b)},null,8,["checked","indeterminate","onChange"]),m("div",on,[n(k).length?(l(),s("span",sn,d(i.$t("x_selected",{count:n(O)?n(z).toLocaleString():n(k).length.toLocaleString()})),1)):(l(),s("span",an,d(i.$t("page_title.contacts"))+" ("+d(n(z).toLocaleString())+")",1)),n(R)?(l(),s($,{key:2},[K((l(),C(ne,{onClick:h[0]||(h[0]=B(W=>n(t)(n(k),n(O),n(z),E.value),["stop"]))},{default:y(()=>[c(ae)]),_:1})),[[ve,i.$t("delete")]]),K((l(),C(ne,{style:{display:"none"}},{default:y(()=>[c(nt)]),_:1})),[[ve,i.$t("download")]]),K((l(),C(ne,{onClick:h[1]||(h[1]=B(W=>n(D)(n(k),n(O),E.value),["stop"]))},{default:y(()=>[c(ot)]),_:1})),[[ve,i.$t("add_to_tags")]])],64)):N("",!0)]),m("div",dn,[c(st,{filter:e,tags:n(Q),"get-url":we,"show-chips":!n(v),"is-phone":n(v)},null,8,["filter","tags","show-chips","is-phone"]),c(at,{class:"btn-sm",onClick:Ze},{default:y(()=>[F(d(i.$t("create")),1)]),_:1})])]),n(v)?(l(),C(it,{key:0,class:"mobile-search-filters",filter:e,tags:n(Q),feeds:[],buckets:[],types:[],onFilterChange:lt},null,8,["filter","tags"])):N("",!0),c(dt,{limit:te,total:n(z),"all-checked-alert-visible":n(o),"real-all-checked":n(O),"select-real-all":n(re),"clear-selection":n(r)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),m("div",un,[m("div",{class:Re(["main-list",{"select-mode":n(R)}])},[(l(!0),s($,null,w(g.value,(W,ct)=>(l(),C(ln,{key:W.id,item:W,index:ct,"selected-ids":n(k),"shift-effecting-ids":n(H),"should-select":n(pe),"is-phone":n(v),"data-type":n(p),"call-loading":n(et),"call-id":Ve.value,"call-index":Te.value,"handle-item-click":n(se),"handle-mouse-over":n(ce),"toggle-select":n(Y),onDeleteItem:Xe,onEdit:Ye,onAddItemToTags:Je,onCall:tt},null,8,["item","index","selected-ids","shift-effecting-ids","should-select","is-phone","data-type","call-loading","call-id","call-index","handle-item-click","handle-mouse-over","toggle-select"]))),128)),n(_e)&&g.value.length===0?(l(),s($,{key:0},w(20,W=>c(ut,{key:W,index:W,"is-phone":n(v)},null,8,["index","is-phone"])),64)):N("",!0)],2),!n(_e)&&g.value.length===0?(l(),s("div",rn,d(i.$t(n(Et)(n(_e),n(a).permissions,"WRITE_CONTACTS"))),1)):N("",!0),n(z)>te?(l(),C(rt,{key:1,page:S.value,go:u,total:n(z),limit:te},null,8,["page","total"])):N("",!0)])],64)}}}),wn=Ge(cn,[["__scopeId","data-v-0bb21f25"]]);export{wn as default};
