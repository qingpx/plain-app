import{_ as xe}from"./VPagination.vuevuetypescriptsetuptruelang-CtZ5V9Jf.js";import{_ as et,b as tt,a as st}from"./SearchInput-CF-4dkNd.js";import{a5 as te,e as Q,r as q,c as m,o,Z as E,k as _,L as S,M as W,K as k,q as y,ah as nt,G as ne,$ as se,O as oe,t as l,J as $e,a,d as ot,H as K,ai as it,aj as lt,z as v,a8 as at,ak as be,l as t,n as ge,al as he,R as j,s as fe,g as dt,am as ct,an as pt,f as ut,u as rt,T as mt,V as _t,ao as gt,U as ht,i as ve,W as ke,X as ft,Y as vt,j as F,p as kt,ap as yt,aq as wt,a0 as $t,B as ye,ar as bt,as as Ct,F as H,at as It,au as St,av as At,aw as Ut,ax as Pt,a4 as Dt}from"./index-CHzD12Eh.js";import{_ as Ce}from"./VCheckbox-DmONehvd.js";import{_ as Bt,u as Lt,a as Et}from"./key-events-Cs6jhw6G.js";import{u as Ft}from"./search-BS0At8Rs.js";import{_ as Mt,a as Vt}from"./upload-rounded-CoC6T1sY.js";import{_ as qt}from"./ListItemPhone.vuevuetypescriptsetuptruelang-Dd9W6-pF.js";import{_ as Nt}from"./FieldId.vuevuetypescriptsetuptruelang-zWKC_VfW.js";import"./search-rounded-CsaI7Cic.js";const M=w=>{te.emit("tap_phone",w)};function Tt(w,u){const i=w.findIndex(r=>r.id===u);i!==-1&&w.splice(i,1)}const Kt=["onClick"],Qt=Q({__name:"AppsActionButtons",props:{filter:{},types:{},getUrl:{type:Function},showChips:{type:Boolean},isPhone:{type:Boolean},sorting:{type:Boolean},sortItems:{},appSortBy:{}},emits:["install","sort"],setup(w,{emit:u}){const i=u,r=q(!1);function $(){i("install")}function b(d){i("sort",d)}return(d,e)=>{const p=et,A=Mt,C=ne,I=Vt,U=nt,c=W("tooltip");return o(),m(E,null,[_(p,{filter:d.filter,types:d.types,"get-url":d.getUrl,"show-chips":d.showChips,"is-phone":d.isPhone},null,8,["filter","types","get-url","show-chips","is-phone"]),S((o(),k(C,{onClick:$},{default:y(()=>[_(A)]),_:1})),[[c,d.$t("install_app")]]),_(U,{modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=g=>r.value=g)},{trigger:y(()=>[S((o(),k(C,{loading:d.sorting},{default:y(()=>[_(I)]),_:1},8,["loading"])),[[c,d.$t("sort")]])]),default:y(()=>[(o(!0),m(E,null,se(d.sortItems,g=>(o(),m("div",{key:g.value,class:oe(["dropdown-item",{selected:g.value===d.appSortBy}]),onClick:P=>{b(g.value),r.value=!1}},l(d.$t(g.label)),11,Kt))),128))]),_:1},8,["modelValue"])],64)}}}),Gt=$e(Qt,[["__scopeId","data-v-1beb52e9"]]),zt={key:0,class:"app-item selectable-card-skeleton"},Ot={class:"start"},Rt={class:"number"},jt=Q({__name:"AppSkeletonItem",props:{index:{},isPhone:{type:Boolean}},setup(w){return(u,i)=>{const r=Bt;return u.isPhone?(o(),k(r,{key:1,"title-width":"70%",subtitles:[{width:"45%"},{width:"30%"},{width:"40%"},{width:"40%"}],"action-count":2})):(o(),m("section",zt,[a("div",Ot,[i[0]||(i[0]=a("div",{class:"skeleton-checkbox"},null,-1)),a("span",Rt,l(u.index),1)]),i[1]||(i[1]=ot('<div class="image"><div class="skeleton-image lg"></div></div><div class="title"><div class="skeleton-text lg" style="width:40%;"></div></div><div class="subtitle"><div class="skeleton-text" style="width:55%;"></div></div><div class="actions"><div class="skeleton-text lg" style="width:60px;"></div></div><div class="time"><div class="skeleton-text" style="width:120px;"></div><div class="skeleton-text" style="width:120px;"></div></div>',5))]))}}}),Ht={class:"actions"},we=Q({__name:"AppActionButtons",props:{item:{}},emits:["uninstall","download","cancelUninstall"],setup(w,{emit:u}){const i=u;function r(){i("uninstall")}function $(){i("download")}function b(){i("cancelUninstall")}return(d,e)=>{const p=it,A=lt,C=at,I=ne,U=be,c=W("tooltip");return o(),m("div",Ht,[d.item.isUninstalling?(o(),m(E,{key:0},[S(_(p,{indeterminate:"",class:"sm"},null,512),[[c,d.$t("uninstalling")]]),e[0]||(e[0]=K(" Â ")),_(A,{class:"btn-sm",onClick:v(b,["stop"])},{default:y(()=>[K(l(d.$t("cancel")),1)]),_:1})],64)):(o(),m(E,{key:1},[S((o(),k(I,{class:"sm",onClick:v(r,["stop"])},{default:y(()=>[_(C)]),_:1})),[[c,d.$t("uninstall")]]),S((o(),k(I,{class:"sm",onClick:v($,["stop"])},{default:y(()=>[_(U)]),_:1})),[[c,d.$t("download")]])],64))])}}}),Wt={class:"start"},Yt={class:"number"},Jt=["src"],Xt={class:"title"},Zt={class:"subtitle"},xt={class:"actions"},es={class:"time"},ts=["src"],ss={class:"subtitle"},ns={class:"subtitle"},os={class:"subtitle"},is={class:"subtitle"},ls=Q({__name:"AppListItem",props:{item:{},index:{},selectedIds:{},shiftEffectingIds:{},shouldSelect:{type:Boolean},isPhone:{type:Boolean},handleItemClick:{type:Function},handleMouseOver:{type:Function},toggleSelect:{type:Function}},emits:["uninstall","download","cancelUninstall"],setup(w,{emit:u}){const i=w,r=u;function $(){r("uninstall",i.item)}function b(){r("download",i.item)}function d(){r("cancelUninstall",i.item)}return(e,p)=>{const A=Ce,C=Nt,I=qt,U=W("tooltip");return e.isPhone?(o(),k(I,{key:1,"is-selected":e.selectedIds.includes(e.item.id),"is-selecting":e.shiftEffectingIds.includes(e.item.id),"checkbox-checked":e.shiftEffectingIds.includes(e.item.id)?e.shouldSelect:e.selectedIds.includes(e.item.id),onClick:p[4]||(p[4]=c=>e.handleItemClick(c,e.item,e.index,()=>{})),onMouseenter:p[5]||(p[5]=v(c=>e.handleMouseOver(c,e.index),["stop"])),onCheckboxClick:p[6]||(p[6]=c=>e.toggleSelect(c,e.item,e.index))},{image:y(()=>[a("img",{class:"image",src:e.item.icon},null,8,ts)]),title:y(()=>[K(l(e.item.name)+" ("+l(e.item.version)+")",1)]),subtitle:y(()=>[a("div",ss,l(e.item.id),1),a("div",ns,[a("span",null,l(t(ge)(e.item.size)),1),a("span",null,l(e.$t("app_type."+e.item.type)),1)]),a("div",os,l(e.$t("installed_at"))+": "+l(t(j)(e.item.installedAt)),1),a("div",is,l(e.$t("updated_at"))+": "+l(t(j)(e.item.updatedAt)),1)]),actions:y(()=>[_(we,{item:e.item,"is-phone":e.isPhone,onUninstall:$,onDownload:b,onCancelUninstall:d},null,8,["item","is-phone"])]),_:1},8,["is-selected","is-selecting","checkbox-checked"])):(o(),m("section",{key:0,class:oe(["app-item selectable-card",{selected:e.selectedIds.includes(e.item.id),selecting:e.shiftEffectingIds.includes(e.item.id)}]),onClick:p[2]||(p[2]=v(c=>e.handleItemClick(c,e.item,e.index,()=>{}),["stop"])),onMouseenter:p[3]||(p[3]=v(c=>e.handleMouseOver(c,e.index),["stop"]))},[a("div",Wt,[e.shiftEffectingIds.includes(e.item.id)?(o(),k(A,{key:0,class:"checkbox","touch-target":"wrapper",checked:e.shouldSelect,onClick:p[0]||(p[0]=v(c=>e.toggleSelect(c,e.item,e.index),["stop"]))},null,8,["checked"])):(o(),k(A,{key:1,class:"checkbox","touch-target":"wrapper",checked:e.selectedIds.includes(e.item.id),onClick:p[1]||(p[1]=v(c=>e.toggleSelect(c,e.item,e.index),["stop"]))},null,8,["checked"])),a("span",Yt,[_(C,{id:e.index+1,raw:e.item},null,8,["id","raw"])])]),a("img",{class:"image",width:"50",height:"50",src:e.item.icon},null,8,Jt),a("div",Xt,l(e.item.name)+" ("+l(e.item.version)+")",1),a("div",Zt,[a("span",null,l(e.item.id),1),a("span",null,l(t(ge)(e.item.size)),1),a("span",null,l(e.$t("app_type."+e.item.type)),1)]),a("div",xt,[_(we,{item:e.item,"is-phone":e.isPhone,onUninstall:$,onDownload:b,onCancelUninstall:d},null,8,["item","is-phone"])]),a("div",es,[S((o(),m("span",null,[K(l(e.$t("installed_at"))+": "+l(t(j)(e.item.installedAt)),1)])),[[U,t(he)(e.item.installedAt)]]),S((o(),m("span",null,[K(l(e.$t("updated_at"))+": "+l(t(j)(e.item.updatedAt)),1)])),[[U,t(he)(e.item.updatedAt)]])])],34))}}}),as={class:"top-app-bar"},ds={class:"title"},cs={key:0},ps={key:1},us={key:0,class:"actions"},rs={key:0,class:"no-data-placeholder"},V=50,ms=Q({__name:"AppsView",setup(w){var _e;const u=kt("isPhone"),i=q([]),{app:r,urlTokenKey:$,uploads:b}=fe(dt()),{input:d,upload:e,uploadChanged:p}=ct(b),{dropping:A,fileDragEnter:C,fileDragLeave:I,dropFiles:U}=pt(b),c=ut(),g=q([]),{t:P}=rt(),{appSortBy:G}=fe(c),{parseQ:Ie,buildQ:Se}=Ft(),N=mt({tagIds:[]}),Ae=yt(),Y=q(!1),ie=_t(),le=ie.query,J=q(parseInt(((_e=le.page)==null?void 0:_e.toString())??"1")),z=q(""),{selectedIds:O,allChecked:ae,realAllChecked:X,selectRealAll:Ue,allCheckedAlertVisible:Pe,clearSelection:Z,toggleAllChecked:De,toggleSelect:Be,total:B,checked:R,shiftEffectingIds:Le,handleItemClick:Ee,handleMouseOver:Fe,selectAll:Me,shouldSelect:Ve}=Lt(g),{downloadItems:qe}=gt($,ht.PACKAGE,Z,()=>Pt("apps")),{downloadFile:Ne}=Ut($),x=s=>{const n=ie.query.q;ye(c,n?`/apps?page=${s}&q=${n}`:`/apps?page=${s}`)},{keyDown:de,keyUp:ce}=Et(B,V,J,Me,Z,x,()=>{}),Te=()=>{e(r.value.downloadsDir)},{mutate:Ke}=ve({document:bt}),pe=["user","system"].map(s=>({id:s,name:P("app_type."+s)})),Qe=s=>{s.isUninstalling=!1},{loading:ee,fetch:ue}=ke({handle:(s,n)=>{Y.value=!1,n?H(P(n),"error"):s&&(g.value=s.packages.map(h=>({...h,isUninstalling:!1,icon:It($.value,"pkgicon://"+h.id)})),B.value=s.packageCount)},document:Ct,variables:()=>({offset:(J.value-1)*V,limit:V,query:z.value,sortBy:G.value})});function re(s){return s?`/apps?q=${s}`:"/apps"}function Ge(s){G.value!==s&&(Y.value=!0,G.value=s,x(1))}function ze(s){Object.assign(N,s);const n=Se(N);ye(c,re(n))}const{mutate:Oe}=ve({document:St});function Re(s){s.isUninstalling=!0,M(P("confirm_uninstallation_on_phone")),Oe({id:s.id})}function je(s){Ne(s.path,`${s.name.replace(" ","")}-${s.id}.apk`)}const{loading:He,fetch:We}=ke({handle:s=>{if(s)for(const n of s.packageStatuses){const h=i.value.find(D=>D.id===n.id);if(h){const D=h.isNew&&n.exist,T=!h.isNew&&n.exist&&h.updatedAt<n.updatedAt;(D||T)&&(i.value=i.value.filter(L=>L.id!==n.id),M(""),D?H(P("app_installation_completed")):H(P("app_upgrade_completed")),ue())}else n.exist||(Tt(g.value,n.id),M(""))}},document:At,variables:()=>({ids:[...g.value.filter(s=>s.isUninstalling).map(s=>s.id),...i.value.map(s=>s.id)]})}),me=s=>{s.status==="done"&&Ke({path:s.dir+"/"+s.fileName}).then(n=>{if(M(P("confirm_installation_on_phone")),n&&n.data&&n.data.installPackage){const{packageName:h,updatedAt:D,isNew:T}=n.data.installPackage;h&&(i.value.push({id:h,updatedAt:D,isNew:T}),setTimeout(()=>{i.value.some(L=>L.id===h)&&(i.value=i.value.filter(L=>L.id!==h),M(""))},12e4))}}).catch(n=>{M(""),H(P("app_installation_failed")+": "+n.message,"error")})};function Ye(s){U(s,r.value.downloadsDir,n=>n.name.endsWith(".apk"))}return ft(()=>{var s;setInterval(()=>{(g.value.some(n=>n.isUninstalling)||i.value.length>0)&&!He.value&&We()},1e3),z.value=Dt(((s=le.q)==null?void 0:s.toString())??""),Ie(N,z.value),ue(),te.on("upload_task_done",me),window.addEventListener("keydown",de),window.addEventListener("keyup",ce)}),vt(()=>{te.off("upload_task_done",me),window.removeEventListener("keydown",de),window.removeEventListener("keyup",ce)}),(s,n)=>{const h=Ce,D=be,T=ne,L=st,Je=xe,Xe=W("tooltip");return o(),m(E,null,[a("div",as,[_(h,{"touch-target":"wrapper",checked:t(ae),indeterminate:!t(ae)&&t(R),onChange:t(De)},null,8,["checked","indeterminate","onChange"]),a("div",ds,[t(O).length?(o(),m("span",cs,l(s.$t("x_selected",{count:t(X)?t(B).toLocaleString():t(O).length.toLocaleString()})),1)):(o(),m("span",ps,l(s.$t("page_title.apps"))+" ("+l(t(B).toLocaleString())+")",1)),t(R)?S((o(),k(T,{key:2,onClick:n[0]||(n[0]=v(f=>t(qe)(t(X),t(O),z.value),["stop"]))},{default:y(()=>[_(D)]),_:1})),[[Xe,s.$t("download")]]):F("",!0)]),!t(u)||!t(R)?(o(),m("div",us,[_(Gt,{filter:N,types:t(pe),"get-url":re,"show-chips":!t(u),"is-phone":t(u),sorting:Y.value,"sort-items":t(Ae),"app-sort-by":t(G),onInstall:Te,onSort:Ge},null,8,["filter","types","show-chips","is-phone","sorting","sort-items","app-sort-by"])])):F("",!0)]),t(u)?(o(),k(tt,{key:0,class:"mobile-search-filters",filter:N,tags:[],feeds:[],buckets:[],types:t(pe),onFilterChange:ze},null,8,["filter","types"])):F("",!0),_(L,{limit:V,total:t(B),"all-checked-alert-visible":t(Pe),"real-all-checked":t(X),"select-real-all":t(Ue),"clear-selection":t(Z)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),a("div",{class:"scroll-content",onDragover:n[3]||(n[3]=v((...f)=>t(C)&&t(C)(...f),["stop","prevent"]))},[S(a("div",{class:"drag-mask",onDrop:v(Ye,["stop","prevent"]),onDragleave:n[1]||(n[1]=v((...f)=>t(I)&&t(I)(...f),["stop","prevent"]))},l(s.$t("release_to_send_files")),545),[[wt,t(A)]]),a("div",{class:oe(["main-list",{"select-mode":t(R)}])},[(o(!0),m(E,null,se(g.value,(f,Ze)=>(o(),k(ls,{key:f.id,item:f,index:Ze,"selected-ids":t(O),"shift-effecting-ids":t(Le),"should-select":t(Ve),"is-phone":t(u),"handle-item-click":t(Ee),"handle-mouse-over":t(Fe),"toggle-select":t(Be),onUninstall:Re,onDownload:je,onCancelUninstall:Qe},null,8,["item","index","selected-ids","shift-effecting-ids","should-select","is-phone","handle-item-click","handle-mouse-over","toggle-select"]))),128)),t(ee)&&g.value.length===0?(o(),m(E,{key:0},se(20,f=>_(jt,{key:f,index:f,"is-phone":t(u)},null,8,["index","is-phone"])),64)):F("",!0)],2),!t(ee)&&g.value.length===0?(o(),m("div",rs,l(s.$t(t($t)(t(ee),t(r).permissions,"QUERY_ALL_PACKAGES"))),1)):F("",!0),t(B)>V?(o(),k(Je,{key:1,page:J.value,go:x,total:t(B),limit:V},null,8,["page","total"])):F("",!0),a("input",{ref_key:"fileInput",ref:d,style:{display:"none"},type:"file",accept:".apk",multiple:"",onChange:n[2]||(n[2]=(...f)=>t(p)&&t(p)(...f))},null,544)],32)],64)}}}),Cs=$e(ms,[["__scopeId","data-v-28023857"]]);export{Cs as default};
