var Ie=Object.defineProperty;var De=(c,e,a)=>e in c?Ie(c,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):c[e]=a;var I=(c,e,a)=>De(c,typeof e!="symbol"?e+"":e,a);import{m as E,c as l,o,a as i,c5 as Le,c6 as He,d as Ve,u as Ee,r as w,aD as Re,w as Oe,i as z,Z as ze,$ as xe,g as Qe,H as x,t as m,M as d,h as V,a0 as W,O as C,j as f,P as Ae,x as p,k as h,al as Pe,v as Fe,am as Be,c7 as Ue,C as We,au as Ge,I as Ne,an as je,c8 as Je,c9 as Ye,ca as Ze,cb as Ke,cc as Xe,bI as et,cd as tt,ce as nt,R as G,J as T,cf as ot,a7 as D,L as st}from"./index-DZ3IxO2v.js";import{_ as at}from"./more-vert-DoEHTEtM.js";const it={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function rt(c,e){return o(),l("svg",it,e[0]||(e[0]=[i("path",{fill:"currentColor",d:"M12 17.5q1.875 0 3.188-1.312T16.5 13t-1.312-3.187T12 8.5T8.813 9.813T7.5 13t1.313 3.188T12 17.5m0-2q-1.05 0-1.775-.725T9.5 13t.725-1.775T12 10.5t1.775.725T14.5 13t-.725 1.775T12 15.5M4 21q-.825 0-1.412-.587T2 19V7q0-.825.588-1.412T4 5h3.15L8.4 3.65q.275-.3.663-.475T9.875 3h4.25q.425 0 .813.175t.662.475L16.85 5H20q.825 0 1.413.588T22 7v12q0 .825-.587 1.413T20 21z"},null,-1)]))}const lt=E({name:"material-symbols-photo-camera-rounded",render:rt}),ct={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function dt(c,e){return o(),l("svg",ct,e[0]||(e[0]=[i("path",{fill:"currentColor",d:"M6 18H4q-.425 0-.712-.288T3 17t.288-.712T4 16h3q.425 0 .713.288T8 17v3q0 .425-.288.713T7 21t-.712-.288T6 20zm12 0v2q0 .425-.288.713T17 21t-.712-.288T16 20v-3q0-.425.288-.712T17 16h3q.425 0 .713.288T21 17t-.288.713T20 18zM6 6V4q0-.425.288-.712T7 3t.713.288T8 4v3q0 .425-.288.713T7 8H4q-.425 0-.712-.288T3 7t.288-.712T4 6zm12 0h2q.425 0 .713.288T21 7t-.288.713T20 8h-3q-.425 0-.712-.288T16 7V4q0-.425.288-.712T17 3t.713.288T18 4z"},null,-1)]))}const ut=E({name:"material-symbols-fullscreen-exit-rounded",render:dt}),pt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function ht(c,e){return o(),l("svg",pt,e[0]||(e[0]=[i("path",{fill:"currentColor",d:"M5 19h2q.425 0 .713.288T8 20t-.288.713T7 21H4q-.425 0-.712-.288T3 20v-3q0-.425.288-.712T4 16t.713.288T5 17zm14 0v-2q0-.425.288-.712T20 16t.713.288T21 17v3q0 .425-.288.713T20 21h-3q-.425 0-.712-.288T16 20t.288-.712T17 19zM5 5v2q0 .425-.288.713T4 8t-.712-.288T3 7V4q0-.425.288-.712T4 3h3q.425 0 .713.288T8 4t-.288.713T7 5zm14 0h-2q-.425 0-.712-.288T16 4t.288-.712T17 3h3q.425 0 .713.288T21 4v3q0 .425-.288.713T20 8t-.712-.288T19 7z"},null,-1)]))}const _t=E({name:"material-symbols-fullscreen-rounded",render:ht}),mt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function ft(c,e){return o(),l("svg",mt,e[0]||(e[0]=[i("path",{fill:"currentColor",d:"m9.55 15.15l8.475-8.475q.3-.3.7-.3t.7.3t.3.713t-.3.712l-9.175 9.2q-.3.3-.7.3t-.7-.3L4.55 13q-.3-.3-.288-.712t.313-.713t.713-.3t.712.3z"},null,-1)]))}const vt=E({name:"material-symbols-check-rounded",render:ft}),gt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Tt(c,e){return o(),l("svg",gt,e[0]||(e[0]=[i("path",{fill:"currentColor",d:"M6 16V8q0-.825.588-1.412T8 6h8q.825 0 1.413.588T18 8v8q0 .825-.587 1.413T16 18H8q-.825 0-1.412-.587T6 16"},null,-1)]))}const yt=E({name:"material-symbols-stop-rounded",render:Tt}),wt={xmlns:"http://www.w3.org/2000/svg",viewBox:"176.31 -11.19 346.88 581.88"};function Ct(c,e){return o(),l("svg",wt,e[0]||(e[0]=[i("path",{d:"M470.49 0H229.51a41.9 41.9 0 0 0-29.547 12.277 41.9 41.9 0 0 0-12.277 29.547v476.35a41.9 41.9 0 0 0 12.277 29.547 41.9 41.9 0 0 0 29.547 12.277h240.98a41.9 41.9 0 0 0 29.547-12.277 41.9 41.9 0 0 0 12.277-29.547V41.824a41.9 41.9 0 0 0-12.277-29.547A41.9 41.9 0 0 0 470.49 0m33.25 518.18a33.33 33.33 0 0 1-9.766 23.484 33.34 33.34 0 0 1-23.484 9.766H229.51a33.33 33.33 0 0 1-23.484-9.766 33.34 33.34 0 0 1-9.765-23.484V41.83a33.33 33.33 0 0 1 9.828-23.371 33.32 33.32 0 0 1 23.422-9.703h240.98a33.33 33.33 0 0 1 23.484 9.765 33.34 33.34 0 0 1 9.765 23.484z"},null,-1),i("path",{d:"M317.62 46.812h64.75c2.418 0 4.375-1.957 4.375-4.375s-1.957-4.375-4.375-4.375h-64.75c-2.418 0-4.375 1.957-4.375 4.375s1.957 4.375 4.375 4.375M364.7 192.5a16.8 16.8 0 0 0-14.7-8.75 16.8 16.8 0 0 0-14.698 8.75l-91 157.5a16.45 16.45 0 0 0 0 16.977 16.6 16.6 0 0 0 6.101 6.386 16.65 16.65 0 0 0 8.512 2.364h182.09a16.626 16.626 0 0 0 14.7-8.75 16.8 16.8 0 0 0 0-16.977zm83.562 170.36a8.22 8.22 0 0 1-7.262 4.2H258.91a8.23 8.23 0 0 1-7.176-4.2 8.75 8.75 0 0 1 0-8.75l91-157.5a8.75 8.75 0 0 1 7.262-4.113 8.76 8.76 0 0 1 7.262 4.199l91 157.5a8.75 8.75 0 0 1 0 8.84z"},null,-1),i("path",{d:"M350 221.55a4.29 4.29 0 0 0-4.29 4.285v66.238a4.375 4.375 0 0 0 8.75 0v-66.238a4.286 4.286 0 0 0-4.46-4.285m0 91.26a4.29 4.29 0 0 0-4.29 4.29v17.061a4.375 4.375 0 0 0 8.75 0V317.1a4.286 4.286 0 0 0-4.46-4.29"},null,-1)]))}const St={render:Ct};class kt{constructor(e){I(this,"pc",null);I(this,"options");I(this,"audioEnabled",!1);I(this,"remoteDescriptionSet",!1);I(this,"pendingIceCandidates",[]);this.options=e}async startSession(e,a=!0){this.audioEnabled=e,this.cleanup(),this.remoteDescriptionSet=!1,this.pendingIceCandidates=[];const r={iceServers:[],iceCandidatePoolSize:0};if(this.pc=new RTCPeerConnection(r),this.pc.ontrack=n=>{if(n.streams&&n.streams.length>0)this.options.onStream(n.streams[0]);else{const v=new MediaStream;v.addTrack(n.track),this.options.onStream(v)}},this.pc.onicecandidate=n=>{n.candidate&&this.options.sendSignaling({type:"ice_candidate",candidate:n.candidate.candidate,sdpMid:n.candidate.sdpMid??void 0,sdpMLineIndex:n.candidate.sdpMLineIndex??void 0})},this.pc.onconnectionstatechange=()=>{this.pc&&this.options.onConnectionStateChange(this.pc.connectionState)},this.pc.oniceconnectionstatechange=()=>{var n;console.log("ICE connection state:",(n=this.pc)==null?void 0:n.iceConnectionState)},this.pc.addTransceiver("video",{direction:"recvonly"}),e&&this.pc.addTransceiver("audio",{direction:"recvonly"}),a)try{const n=await this.pc.createOffer();await this.pc.setLocalDescription(n),this.options.sendSignaling({type:"offer",sdp:n.sdp,sdpMid:e?"audio_enabled":"audio_disabled"})}catch(n){this.options.onError(`Failed to create offer: ${n}`)}else this.options.sendSignaling({type:"ready"})}async handleOffer(e){if(!this.pc){console.error("PeerConnection not initialized");return}try{const a=new RTCSessionDescription({type:"offer",sdp:e});await this.pc.setRemoteDescription(a),this.remoteDescriptionSet=!0,await this.flushPendingIceCandidates();const r=await this.pc.createAnswer();await this.pc.setLocalDescription(r),this.options.sendSignaling({type:"answer",sdp:r.sdp})}catch(a){this.options.onError(`Failed to handle offer: ${a}`)}}async handleAnswer(e){if(!this.pc){console.error("PeerConnection not initialized");return}try{const a=new RTCSessionDescription({type:"answer",sdp:e});await this.pc.setRemoteDescription(a),this.remoteDescriptionSet=!0,await this.flushPendingIceCandidates(),console.log("Remote description (answer) set successfully")}catch(a){this.options.onError(`Failed to set remote description: ${a}`)}}async handleIceCandidate(e,a,r){if(!this.pc){console.error("PeerConnection not initialized");return}if(!this.remoteDescriptionSet){this.pendingIceCandidates.push({candidate:e,sdpMid:a,sdpMLineIndex:r});return}try{await this.pc.addIceCandidate(new RTCIceCandidate({candidate:e,sdpMid:a??"",sdpMLineIndex:r??0}))}catch(n){console.error("Failed to add ICE candidate:",n)}}async flushPendingIceCandidates(){var a;const e=this.pendingIceCandidates;this.pendingIceCandidates=[];for(const r of e)try{await((a=this.pc)==null?void 0:a.addIceCandidate(new RTCIceCandidate({candidate:r.candidate,sdpMid:r.sdpMid??"",sdpMLineIndex:r.sdpMLineIndex??0})))}catch(n){console.error("Failed to add buffered ICE candidate:",n)}}sendControlEvent(e){this.options.sendSignaling({type:"control",sdp:JSON.stringify(e)})}setAudioEnabled(e){var a;if(this.audioEnabled=e,this.pc){const r=this.pc.getReceivers();for(const n of r)((a=n.track)==null?void 0:a.kind)==="audio"&&(n.track.enabled=e)}}isAudioEnabled(){return this.audioEnabled}async handleSignalingMessage(e){switch(e.type){case"offer":e.sdp&&await this.handleOffer(e.sdp);break;case"answer":e.sdp&&await this.handleAnswer(e.sdp);break;case"ice_candidate":e.candidate&&await this.handleIceCandidate(e.candidate,e.sdpMid,e.sdpMLineIndex);break;default:console.warn("Unknown signaling message type:",e.type)}}cleanup(){this.remoteDescriptionSet=!1,this.pendingIceCandidates=[],this.pc&&(this.pc.ontrack=null,this.pc.onicecandidate=null,this.pc.onconnectionstatechange=null,this.pc.oniceconnectionstatechange=null,this.pc.close(),this.pc=null)}getConnectionState(){var e;return((e=this.pc)==null?void 0:e.connectionState)??null}}function bt(c){Le.a.mutate({mutation:He,variables:{payload:c}}).catch(e=>{console.error("Failed to send WebRTC signaling via GraphQL:",e)})}const Mt={class:"screen-mirror"},qt={class:"top-app-bar"},$t={class:"title"},It={class:"actions"},Dt={key:1,class:"check-placeholder"},Lt={key:1,class:"check-placeholder"},Ht={key:1,class:"check-placeholder"},Vt={class:"content"},Et={key:0},Rt={key:0,class:"request-permission"},Ot={class:"tap-phone"},zt={class:"text"},xt={key:1,class:"request-permission-failed"},Qt=Ve({__name:"ScreenMirrorView",setup(c){let e;const{t:a}=Ee(),r=Fe("isPhone"),n=w(!1),v=w(0),g=w(!1),M=w(!1),q=w(!1),L=w(),H=w(!1),Q=w(!1),y=w("AUTO"),se={AUTO:"mirror_auto",HD:"mirror_hd",SMOOTH:"mirror_smooth"},ae=Re(()=>a(se[y.value]||"mirror_auto"));let _=null,R=null;const N=async()=>{n.value=!0,g.value=!1,v.value=0,clearInterval(e),Y()},ie=()=>{ge()};Oe(L,t=>{t&&R&&(t.srcObject=R,t.play().catch(()=>{}),R=null)});let k=!1;const{mutate:re}=z({document:Je}),le=()=>{M.value=!M.value;const t=L.value;t&&(M.value?t.pause():t.play().catch(()=>{}))};let O=null;const{mutate:ce,loading:de,onDone:ue}=z({document:Ye});ue(()=>{O!=null&&(y.value=O,O=null),Q.value=!1});const A=t=>{O=t,ce({mode:t})},pe=()=>{re(),k=!0},j=t=>{t&&k&&(k=!1,clearInterval(e),P())},J=()=>{const t=L.value;if(!t)return;const s=document.createElement("canvas");s.width=t.videoWidth,s.height=t.videoHeight;const b=s.getContext("2d");b&&b.drawImage(t,0,0,s.width,s.height);const u=new Date,F="screenshot-"+[u.getFullYear(),u.getMonth()+1,u.getDate(),u.getHours(),u.getMinutes(),u.getSeconds(),u.getMilliseconds()].join("")+".png";ot(s.toDataURL(),F)},he=()=>{_&&_.cleanup(),_=new kt({sendSignaling:t=>{bt(t)},onStream:t=>{q.value=!1;const s=L.value;s?(s.srcObject=t,s.play().catch(()=>{}),n.value=!0,g.value=!1,v.value=0,clearInterval(e)):(R=t,n.value=!0,g.value=!1,v.value=0,clearInterval(e))},onConnectionStateChange:t=>{t==="connected"?q.value=!1:(t==="failed"||t==="disconnected")&&(q.value=!1,g.value=!0)},onError:t=>{q.value=!1,x(t,"error"),g.value=!0}})},Y=()=>{q.value=!0,_==null||_.startSession(!0,!1)},Z=async t=>{_&&await _.handleSignalingMessage(t)};ze(()=>{D.on("screen_mirroring",N),D.on("webrtc_signaling",Z),D.on("app_socket_connection_changed",j),he()}),xe(()=>{D.off("screen_mirroring",N),D.off("webrtc_signaling",Z),D.off("app_socket_connection_changed",j),_&&(_.cleanup(),_=null)});const{mutate:_e,loading:me,onDone:fe,onError:ve}=z({document:Ze}),{loading:K,refetch:ge}=Qe({handle:(t,s)=>{var b;s?x(a(s),"error"):((b=t==null?void 0:t.screenMirrorQuality)!=null&&b.mode&&(y.value=t.screenMirrorQuality.mode),t.screenMirrorState?Y():(n.value=!1,P()))},options:{fetchPolicy:"no-cache"},document:Ke}),X=()=>{document.getElementsByClassName("screen-mirror")[0].requestFullscreen({navigationUI:"show"})},P=()=>{g.value=!1,M.value=!1,_e()},ee=()=>{document.exitFullscreen()};ve(t=>{x(a(t.message)),g.value=!0}),fe(()=>{v.value=30,e=setInterval(()=>{v.value--,v.value<=0&&(g.value=!0,clearInterval(e))},1e3)});const{mutate:Te,loading:ye,onDone:we,onError:Ce}=z({document:Xe});return Ce(t=>{x(a(t.message))}),we(()=>{g.value=!0,n.value=!1,_&&_.cleanup()}),(t,s)=>{const b=et,u=Ne,F=tt,Se=nt,ke=yt,B=je,U=vt,te=Pe,ne=_t,oe=ut,be=at,Me=lt,qe=Be,$e=We,S=Ae("tooltip");return o(),l("div",Mt,[i("div",qt,[i("div",$t,m(t.$t("screen_mirror")),1),i("div",It,[n.value?(o(),l(W,{key:0},[C((o(),d(u,{onClick:ie},{default:p(()=>[f(b)]),_:1})),[[S,t.$t("refresh")]]),C((o(),d(u,{onClick:le},{default:p(()=>[M.value?(o(),d(F,{key:0})):(o(),d(Se,{key:1}))]),_:1})),[[S,t.$t(M.value?"resume":"pause")]]),C((o(),d(u,{disabled:h(ye),class:"btn-stop",onClick:h(Te)},{default:p(()=>[f(ke)]),_:1},8,["disabled","onClick"])),[[S,t.$t("stop_mirror")]]),f(te,{modelValue:Q.value,"onUpdate:modelValue":s[3]||(s[3]=$=>Q.value=$),placement:"auto",align:"top-left-to-bottom-left"},{trigger:p(()=>[C((o(),d(B,{class:"btn-sm",loading:h(de)},{default:p(()=>[T(m(ae.value),1)]),_:1},8,["loading"])),[[S,t.$t("mirror_quality")]])]),default:p(()=>[i("div",{class:G(["dropdown-item",{active:y.value==="AUTO"}]),onClick:s[0]||(s[0]=()=>A("AUTO"))},[y.value==="AUTO"?(o(),d(U,{key:0})):(o(),l("span",Dt)),T(" "+m(t.$t("mirror_auto")),1)],2),i("div",{class:G(["dropdown-item",{active:y.value==="HD"}]),onClick:s[1]||(s[1]=()=>A("HD"))},[y.value==="HD"?(o(),d(U,{key:0})):(o(),l("span",Lt)),T(" "+m(t.$t("mirror_hd")),1)],2),i("div",{class:G(["dropdown-item",{active:y.value==="SMOOTH"}]),onClick:s[2]||(s[2]=()=>A("SMOOTH"))},[y.value==="SMOOTH"?(o(),d(U,{key:0})):(o(),l("span",Ht)),T(" "+m(t.$t("mirror_smooth")),1)],2)]),_:1},8,["modelValue"]),h(r)?V("",!0):(o(),l(W,{key:0},[C((o(),d(B,{class:"btn-sm",onClick:J},{default:p(()=>[T(m(t.$t("screenshot")),1)]),_:1})),[[S,t.$t("screenshot")]]),C((o(),d(u,{class:"btn-enter-fullscreen",onClick:X},{default:p(()=>[f(ne)]),_:1})),[[S,t.$t("fullscreen")]]),C((o(),d(u,{class:"btn-exit-fullscreen",onClick:ee},{default:p(()=>[f(oe)]),_:1})),[[S,t.$t("exit_fullscreen")]])],64)),h(r)?(o(),d(te,{key:1,modelValue:H.value,"onUpdate:modelValue":s[7]||(s[7]=$=>H.value=$)},{trigger:p(()=>[C((o(),d(u,null,{default:p(()=>[f(be)]),_:1})),[[S,t.$t("settings")]])]),default:p(()=>[i("div",{class:"dropdown-item",onClick:s[4]||(s[4]=$=>{J(),H.value=!1})},[f(Me),T(" "+m(t.$t("screenshot")),1)]),i("div",{class:"dropdown-item enter-fullscreen",onClick:s[5]||(s[5]=$=>{X(),H.value=!1})},[f(ne),T(" "+m(t.$t("fullscreen")),1)]),i("div",{class:"dropdown-item exit-fullscreen",onClick:s[6]||(s[6]=$=>{ee(),H.value=!1})},[f(oe),T(" "+m(t.$t("exit_fullscreen")),1)])]),_:1},8,["modelValue"])):V("",!0)],64)):h(k)?V("",!0):(o(),d(B,{key:1,class:"btn-sm",onClick:pe},{default:p(()=>[T(m(t.$t("relaunch_app")),1)]),_:1}))])]),i("div",Vt,[h(K)||h(me)||h(k)||q.value?(o(),l("div",Et,[f(qe,{indeterminate:""})])):(o(),l(W,{key:1},[v.value>0&&!h(k)?(o(),l("div",Rt,[i("div",Ot,[f(h(Ue))]),i("pre",zt,m(t.$t("screen_mirror_request_permission",{seconds:v.value})),1)])):V("",!0),g.value&&!n.value&&!h(k)?(o(),l("div",xt,[f(h(St)),i("p",null,m(t.$t("screen_mirror_request_permission_failed")),1),f($e,{onClick:P},{default:p(()=>[T(m(t.$t("try_again")),1)]),_:1})])):V("",!0)],64)),C(i("video",{ref_key:"videoRef",ref:L,class:"video",autoplay:"",playsinline:"",muted:""},null,512),[[Ge,n.value&&!h(K)]])])])}}}),Bt=st(Qt,[["__scopeId","data-v-2fd5c9f8"]]);export{Bt as default};
