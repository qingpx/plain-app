import{_ as et}from"./VPagination.vuevuetypescriptsetuptruelang-HJQO1ll4.js";import{_ as tt,u as st,b as ot,a as nt}from"./key-events-CkO8GMm9.js";import{e as P,c as u,K as c,o as n,a as m,d as it,t as f,m as at,i as K,bn as lt,T as J,a5 as T,U as W,bo as dt,u as he,Z as L,L as y,M as X,l as t,G as _e,z as _,q as p,k as r,a8 as ve,aN as fe,aR as ye,N as ke,O as $e,bp as ue,Q as rt,R as ut,H as G,S as ce,j as b,f as ct,r as H,V as mt,W as pt,bq as gt,X as ht,Y as _t,p as vt,$ as ft,br as yt,a0 as kt,aj as $t,bs as bt,F as Tt,bt as wt,B as U,a2 as me,a3 as It,ab as qt,bm as Ct,ac as Lt,a6 as pe,a4 as Nt,bu as St,J as Ft}from"./index-B_6OBIiz.js";import{_ as Et,a as Dt,b as Mt}from"./SearchInput-DAKqrHLl.js";import{_ as be}from"./VCheckbox-BMTfinLa.js";import{u as Vt,a as At}from"./tags-Hg4Jkr8z.js";import{u as Bt}from"./search-BMFnu_qU.js";import{_ as Pt}from"./ListItemPhone.vuevuetypescriptsetuptruelang-C7UN6m3-.js";import{_ as Qt}from"./FieldId.vuevuetypescriptsetuptruelang-PGoLF1oK.js";import"./search-rounded-B3UzLU8d.js";const Ot={key:0,class:"note-item selectable-card-skeleton"},zt={class:"start"},Rt={class:"number"},jt=P({__name:"NoteSkeletonItem",props:{index:{},isPhone:{type:Boolean}},setup(k){return(e,o)=>{const i=tt;return e.isPhone?(n(),c(i,{key:1,"title-width":"70%",subtitles:[{width:"45%"},{width:"30%"},{width:"40%"}],"action-count":3})):(n(),u("section",Ot,[m("div",zt,[o[0]||(o[0]=m("div",{class:"skeleton-checkbox"},null,-1)),m("span",Rt,f(e.index),1)]),o[1]||(o[1]=it('<div class="title"><div class="skeleton-text" style="width:40%;"></div><div class="skeleton-text" style="width:40%;margin-block-start:8px;"></div></div><div class="subtitle"><div class="skeleton-text" style="width:30%;"></div></div><div class="actions"><div class="skeleton-text" style="width:140px;"></div></div><div class="time"><div class="skeleton-text" style="width:60px;"></div></div>',4))]))}}}),Ht={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Ut(k,e){return n(),u("svg",Ht,e[0]||(e[0]=[m("path",{fill:"currentColor",d:"M19 17.7v1.8q0 .2.15.35t.35.15t.35-.15t.15-.35v-3q0-.2-.15-.35T19.5 16h-3q-.2 0-.35.15t-.15.35t.15.35t.35.15h1.8l-2.45 2.45q-.15.15-.15.35t.15.35t.35.15t.35-.15zM5 21q-.825 0-1.412-.587T3 19V5q0-.825.588-1.412T5 3h14q.825 0 1.413.588T21 5v5q0 .425-.288.713T20 11t-.712-.288T19 10V5H5v14h5q.425 0 .713.288T11 20t-.288.713T10 21zm0-3v1V5v6.075V11zm2-2q0 .425.288.713T8 17h2.075q.425 0 .713-.288t.287-.712t-.287-.712t-.713-.288H8q-.425 0-.712.288T7 16m0-4q0 .425.288.713T8 13h5q.425 0 .713-.288T14 12t-.288-.712T13 11H8q-.425 0-.712.288T7 12m0-4q0 .425.288.713T8 9h8q.425 0 .713-.288T17 8t-.288-.712T16 7H8q-.425 0-.712.288T7 8m11 15q-2.075 0-3.537-1.463T13 18t1.463-3.537T18 13t3.538 1.463T23 18t-1.463 3.538T18 23"},null,-1)]))}const Gt=at({name:"material-symbols-export-notes-outline-rounded",render:Ut}),Kt=(k,e)=>{const{mutate:o,onDone:i}=K({document:lt}),h=J(new Map);return i(a=>{h.delete(a.data.trashNotes),k(),e(),T.emit("refetch_tags",W.NOTE),T.emit("notes_actioned",{action:"trash"})}),{trashLoading(a){return h.get(a)??!1},trash(a){h.set(a,!0),o({query:a})}}},Jt=(k,e)=>{const{mutate:o,onDone:i}=K({document:dt}),h=J(new Map);return i(a=>{h.delete(a.data.restoreNotes),k(),e(),T.emit("refetch_tags",W.NOTE),T.emit("notes_actioned",{action:"restore"})}),{restoreLoading(a){return h.get(a)??!1},restore(a){h.set(a,!0),o({query:a})}}},Wt={class:"actions"},ge=P({__name:"NoteActionButtons",props:{item:{},filter:{},deleteItem:{type:Function},addItemToTags:{type:Function},restoreLoading:{type:Function},trashLoading:{type:Function},restore:{type:Function},trash:{type:Function}},setup(k){const{t:e}=he();return(o,i)=>{const h=ve,a=_e,D=fe,g=ye,l=ke,w=X("tooltip");return n(),u("div",Wt,[o.filter.trash?(n(),u(L,{key:0},[y((n(),c(a,{class:"sm",onClick:i[0]||(i[0]=_(N=>o.deleteItem(o.item),["stop","prevent"]))},{default:p(()=>[r(h)]),_:1})),[[w,t(e)("delete")]]),y((n(),c(a,{class:"sm",loading:o.restoreLoading(`ids:${o.item.id}`),onClick:i[1]||(i[1]=_(N=>o.restore(`ids:${o.item.id}`),["stop","prevent"]))},{default:p(()=>[r(D)]),_:1},8,["loading"])),[[w,t(e)("restore")]])],64)):(n(),u(L,{key:1},[y((n(),c(a,{class:"sm",loading:o.trashLoading(`ids:${o.item.id}`),onClick:i[2]||(i[2]=_(N=>o.trash(`ids:${o.item.id}`),["stop","prevent"]))},{default:p(()=>[r(g)]),_:1},8,["loading"])),[[w,t(e)("move_to_trash")]]),y((n(),c(a,{class:"sm",onClick:i[3]||(i[3]=_(N=>o.addItemToTags(o.item),["stop","prevent"]))},{default:p(()=>[r(l)]),_:1})),[[w,t(e)("add_to_tags")]])],64))])}}}),Xt={class:"start"},Yt={class:"number"},Zt={class:"title"},xt={class:"subtitle"},es={class:"actions"},ts={class:"time"},ss={key:0,class:"subtitle"},os={class:"subtitle"},ns={class:"time"},is=P({__name:"NoteListItem",props:{item:{},index:{},selectedIds:{},shiftEffectingIds:{},shouldSelect:{type:Boolean},isPhone:{type:Boolean},filter:{},dataType:{},routeId:{},handleItemClick:{type:Function},handleMouseOver:{type:Function},toggleSelect:{type:Function},view:{type:Function},deleteItem:{type:Function},addItemToTags:{type:Function},restoreLoading:{type:Function},trashLoading:{type:Function},restore:{type:Function},trash:{type:Function}},setup(k){return(e,o)=>{const i=be,h=Qt,a=rt,D=Pt,g=X("tooltip");return e.isPhone?(n(),c(D,{key:1,"is-selected":e.selectedIds.includes(e.item.id)||e.item.id==e.routeId,"is-selecting":e.shiftEffectingIds.includes(e.item.id),"checkbox-checked":e.shiftEffectingIds.includes(e.item.id)?e.shouldSelect:e.selectedIds.includes(e.item.id),onClick:o[4]||(o[4]=l=>e.handleItemClick(l,e.item,e.index,()=>e.view(e.item))),onMouseover:o[5]||(o[5]=l=>e.handleMouseOver(l,e.index)),onCheckboxClick:o[6]||(o[6]=l=>e.toggleSelect(l,e.item,e.index))},{title:p(()=>[G(f(t(ue)(e.item.title.split(`
`)[0].trimStart())||e.$t("meta_no_title")),1)]),subtitle:p(()=>[e.item.tags.length>0?(n(),u("div",ss,[r(a,{tags:e.item.tags,type:e.dataType,"only-links":!0},null,8,["tags","type"])])):b("",!0),m("div",os,[m("span",ns,f(t(ce)(e.item.updatedAt)),1)])]),actions:p(()=>[r(ge,{item:e.item,filter:e.filter,"delete-item":e.deleteItem,"add-item-to-tags":e.addItemToTags,"restore-loading":e.restoreLoading,"trash-loading":e.trashLoading,restore:e.restore,trash:e.trash},null,8,["item","filter","delete-item","add-item-to-tags","restore-loading","trash-loading","restore","trash"])]),_:1},8,["is-selected","is-selecting","checkbox-checked"])):(n(),u("section",{key:0,class:$e(["note-item selectable-card",{selected:e.selectedIds.includes(e.item.id)||e.item.id==e.routeId,selecting:e.shiftEffectingIds.includes(e.item.id)}]),onClick:o[2]||(o[2]=_(l=>e.handleItemClick(l,e.item,e.index,()=>e.view(e.item)),["stop","prevent"])),onMouseover:o[3]||(o[3]=l=>e.handleMouseOver(l,e.index))},[m("div",Xt,[e.shiftEffectingIds.includes(e.item.id)?(n(),c(i,{key:0,class:"checkbox","touch-target":"wrapper",checked:e.shouldSelect,onClick:o[0]||(o[0]=_(l=>e.toggleSelect(l,e.item,e.index),["stop"]))},null,8,["checked"])):(n(),c(i,{key:1,class:"checkbox","touch-target":"wrapper",checked:e.selectedIds.includes(e.item.id),onClick:o[1]||(o[1]=_(l=>e.toggleSelect(l,e.item,e.index),["stop"]))},null,8,["checked"])),m("span",Yt,[r(h,{id:e.index+1,raw:e.item},null,8,["id","raw"])])]),m("div",Zt,f(t(ue)(e.item.title.split(`
`)[0].trimStart())||e.$t("meta_no_title")),1),m("div",xt,[r(a,{tags:e.item.tags,type:e.dataType,"only-links":!0},null,8,["tags","type"])]),m("div",es,[r(ge,{item:e.item,filter:e.filter,"delete-item":e.deleteItem,"add-item-to-tags":e.addItemToTags,"restore-loading":e.restoreLoading,"trash-loading":e.trashLoading,restore:e.restore,trash:e.trash},null,8,["item","filter","delete-item","add-item-to-tags","restore-loading","trash-loading","restore","trash"])]),m("div",ts,[y((n(),u("span",null,[G(f(t(ce)(e.item.updatedAt)),1)])),[[g,t(ut)(e.item.updatedAt)]])])],34))}}}),as={class:"top-app-bar"},ls={class:"title"},ds={key:0},rs={key:1},us={class:"actions"},cs={key:1,class:"scroller main-list"},ms=["href"],ps={key:3,class:"no-data-placeholder"},E=50,gs=P({__name:"NotesView",setup(k){var re;const e=vt("isPhone"),o=ct(),i=H([]),{t:h}=he(),{parseQ:a,buildQ:D}=Bt(),g=J({tagIds:[],trash:!1}),l=W.NOTE,w=mt(),N=w.query,Q=H(parseInt(((re=N.page)==null?void 0:re.toString())??"1")),I=H(""),{tags:M,fetch:Te}=Vt(l),{selectedIds:q,allChecked:Y,realAllChecked:S,selectRealAll:we,allCheckedAlertVisible:Ie,clearSelection:C,toggleAllChecked:qe,toggleSelect:Ce,total:v,checked:O,shiftEffectingIds:Le,handleItemClick:Ne,handleMouseOver:Se,selectAll:Fe,shouldSelect:Ee}=st(i),{addToTags:De}=At(l,M),Z=s=>{const d=w.query.q;U(o,d?`/notes?page=${s}&q=${d}`:`/notes?page=${s}`)},{keyDown:x,keyUp:ee}=nt(v,E,Q,Fe,C,Z,()=>{se(q.value,S.value,v.value,I.value)}),{loading:z,fetch:F}=pt({handle:(s,d)=>{d?Tt(h(d),"error"):s&&(i.value=s.notes,v.value=s.noteCount)},document:bt,variables:()=>({offset:(Q.value-1)*E,limit:E,query:I.value})});function Me(s){me(It,{type:l,tags:M.value,item:{key:s.id,title:"",size:0},selected:M.value.filter(d=>s.tags.some(R=>R.id===d.id))})}function te(s){return s?`/notes?q=${s}`:"/notes"}const{mutate:Ve,onDone:Ae}=K({document:wt}),Be=()=>{Ve({query:B()})},B=()=>{let s=I.value;return S.value||(s=`ids:${q.value.join(",")}`),s};Ae(s=>{gt(s.data.exportNotes,"application/json","notes.json")});const{deleteItems:se}=ot(St,()=>{C(),F()});function Pe(s){me(Lt,{id:s.id,name:Ct(s.title,{length:20}),gql:qt`
      mutation DeleteNote($query: String!) {
        deleteNotes(query: $query)
      }
    `,variables:()=>({query:`ids:${s.id}`}),done:()=>{C(),v.value--},typeName:"Note"})}const{trashLoading:Qe,trash:oe}=Kt(C,F),{restoreLoading:ne,restore:ie}=Jt(C,F);function Oe(s){U(o,ae(s))}function ae(s){const d=pe.currentRoute.value.query.q;return d?`/notes/${s.id}?q=${d}`:`/notes/${s.id}`}function ze(){pe.push("/notes/create")}const le=s=>{s.type===l&&(C(),F())},de=s=>{s.type===l&&F()};function Re(s){Object.assign(g,s),U(o,te(D(g)))}return ht(()=>{var s;I.value=Nt(((s=N.q)==null?void 0:s.toString())??""),a(g,I.value),g.trash===void 0&&(g.trash=!1),Te(),F(),T.on("item_tags_updated",de),T.on("items_tags_updated",le),window.addEventListener("keydown",x),window.addEventListener("keyup",ee)}),_t(()=>{T.off("item_tags_updated",de),T.off("items_tags_updated",le),window.removeEventListener("keydown",x),window.removeEventListener("keyup",ee)}),(s,d)=>{const R=be,je=ve,V=_e,He=fe,Ue=ye,Ge=ke,Ke=Gt,Je=Et,We=$t,Xe=Mt,Ye=Dt,Ze=jt,xe=et,A=X("tooltip");return n(),u(L,null,[m("div",as,[r(R,{"touch-target":"wrapper",checked:t(Y),indeterminate:!t(Y)&&t(O),onChange:t(qe)},null,8,["checked","indeterminate","onChange"]),m("div",ls,[t(q).length?(n(),u("span",ds,f(s.$t("x_selected",{count:t(S)?t(v).toLocaleString():t(q).length.toLocaleString()})),1)):(n(),u("span",rs,f(s.$t("page_title.notes"))+" ("+f(t(v).toLocaleString())+")",1)),t(O)?(n(),u(L,{key:2},[g.trash?(n(),u(L,{key:0},[y((n(),c(V,{onClick:d[0]||(d[0]=_($=>t(se)(t(q),t(S),t(v),I.value),["stop"]))},{default:p(()=>[r(je)]),_:1})),[[A,s.$t("delete")]]),y((n(),c(V,{loading:t(ne)(B()),onClick:d[1]||(d[1]=_($=>t(ie)(B()),["stop"]))},{default:p(()=>[r(He)]),_:1},8,["loading"])),[[A,s.$t("restore")]])],64)):(n(),u(L,{key:1},[y((n(),c(V,{onClick:d[2]||(d[2]=_($=>t(oe)(B()),["stop"]))},{default:p(()=>[r(Ue)]),_:1})),[[A,s.$t("move_to_trash")]]),y((n(),c(V,{onClick:d[3]||(d[3]=_($=>t(De)(t(q),t(S),I.value),["stop"]))},{default:p(()=>[r(Ge)]),_:1})),[[A,s.$t("add_to_tags")]]),y((n(),c(V,{onClick:_(Be,["stop"])},{default:p(()=>[r(Ke)]),_:1})),[[A,s.$t("export_notes")]])],64))],64)):b("",!0)]),m("div",us,[r(Je,{filter:g,tags:t(M),"get-url":te,"show-trash":!0,"show-chips":!t(e),"is-phone":t(e)},null,8,["filter","tags","show-chips","is-phone"]),g.trash?b("",!0):(n(),c(We,{key:0,class:"btn-sm",onClick:_(ze,["prevent"])},{default:p(()=>[G(f(s.$t("create")),1)]),_:1}))])]),t(e)?(n(),c(Xe,{key:0,class:"mobile-search-filters",filter:g,tags:t(M),feeds:[],buckets:[],types:[],onFilterChange:Re},null,8,["filter","tags"])):b("",!0),r(Ye,{limit:E,total:t(v),"all-checked-alert-visible":t(Ie),"real-all-checked":t(S),"select-real-all":t(we),"clear-selection":t(C)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),t(z)&&i.value.length===0?(n(),u("div",cs,[(n(),u(L,null,ft(20,$=>r(Ze,{key:$,index:$,"is-phone":t(e)},null,8,["index","is-phone"])),64))])):b("",!0),i.value.length?(n(),c(t(yt),{key:2,class:$e(["scroller main-list",{"select-mode":t(O)}]),"data-key":"id","data-sources":i.value,"estimate-size":100},{item:p(({index:$,item:j})=>[(n(),u("a",{key:j.id,class:"item-link",href:ae(j)},[r(is,{item:j,index:$,"selected-ids":t(q),"shift-effecting-ids":t(Le),"should-select":t(Ee),"is-phone":t(e),filter:g,"data-type":t(l),"route-id":s.$route.params.id,"handle-item-click":t(Ne),"handle-mouse-over":t(Se),"toggle-select":t(Ce),view:Oe,"delete-item":Pe,"add-item-to-tags":Me,"restore-loading":t(ne),"trash-loading":t(Qe),restore:t(ie),trash:t(oe)},null,8,["item","index","selected-ids","shift-effecting-ids","should-select","is-phone","filter","data-type","route-id","handle-item-click","handle-mouse-over","toggle-select","restore-loading","trash-loading","restore","trash"])],8,ms))]),footer:p(()=>[t(v)>E?(n(),c(xe,{key:0,page:Q.value,go:Z,total:t(v),limit:E},null,8,["page","total"])):b("",!0)]),_:1},8,["data-sources","class"])):b("",!0),!t(z)&&i.value.length===0?(n(),u("div",ps,f(s.$t(t(kt)(t(z)))),1)):b("",!0)],64)}}}),Is=Ft(gs,[["__scopeId","data-v-3557439a"]]);export{Is as default};
