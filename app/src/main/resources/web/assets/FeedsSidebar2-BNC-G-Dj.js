import{e as ve,c as r,K as d,o as n,a as o,t as y,u as he,r as F,W as ge,cs as Je,F as D,f as Xe,s as Ze,g as es,T as ss,U as ts,V as os,aT as ue,a6 as _e,i as pe,X as ns,Y as as,j as C,k as c,l as e,Z as fe,L as E,M as ls,q as T,z as g,p as is,$ as cs,br as ds,a0 as rs,cr as us,c3 as _s,G as ps,ct as fs,cu as ms,cv as vs,a8 as hs,N as gs,ai as ks,O as ys,R as bs,H as ws,S as $s,Q as Ss,aH as Cs,B as H,a4 as Ts,a5 as k,cw as Fs,J as Ls}from"./index-CvrCHKkA.js";import{_ as qs}from"./more-vert-BqhhPS58.js";import{_ as Is}from"./FieldId.vuevuetypescriptsetuptruelang-DKF_OuH8.js";import{_ as Es,u as Ds,b as Ms,a as Ns}from"./key-events-Cg-L3lic.js";import{_ as As,a as Qs,b as Bs}from"./SearchInput-C49_KB7r.js";import{_ as Ps,a as Rs}from"./add-notes-outline-rounded-DLd4rau4.js";import{_ as Us}from"./VCheckbox-CPqc2yw_.js";import{u as zs}from"./feeds-Ct4Xmxm0.js";import{a as Vs}from"./tags-CxHgNc-n.js";import{u as Gs}from"./search-1vLN7k3W.js";import"./search-rounded-VyLFfqRH.js";const Hs={key:0,class:"feed-item selectable-card-skeleton"},Ks={class:"subtitle"},Ws={class:"number"},js=ve({__name:"FeedSkeletonItem",props:{index:{},isPhone:{type:Boolean}},setup(M){return(u,l)=>{const b=Es;return u.isPhone?(n(),d(b,{key:1,"title-width":"70%",subtitles:[{width:"45%"},{width:"30%"},{width:"40%"}],"action-count":3})):(n(),r("section",Hs,[l[1]||(l[1]=o("div",{class:"title"},[o("div",{class:"skeleton-checkbox"}),o("div",{class:"skeleton-text text lg",style:{width:"50%"}})],-1)),o("div",Ks,[o("span",Ws,y(u.index),1),l[0]||(l[0]=o("div",{class:"info"},[o("div",{class:"skeleton-text",style:{width:"30%"}})],-1))]),l[2]||(l[2]=o("div",{class:"image"},[o("div",{class:"skeleton-image lg"})],-1))]))}}}),xs=(M,u,l)=>{const{t:b}=he(),_=F(1),p=100,N=F(!1),{loading:R,fetch:m}=ge({handle:(v,A)=>{if(A)D(b(A),"error");else if(v){v.items.length<p&&(N.value=!0);const Q=v.items;_.value===1?M.value=Q:M.value=M.value.concat(Q),l.value=v.total}},document:Je,variables:()=>({offset:(_.value-1)*p,limit:p,query:u.value})});return{page:_,noMore:N,loading:R,fetch:m,loadMore:()=>{N.value||R.value||_.value++}}},Os={class:"top-app-bar"},Ys={class:"title"},Js={key:0},Xs={key:1},Zs={class:"actions"},et={key:1,class:"scroller"},st=["href"],tt=["onClick","onMouseover"],ot={class:"title"},nt={class:"text"},at={class:"subtitle"},lt={class:"number"},it={class:"info"},ct=["onClick"],dt={class:"time"},rt=["src"],ut={key:3,class:"no-data-placeholder"},me=100,_t=ve({__name:"FeedsSidebar2",setup(M){var de;const u=is("isPhone"),l=Xe(),{feedsSyncing:b}=Ze(es()),{t:_}=he(),p=ss({tagIds:[]}),{parseQ:N,buildQ:R}=Gs(),m=ts.FEED_ENTRY,v=os(),A=v.query,Q=F(parseInt(((de=A.page)==null?void 0:de.toString())??"1")),U=F([]),z=F([]),K=ue(()=>{const s={};return z.value.forEach(t=>{s[t.id]=t}),s}),w=F([]),$=F(""),{selectedIds:f,allChecked:W,realAllChecked:L,selectRealAll:ke,allCheckedAlertVisible:ye,clearSelection:V,toggleAllChecked:be,toggleSelect:j,total:S,checked:x,shiftEffectingIds:O,handleItemClick:we,handleMouseOver:$e,selectAll:Se,shouldSelect:Ce}=Ds(w),Te=s=>{Q.value=s;const t=v.query.q;H(l,t?`/feeds?page=${s}&q=${t}`:`/feeds?page=${s}`)},{keyDown:Y,keyUp:J}=Ns(S,me,Q,Se,V,Te,()=>{ee(f.value,L.value,S.value,$.value)}),{page:X,loading:G,loadMore:Fe,fetch:Le,noMore:Z}=xs(w,$,S),{addToTags:qe}=Vs(m,U),B=()=>{X.value=1,Le()},{deleteItems:ee}=Ms(Fs,()=>{V(),B(),w.value.some(s=>s.tags.length)&&k.emit("refetch_tags",m),k.emit("feed_entries_deleted")}),se=ue(()=>_e.currentRoute.value.path!=="/feeds"),{resizeWidth:te}=us(300,()=>l.sidebar2Width,s=>{l.sidebar2Width=s}),{mutate:oe,loading:Ie,onDone:Ee}=pe({document:fs});function De(){if(L.value)oe({query:$.value});else{if(f.value.length===0){D(_("select_first"),"error");return}oe({query:`ids:${f.value.join(",")}`})}}Ee(()=>{D(_("saved"))});function ne(s){return s?`/feeds?q=${s}`:"/feeds"}const{fetch:Me}=ge({handle:async(s,t)=>{t?D(_(t),"error"):s&&(U.value=s.tags,z.value=s.feeds)},document:ms,variables:{type:m}});function ae(s){const t=_e.currentRoute.value.query.q;return t?`/feeds/${s.feedId}/entries/${s.id}?q=${t}`:`/feeds/${s.feedId}/entries/${s.id}`}function Ne(s){H(l,ae(s))}const{viewFeed:Ae}=zs(l),{mutate:Qe}=pe({document:vs});function Be(){b.value=!0,Qe({id:""})}const le=s=>{b.value=!1,B(),s.error?D(s.error,"error"):D(_("feeds_synced"))},ie=s=>{s.type===m&&(V(),B())},ce=s=>{s.type===m&&B()};function Pe(s){Object.assign(p,s),H(l,ne(R(p)))}return ns(()=>{var t,q;const s=(t=document.getElementsByClassName("scroller"))==null?void 0:t[0];s&&(s.scrollTop=0),$.value=Ts(((q=A.q)==null?void 0:q.toString())??""),N(p,$.value),Me(),B(),k.on("item_tags_updated",ce),k.on("items_tags_updated",ie),k.on("feeds_fetched",le),window.addEventListener("keydown",Y),window.addEventListener("keyup",J)}),as(()=>{X.value=1,Z.value=!1,k.off("item_tags_updated",ce),k.off("items_tags_updated",ie),k.off("feeds_fetched",le),window.removeEventListener("keydown",Y),window.removeEventListener("keyup",J)}),(s,t)=>{const q=Us,Re=hs,P=ps,Ue=gs,ze=Ps,Ve=As,Ge=Rs,He=Bs,Ke=Qs,We=js,je=Is,xe=Ss,Oe=qs,Ye=ks,I=ls("tooltip");return n(),r("aside",{class:"sidebar2",style:_s({width:e(v).params.id?e(l).sidebar2Width+"px":"auto"})},[o("div",Os,[c(q,{"touch-target":"wrapper",checked:e(W),indeterminate:!e(W)&&e(x),onChange:e(be)},null,8,["checked","indeterminate","onChange"]),o("div",Ys,[e(f).length?(n(),r("span",Js,y(s.$t("x_selected",{count:e(L)?e(S).toLocaleString():e(f).length.toLocaleString()})),1)):(n(),r("span",Xs,y(s.$t("page_title.feeds"))+" ("+y(e(S).toLocaleString())+")",1)),e(x)?(n(),r(fe,{key:2},[E((n(),d(P,{onClick:t[0]||(t[0]=g(i=>e(ee)(e(f),e(L),e(S),$.value),["stop"]))},{default:T(()=>[c(Re)]),_:1})),[[I,s.$t("delete")]]),E((n(),d(P,{onClick:t[1]||(t[1]=g(i=>e(qe)(e(f),e(L),$.value),["stop"]))},{default:T(()=>[c(Ue)]),_:1})),[[I,s.$t("add_to_tags")]]),E((n(),d(P,{loading:e(Ie),onClick:g(De,["prevent"])},{default:T(()=>[c(ze)]),_:1},8,["loading"])),[[I,s.$t("save_to_notes")]])],64)):C("",!0)]),o("div",Zs,[c(Ve,{filter:p,tags:U.value,feeds:z.value,"show-chips":!se.value&&!e(u),"get-url":ne,"show-today":!0,"is-phone":e(u)},null,8,["filter","tags","feeds","show-chips","is-phone"]),E((n(),d(P,{loading:e(b),onClick:g(Be,["prevent"])},{default:T(()=>[c(Ge)]),_:1},8,["loading"])),[[I,s.$t("sync_feeds")]])])]),se.value||e(u)?(n(),d(He,{key:0,class:"mobile-search-filters",filter:p,tags:U.value,feeds:z.value,buckets:[],types:[],onFilterChange:Pe},null,8,["filter","tags","feeds"])):C("",!0),c(Ke,{limit:me,total:e(S),"all-checked-alert-visible":e(ye),"real-all-checked":e(L),"select-real-all":e(ke),"clear-selection":e(V)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),e(G)&&w.value.length===0?(n(),r("div",et,[(n(),r(fe,null,cs(20,i=>c(We,{key:i,index:i,"is-phone":e(u)},null,8,["index","is-phone"])),64))])):C("",!0),w.value.length>0?(n(),d(e(ds),{key:2,class:"scroller","data-key":"id","data-sources":w.value,"estimate-size":100,onTobottom:e(Fe)},{item:T(({index:i,item:a})=>{var re;return[o("a",{class:"item-link",href:ae(a)},[o("article",{class:ys(["feed-item selectable-card",{selected:e(f).includes(a.id)||a.id==s.$route.params.id,selecting:e(O).includes(a.id)}]),onClick:g(h=>e(we)(h,a,i,()=>{Ne(a)}),["stop","prevent"]),onMouseover:h=>e($e)(h,i)},[o("div",ot,[e(O).includes(a.id)?(n(),d(q,{key:0,class:"checkbox","touch-target":"wrapper",checked:e(Ce),onClick:g(h=>e(j)(h,a,i),["stop"])},null,8,["checked","onClick"])):(n(),d(q,{key:1,class:"checkbox","touch-target":"wrapper",checked:e(f).includes(a.id),onClick:g(h=>e(j)(h,a,i),["stop"])},null,8,["checked","onClick"])),o("div",nt,y(a.title||s.$t("no_content")),1)]),o("div",at,[o("span",lt,[c(je,{id:i+1,raw:a},null,8,["id","raw"])]),o("div",it,[o("a",{onClick:g(h=>e(Ae)(K.value[a.feedId]),["stop","prevent"])},y((re=K.value[a.feedId])==null?void 0:re.name),9,ct),t[3]||(t[3]=o("span",null,"Â·",-1)),E((n(),r("span",dt,[ws(y(e($s)(a.publishedAt)),1)])),[[I,e(bs)(a.publishedAt)]]),c(xe,{tags:a.tags,type:e(m),"only-links":!0},null,8,["tags","type"])])]),E((n(),d(P,{style:{display:"none"}},{default:T(()=>[c(Oe)]),_:1})),[[I,s.$t("actions")]]),a.image?(n(),r("img",{key:0,class:"image",src:e(Cs)(a.image,"&w=200&h=200")},null,8,rt)):C("",!0)],42,tt)],8,st)]}),footer:T(()=>[e(Z)?C("",!0):(n(),d(Ye,{key:0,indeterminate:"",class:"sm"}))]),_:1},8,["data-sources","onTobottom"])):C("",!0),!e(G)&&w.value.length===0?(n(),r("div",ut,y(s.$t(e(rs)(e(G)))),1)):C("",!0),o("div",{class:"sidebar-drag-indicator",onMousedown:t[2]||(t[2]=(...i)=>e(te)&&e(te)(...i))},null,32)],4)}}}),St=Ls(_t,[["__scopeId","data-v-14d582dc"]]);export{St as default};
