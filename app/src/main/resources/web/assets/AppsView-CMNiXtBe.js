import{_ as Ye}from"./VPagination.vuevuetypescriptsetuptruelang-B7Sa-dGQ.js";import{_ as Je}from"./AllCheckedAlert.vuevuetypescriptsetuptruelang-BaeCK0x8.js";import{a7 as se,d as z,r as E,c as r,o,a0 as F,O as A,j as m,P as J,M as k,x as h,al as We,I as oe,a1 as le,R as ie,t as a,L as ye,a as d,N as Xe,J as Q,am as Ze,an as xe,B as g,ac as et,ao as we,k as t,q as _e,ap as ve,U as H,s as fe,f as tt,aq as nt,ar as st,e as lt,u as ot,a4 as it,as as at,X as dt,i as ge,Y as he,Z as ct,$ as pt,w as ut,h as K,v as rt,at as mt,au as _t,a2 as vt,D as ft,av as gt,aw as ht,H as Y,ax as kt,ay as yt,az as wt,aA as $t,aB as It,a8 as bt}from"./index-DK2k7uUz.js";import{_ as $e}from"./VCheckbox-ChdySfCx.js";import{_ as St,u as Ct,a as At}from"./key-events-DeJMQ3Gp.js";import{_ as Ut,a as Dt}from"./upload-rounded-Dl2klGx3.js";import{_ as Pt}from"./ListItemPhone.vuevuetypescriptsetuptruelang-QRqCHaZt.js";import{_ as Bt}from"./FieldId.vuevuetypescriptsetuptruelang-BCKfQAtO.js";const N=y=>{se.emit("tap_phone",y)};function Lt(y,_){const l=y.findIndex(u=>u.id===_);l!==-1&&y.splice(l,1)}const Et=["onClick"],Ft=z({__name:"AppsActionButtons",props:{sorting:{type:Boolean},sortItems:{},appSortBy:{}},emits:["install","sort"],setup(y,{emit:_}){const l=_,u=E(!1);function w(){l("install")}function $(p){l("sort",p)}return(p,e)=>{const c=Ut,I=oe,U=Dt,b=We,S=J("tooltip");return o(),r(F,null,[A((o(),k(I,{onClick:w},{default:h(()=>[m(c)]),_:1})),[[S,p.$t("install_app")]]),m(b,{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=i=>u.value=i)},{trigger:h(()=>[A((o(),k(I,{loading:p.sorting},{default:h(()=>[m(U)]),_:1},8,["loading"])),[[S,p.$t("sort")]])]),default:h(()=>[(o(!0),r(F,null,le(p.sortItems,i=>(o(),r("div",{key:i.value,class:ie(["dropdown-item",{selected:i.value===p.appSortBy}]),onClick:C=>{$(i.value),u.value=!1}},a(p.$t(i.label)),11,Et))),128))]),_:1},8,["modelValue"])],64)}}}),Mt=ye(Ft,[["__scopeId","data-v-0cf682e0"]]),Nt={key:0,class:"app-item selectable-card-skeleton"},qt={class:"start"},Vt={class:"number"},Tt=z({__name:"AppSkeletonItem",props:{index:{},isPhone:{type:Boolean}},setup(y){return(_,l)=>{const u=St;return _.isPhone?(o(),k(u,{key:1,"title-width":"70%",subtitles:[{width:"45%"},{width:"30%"},{width:"40%"},{width:"40%"}],"action-count":2})):(o(),r("section",Nt,[d("div",qt,[l[0]||(l[0]=d("div",{class:"skeleton-checkbox"},null,-1)),d("span",Vt,a(_.index),1)]),l[1]||(l[1]=Xe('<div class="image"><div class="skeleton-image lg"></div></div><div class="title"><div class="skeleton-text lg" style="width:40%;"></div></div><div class="subtitle"><div class="skeleton-text" style="width:55%;"></div></div><div class="actions"><div class="skeleton-text lg" style="width:60px;"></div></div><div class="time"><div class="skeleton-text" style="width:120px;"></div><div class="skeleton-text" style="width:120px;"></div></div>',5))]))}}}),Kt={class:"actions"},ke=z({__name:"AppActionButtons",props:{item:{}},emits:["uninstall","download","cancelUninstall"],setup(y,{emit:_}){const l=_;function u(){l("uninstall")}function w(){l("download")}function $(){l("cancelUninstall")}return(p,e)=>{const c=Ze,I=xe,U=et,b=oe,S=we,i=J("tooltip");return o(),r("div",Kt,[p.item.isUninstalling?(o(),r(F,{key:0},[A(m(c,{indeterminate:"",class:"sm"},null,512),[[i,p.$t("uninstalling")]]),e[0]||(e[0]=Q(" Â ")),m(I,{class:"btn-sm",onClick:g($,["stop"])},{default:h(()=>[Q(a(p.$t("cancel")),1)]),_:1})],64)):(o(),r(F,{key:1},[A((o(),k(b,{class:"sm",onClick:g(u,["stop"])},{default:h(()=>[m(U)]),_:1})),[[i,p.$t("uninstall")]]),A((o(),k(b,{class:"sm",onClick:g(w,["stop"])},{default:h(()=>[m(S)]),_:1})),[[i,p.$t("download")]])],64))])}}}),Qt={class:"start"},zt={class:"number"},Gt=["src"],Rt={class:"title"},Ot={class:"subtitle"},jt={class:"actions"},Ht={class:"time"},Yt=["src"],Jt={class:"subtitle"},Wt={class:"subtitle"},Xt={class:"subtitle"},Zt={class:"subtitle"},xt=z({__name:"AppListItem",props:{item:{},index:{},selectedIds:{},shiftEffectingIds:{},shouldSelect:{type:Boolean},isPhone:{type:Boolean},handleItemClick:{type:Function},handleMouseOver:{type:Function},toggleSelect:{type:Function}},emits:["uninstall","download","cancelUninstall"],setup(y,{emit:_}){const l=y,u=_;function w(){u("uninstall",l.item)}function $(){u("download",l.item)}function p(){u("cancelUninstall",l.item)}return(e,c)=>{const I=$e,U=Bt,b=Pt,S=J("tooltip");return e.isPhone?(o(),k(b,{key:1,"is-selected":e.selectedIds.includes(e.item.id),"is-selecting":e.shiftEffectingIds.includes(e.item.id),"checkbox-checked":e.shiftEffectingIds.includes(e.item.id)?e.shouldSelect:e.selectedIds.includes(e.item.id),onClick:c[4]||(c[4]=i=>e.handleItemClick(i,e.item,e.index,()=>{})),onMouseenter:c[5]||(c[5]=g(i=>e.handleMouseOver(i,e.index),["stop"])),onCheckboxClick:c[6]||(c[6]=i=>e.toggleSelect(i,e.item,e.index))},{image:h(()=>[d("img",{class:"image",src:e.item.icon},null,8,Yt)]),title:h(()=>[Q(a(e.item.name)+" ("+a(e.item.version)+")",1)]),subtitle:h(()=>[d("div",Jt,a(e.item.id),1),d("div",Wt,[d("span",null,a(t(_e)(e.item.size)),1),d("span",null,a(e.$t("app_type."+e.item.type)),1)]),d("div",Xt,a(e.$t("installed_at"))+": "+a(t(H)(e.item.installedAt)),1),d("div",Zt,a(e.$t("updated_at"))+": "+a(t(H)(e.item.updatedAt)),1)]),actions:h(()=>[m(ke,{item:e.item,"is-phone":e.isPhone,onUninstall:w,onDownload:$,onCancelUninstall:p},null,8,["item","is-phone"])]),_:1},8,["is-selected","is-selecting","checkbox-checked"])):(o(),r("section",{key:0,class:ie(["app-item selectable-card",{selected:e.selectedIds.includes(e.item.id),selecting:e.shiftEffectingIds.includes(e.item.id)}]),onClick:c[2]||(c[2]=g(i=>e.handleItemClick(i,e.item,e.index,()=>{}),["stop"])),onMouseenter:c[3]||(c[3]=g(i=>e.handleMouseOver(i,e.index),["stop"]))},[d("div",Qt,[e.shiftEffectingIds.includes(e.item.id)?(o(),k(I,{key:0,class:"checkbox","touch-target":"wrapper",checked:e.shouldSelect,onClick:c[0]||(c[0]=g(i=>e.toggleSelect(i,e.item,e.index),["stop"]))},null,8,["checked"])):(o(),k(I,{key:1,class:"checkbox","touch-target":"wrapper",checked:e.selectedIds.includes(e.item.id),onClick:c[1]||(c[1]=g(i=>e.toggleSelect(i,e.item,e.index),["stop"]))},null,8,["checked"])),d("span",zt,[m(U,{id:e.index+1,raw:e.item},null,8,["id","raw"])])]),d("img",{class:"image",width:"50",height:"50",src:e.item.icon},null,8,Gt),d("div",Rt,a(e.item.name)+" ("+a(e.item.version)+")",1),d("div",Ot,[d("span",null,a(e.item.id),1),d("span",null,a(t(_e)(e.item.size)),1),d("span",null,a(e.$t("app_type."+e.item.type)),1)]),d("div",jt,[m(ke,{item:e.item,"is-phone":e.isPhone,onUninstall:w,onDownload:$,onCancelUninstall:p},null,8,["item","is-phone"])]),d("div",Ht,[A((o(),r("span",null,[Q(a(e.$t("installed_at"))+": "+a(t(H)(e.item.installedAt)),1)])),[[S,t(ve)(e.item.installedAt)]]),A((o(),r("span",null,[Q(a(e.$t("updated_at"))+": "+a(t(H)(e.item.updatedAt)),1)])),[[S,t(ve)(e.item.updatedAt)]])])],34))}}}),en={class:"top-app-bar"},tn={class:"title"},nn={key:0},sn={key:1},ln={key:0,class:"actions"},on={key:0,class:"no-data-placeholder"},q=50,an=z({__name:"AppsView",setup(y){var me;const _=rt("isPhone"),l=E([]),{app:u,urlTokenKey:w,uploads:$}=fe(tt()),{input:p,upload:e,uploadChanged:c}=nt($),{dropping:I,fileDragEnter:U,fileDragLeave:b,dropFiles:S}=st($),i=lt(),C=E([]),{t:M}=ot(),{appSortBy:G}=fe(i),Ie=mt(),W=E(!1),V=it(),R=E(parseInt(((me=V.query.page)==null?void 0:me.toString())??"1")),X=E(""),Z=E(!1);let P;const{selectedIds:O,allChecked:ae,realAllChecked:x,selectRealAll:be,allCheckedAlertVisible:Se,clearSelection:ee,toggleAllChecked:Ce,toggleSelect:Ae,total:B,checked:j,shiftEffectingIds:Ue,handleItemClick:De,handleMouseOver:Pe,selectAll:Be,shouldSelect:Le}=Ct(C),{downloadItems:Ee}=at(w,dt.PACKAGE,ee,()=>It("apps")),{downloadFile:Fe}=$t(w),te=n=>{const s=V.query.q;ft(i,s?`/apps?page=${n}&q=${s}`:`/apps?page=${n}`)},{keyDown:de,keyUp:ce}=At(B,q,R,Be,ee,te,()=>{}),Me=()=>{e(u.value.downloadsDir)},{mutate:Ne}=ge({document:gt}),qe=n=>{n.isUninstalling=!1},{loading:ne,fetch:pe}=he({handle:(n,s)=>{W.value=!1,s?Y(M(s),"error"):n&&(C.value=n.packages.map(v=>({...v,isUninstalling:!1,icon:kt(w.value,"pkgicon://"+v.id)})),B.value=n.packageCount)},document:ht,variables:()=>({offset:(R.value-1)*q,limit:q,query:X.value,sortBy:G.value})});function Ve(n){G.value!==n&&(W.value=!0,G.value=n,te(1))}function ue(){var n,s;Z.value&&(R.value=parseInt(((n=V.query.page)==null?void 0:n.toString())??"1"),X.value=bt(((s=V.query.q)==null?void 0:s.toString())??""),pe())}const{mutate:Te}=ge({document:yt});function Ke(n){n.isUninstalling=!0,N(M("confirm_uninstallation_on_phone")),Te({id:n.id})}function Qe(n){Fe(n.path,`${n.name.replace(" ","")}-${n.id}.apk`)}const{loading:ze,fetch:Ge}=he({handle:n=>{if(n)for(const s of n.packageStatuses){const v=l.value.find(D=>D.id===s.id);if(v){const D=v.isNew&&s.exist,T=!v.isNew&&s.exist&&v.updatedAt<s.updatedAt;(D||T)&&(l.value=l.value.filter(L=>L.id!==s.id),N(""),D?Y(M("app_installation_completed")):Y(M("app_upgrade_completed")),pe())}else s.exist||(Lt(C.value,s.id),N(""))}},document:wt,variables:()=>({ids:[...C.value.filter(n=>n.isUninstalling).map(n=>n.id),...l.value.map(n=>n.id)]})}),re=n=>{n.status==="done"&&Ne({path:n.dir+"/"+n.fileName}).then(s=>{if(N(M("confirm_installation_on_phone")),s&&s.data&&s.data.installPackage){const{packageName:v,updatedAt:D,isNew:T}=s.data.installPackage;v&&(l.value.push({id:v,updatedAt:D,isNew:T}),setTimeout(()=>{l.value.some(L=>L.id===v)&&(l.value=l.value.filter(L=>L.id!==v),N(""))},12e4))}}).catch(s=>{N(""),Y(M("app_installation_failed")+": "+s.message,"error")})};function Re(n){S(n,u.value.downloadsDir,s=>s.name.endsWith(".apk"))}return ct(()=>{Z.value=!0,P&&(clearInterval(P),P=void 0),P=window.setInterval(()=>{(C.value.some(n=>n.isUninstalling)||l.value.length>0)&&!ze.value&&Ge()},1e3),ue(),se.on("upload_task_done",re),window.addEventListener("keydown",de),window.addEventListener("keyup",ce)}),pt(()=>{Z.value=!1,P&&(clearInterval(P),P=void 0),se.off("upload_task_done",re),window.removeEventListener("keydown",de),window.removeEventListener("keyup",ce)}),ut(()=>V.fullPath,()=>{ue()}),(n,s)=>{const v=$e,D=we,T=oe,L=Je,Oe=Ye,je=J("tooltip");return o(),r(F,null,[d("div",en,[m(v,{"touch-target":"wrapper",checked:t(ae),indeterminate:!t(ae)&&t(j),onChange:t(Ce)},null,8,["checked","indeterminate","onChange"]),d("div",tn,[t(O).length?(o(),r("span",nn,a(n.$t("x_selected",{count:t(x)?t(B).toLocaleString():t(O).length.toLocaleString()})),1)):(o(),r("span",sn,a(n.$t("page_title.apps"))+" ("+a(t(B).toLocaleString())+")",1)),t(j)?A((o(),k(T,{key:2,onClick:s[0]||(s[0]=g(f=>t(Ee)(t(x),t(O),X.value),["stop"]))},{default:h(()=>[m(D)]),_:1})),[[je,n.$t("download")]]):K("",!0)]),!t(_)||!t(j)?(o(),r("div",ln,[m(Mt,{sorting:W.value,"sort-items":t(Ie),"app-sort-by":t(G),onInstall:Me,onSort:Ve},null,8,["sorting","sort-items","app-sort-by"])])):K("",!0)]),m(L,{limit:q,total:t(B),"all-checked-alert-visible":t(Se),"real-all-checked":t(x),"select-real-all":t(be),"clear-selection":t(ee)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),d("div",{class:"scroll-content",onDragover:s[3]||(s[3]=g((...f)=>t(U)&&t(U)(...f),["stop","prevent"]))},[A(d("div",{class:"drag-mask",onDrop:g(Re,["stop","prevent"]),onDragleave:s[1]||(s[1]=g((...f)=>t(b)&&t(b)(...f),["stop","prevent"]))},a(n.$t("release_to_send_files")),545),[[_t,t(I)]]),d("div",{class:ie(["main-list",{"select-mode":t(j)}])},[(o(!0),r(F,null,le(C.value,(f,He)=>(o(),k(xt,{key:f.id,item:f,index:He,"selected-ids":t(O),"shift-effecting-ids":t(Ue),"should-select":t(Le),"is-phone":t(_),"handle-item-click":t(De),"handle-mouse-over":t(Pe),"toggle-select":t(Ae),onUninstall:Ke,onDownload:Qe,onCancelUninstall:qe},null,8,["item","index","selected-ids","shift-effecting-ids","should-select","is-phone","handle-item-click","handle-mouse-over","toggle-select"]))),128)),t(ne)&&C.value.length===0?(o(),r(F,{key:0},le(20,f=>m(Tt,{key:f,index:f,"is-phone":t(_)},null,8,["index","is-phone"])),64)):K("",!0)],2),!t(ne)&&C.value.length===0?(o(),r("div",on,a(n.$t(t(vt)(t(ne),t(u).permissions,"QUERY_ALL_PACKAGES"))),1)):K("",!0),t(B)>q?(o(),k(Oe,{key:1,page:R.value,go:te,total:t(B),limit:q},null,8,["page","total"])):K("",!0),d("input",{ref_key:"fileInput",ref:p,style:{display:"none"},type:"file",accept:".apk",multiple:"",onChange:s[2]||(s[2]=(...f)=>t(c)&&t(c)(...f))},null,544)],32)],64)}}}),fn=ye(an,[["__scopeId","data-v-f01c2449"]]);export{fn as default};
