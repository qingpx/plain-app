import{_ as Fe}from"./VPagination.vuevuetypescriptsetuptruelang-CwPgzRnc.js";import{_ as He,u as Ue,a as Ne}from"./key-events-DYvieyDS.js";import{e as q,c as r,K as _,o,a,d as Oe,t as p,L,M as R,G as ae,z as b,q as $,k as m,N as le,O as ie,l as s,P as x,Q as Qe,R as ee,H as O,S as se,J as de,f as Re,s as Ke,g as ze,r as B,u as je,T as Ge,U as Je,V as We,W as Xe,i as Ye,X as Ze,Y as xe,j as C,p as es,Z as Q,$ as te,a0 as ss,a1 as ts,F as ns,I as os,B as ne,a2 as as,a3 as ls,a4 as is,a5 as P}from"./index-BMu8GHeM.js";import{_ as ds}from"./ListItemPhone.vuevuetypescriptsetuptruelang-BGFOlDQm.js";import{_ as cs}from"./FieldId.vuevuetypescriptsetuptruelang-DsS2BrsR.js";import{_ as ce}from"./VCheckbox-DWBGPCja.js";import{_ as ms}from"./call-outline-rounded-CrxXvdLA.js";import{_ as rs,a as ps,b as us}from"./SearchInput-yOq3VWVw.js";import{u as gs,a as _s}from"./tags-Bqm7GRsN.js";import{u as hs}from"./search-CkyBk6nh.js";import"./search-rounded-D7zDCqc2.js";const fs={key:0,class:"sms-item selectable-card-skeleton"},vs={class:"start"},ks={class:"number"},ys=q({__name:"MessageSkeletonItem",props:{index:{},isPhone:{type:Boolean}},setup(M){return(d,i)=>{const h=He;return d.isPhone?(o(),_(h,{key:1,"title-width":"70%",image:!1,subtitles:[{width:"45%"},{width:"30%"},{width:"40%"}],"action-count":2})):(o(),r("section",fs,[a("div",vs,[i[0]||(i[0]=a("div",{class:"skeleton-checkbox"},null,-1)),a("span",ks,p(d.index),1)]),i[1]||(i[1]=Oe('<div class="title"><div class="skeleton-text lg" style="width:120px;"></div></div><div class="subtitle"><div class="skeleton-text" style="width:80%;"></div><div class="skeleton-text" style="width:80%;margin-block-start:8px;"></div></div><div class="actions"><div class="skeleton-text" style="width:140px;"></div></div><div class="info"><div class="skeleton-text" style="width:60px;"></div></div><div class="time"><div class="skeleton-text" style="width:60px;"></div></div>',5))]))}}}),Is={class:"actions"},oe=q({__name:"MessageActionButtons",props:{item:{},callLoading:{type:Boolean},callId:{}},emits:["addItemToTags","call"],setup(M,{emit:d}){const i=M,h=d;function u(){h("addItemToTags",i.item)}function e(){h("call",i.item)}return(n,w)=>{const f=le,c=ae,y=ms,v=R("tooltip");return o(),r("div",Is,[L((o(),_(c,{onClick:b(u,["stop"])},{default:$(()=>[m(f)]),_:1})),[[v,n.$t("add_to_tags")]]),L((o(),_(c,{loading:n.callLoading&&n.callId===n.item.id,onClick:b(e,["stop"])},{default:$(()=>[m(y)]),_:1},8,["loading"])),[[v,n.$t("make_a_phone_call")]])])}}}),Ts={class:"start"},bs={class:"number"},$s={class:"title"},ws=["innerHTML"],Ss={class:"info"},Cs={class:"time"},Ls=["innerHTML"],Ms={class:"info"},As={class:"time"},Es=q({__name:"MessageListItem",props:{item:{},index:{},selectedIds:{},shiftEffectingIds:{},shouldSelect:{type:Boolean},isPhone:{type:Boolean},dataType:{},callLoading:{type:Boolean},callId:{},handleItemClick:{type:Function},handleMouseOver:{type:Function},toggleSelect:{type:Function}},emits:["addItemToTags","call"],setup(M,{emit:d}){const i=d;function h(e){i("addItemToTags",e)}function u(e){i("call",e)}return(e,n)=>{const w=ce,f=cs,c=Qe,y=ds,v=R("tooltip");return e.isPhone?(o(),_(y,{key:1,"is-selected":e.selectedIds.includes(e.item.id),"is-selecting":e.shiftEffectingIds.includes(e.item.id),"checkbox-checked":e.shiftEffectingIds.includes(e.item.id)?e.shouldSelect:e.selectedIds.includes(e.item.id),onClick:n[4]||(n[4]=l=>e.handleItemClick(l,e.item,e.index,()=>{})),onMouseover:n[5]||(n[5]=l=>e.handleMouseOver(l,e.index)),onCheckboxClick:n[6]||(n[6]=l=>e.toggleSelect(l,e.item,e.index))},{title:$(()=>[O(p(e.item.address),1)]),subtitle:$(()=>[a("div",{class:"subtitle",innerHTML:s(x)(e.item.body)},null,8,Ls),a("div",Ms,[a("span",null,p(e.$t(`message_type.${e.item.type}`)),1),m(c,{tags:e.item.tags,type:e.dataType,"only-links":!0},null,8,["tags","type"])]),a("div",As,[L((o(),r("span",null,[O(p(s(se)(e.item.date)),1)])),[[v,s(ee)(e.item.date)]])])]),actions:$(()=>[m(oe,{item:e.item,"call-loading":e.callLoading,"call-id":e.callId,onAddItemToTags:h,onCall:u},null,8,["item","call-loading","call-id"])]),_:1},8,["is-selected","is-selecting","checkbox-checked"])):(o(),r("section",{key:0,class:ie(["sms-item selectable-card",{selected:e.selectedIds.includes(e.item.id),selecting:e.shiftEffectingIds.includes(e.item.id)}]),onClick:n[2]||(n[2]=b(l=>e.handleItemClick(l,e.item,e.index,()=>{}),["stop"])),onMouseover:n[3]||(n[3]=l=>e.handleMouseOver(l,e.index))},[a("div",Ts,[e.shiftEffectingIds.includes(e.item.id)?(o(),_(w,{key:0,class:"checkbox","touch-target":"wrapper",checked:e.shouldSelect,onClick:n[0]||(n[0]=b(l=>e.toggleSelect(l,e.item,e.index),["stop"]))},null,8,["checked"])):(o(),_(w,{key:1,class:"checkbox","touch-target":"wrapper",checked:e.selectedIds.includes(e.item.id),onClick:n[1]||(n[1]=b(l=>e.toggleSelect(l,e.item,e.index),["stop"]))},null,8,["checked"])),a("span",bs,[m(f,{id:e.index+1,raw:e.item},null,8,["id","raw"])])]),a("div",$s,p(e.item.address),1),a("div",{class:"subtitle",innerHTML:s(x)(e.item.body)},null,8,ws),m(oe,{item:e.item,"call-loading":e.callLoading,"call-id":e.callId,onAddItemToTags:h,onCall:u},null,8,["item","call-loading","call-id"]),a("div",Ss,[a("span",null,p(e.$t(`message_type.${e.item.type}`)),1),m(c,{tags:e.item.tags,type:e.dataType,"only-links":!0},null,8,["tags","type"])]),a("div",Cs,[L((o(),r("span",null,[O(p(s(se)(e.item.date)),1)])),[[v,s(ee)(e.item.date)]])])],34))}}}),Bs=de(Es,[["__scopeId","data-v-da6c16d4"]]),Ps={class:"top-app-bar"},qs={class:"title"},Ds={key:0},Vs={key:1},Fs={class:"actions"},Hs={class:"scroll-content"},Us={key:0,class:"no-data-placeholder"},T=50,Ns=q({__name:"MessagesView",setup(M){var Z;const d=es("isPhone"),i=Re(),{app:h}=Ke(ze()),u=B([]),{t:e}=je(),{parseQ:n,buildQ:w}=hs(),f=Ge({tagIds:[]}),c=Je.SMS,y=We(),v=y.query,l=B(parseInt(((Z=v.page)==null?void 0:Z.toString())??"1")),A=B(""),{tags:S,fetch:me}=gs(c),{addToTags:re}=_s(c,S),{selectedIds:E,allChecked:K,realAllChecked:D,selectRealAll:pe,allCheckedAlertVisible:ue,clearSelection:V,toggleAllChecked:ge,toggleSelect:_e,total:k,checked:F,shiftEffectingIds:he,handleItemClick:fe,handleMouseOver:ve,selectAll:ke,shouldSelect:ye}=Ue(u),z=t=>{const g=y.query.q;ne(i,g?`/messages?page=${t}&q=${g}`:`/messages?page=${t}`)},{keyDown:j,keyUp:G}=Ne(k,T,l,ke,V,z,()=>{}),{loading:H,fetch:U}=Xe({handle:(t,g)=>{g?ns(e(g),"error"):t&&(u.value=t.messages,k.value=t.messageCount)},document:ts,variables:()=>({offset:(l.value-1)*T,limit:T,query:A.value})}),Ie=["1","2","3"].map(t=>({id:t,name:e("message_type."+t)}));function Te(t){as(ls,{type:c,tags:S.value,item:{key:t.id,title:"",size:0},selected:S.value.filter(g=>t.tags.some(N=>N.id===g.id))})}const J=B(""),{mutate:be,loading:$e}=Ye({document:os});function we(t){J.value=t.id,be({number:t.address})}function W(t){return t?`/messages?q=${t}`:"/messages"}const X=t=>{t.type===c&&(V(),U())},Y=t=>{t.type===c&&U()};function Se(t){Object.assign(f,t),ne(i,W(w(f)))}return Ze(()=>{var t;A.value=is(((t=v.q)==null?void 0:t.toString())??""),n(f,A.value),me(),U(),P.on("item_tags_updated",Y),P.on("items_tags_updated",X),window.addEventListener("keydown",j),window.addEventListener("keyup",G)}),xe(()=>{P.off("item_tags_updated",Y),P.off("items_tags_updated",X),window.removeEventListener("keydown",j),window.removeEventListener("keyup",G)}),(t,g)=>{const N=ce,Ce=le,Le=ae,Me=rs,Ae=us,Ee=ps,Be=Bs,Pe=ys,qe=Fe,De=R("tooltip");return o(),r(Q,null,[a("div",Ps,[m(N,{"touch-target":"wrapper",checked:s(K),indeterminate:!s(K)&&s(F),onChange:s(ge)},null,8,["checked","indeterminate","onChange"]),a("div",qs,[s(E).length?(o(),r("span",Ds,p(t.$t("x_selected",{count:s(D)?s(k).toLocaleString():s(E).length.toLocaleString()})),1)):(o(),r("span",Vs,p(t.$t("page_title.messages"))+" ("+p(s(k).toLocaleString())+")",1)),s(F)?L((o(),_(Le,{key:2,onClick:g[0]||(g[0]=b(I=>s(re)(s(E),s(D),A.value),["stop"]))},{default:$(()=>[m(Ce)]),_:1})),[[De,t.$t("add_to_tags")]]):C("",!0)]),a("div",Fs,[m(Me,{filter:f,tags:s(S),types:s(Ie),"get-url":W,"show-chips":!s(d),"is-phone":s(d)},null,8,["filter","tags","types","show-chips","is-phone"])])]),s(d)?(o(),_(Ae,{key:0,class:"mobile-search-filters",filter:f,tags:s(S),feeds:[],buckets:[],types:[],onFilterChange:Se},null,8,["filter","tags"])):C("",!0),m(Ee,{limit:T,total:s(k),"all-checked-alert-visible":s(ue),"real-all-checked":s(D),"select-real-all":s(pe),"clear-selection":s(V)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),a("div",Hs,[a("div",{class:ie(["main-list",{"select-mode":s(F)}])},[(o(!0),r(Q,null,te(u.value,(I,Ve)=>(o(),_(Be,{key:I.id,item:I,index:Ve,"selected-ids":s(E),"shift-effecting-ids":s(he),"should-select":s(ye),"is-phone":s(d),"data-type":s(c),"call-loading":s($e),"call-id":J.value,"handle-item-click":s(fe),"handle-mouse-over":s(ve),"toggle-select":s(_e),onAddItemToTags:Te,onCall:we},null,8,["item","index","selected-ids","shift-effecting-ids","should-select","is-phone","data-type","call-loading","call-id","handle-item-click","handle-mouse-over","toggle-select"]))),128)),s(H)&&u.value.length===0?(o(),r(Q,{key:0},te(20,I=>m(Pe,{key:I,index:I,"is-phone":s(d)},null,8,["index","is-phone"])),64)):C("",!0)],2),!s(H)&&u.value.length===0?(o(),r("div",Us,p(t.$t(s(ss)(s(H),s(h).permissions,"READ_SMS"))),1)):C("",!0),s(k)>T?(o(),_(qe,{key:1,page:l.value,go:z,total:s(k),limit:T},null,8,["page","total"])):C("",!0)])],64)}}}),Zs=de(Ns,[["__scopeId","data-v-cb495d9c"]]);export{Zs as default};
