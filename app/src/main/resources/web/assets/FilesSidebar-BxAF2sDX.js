import{_ as fe}from"./LeftSidebar.vuevuetypescriptsetuptruelang-D0pTgc5b.js";import{_ as he}from"./VDropdownMenu-B13G5ENl.js";import{m as se,c as f,o as u,a,d as ae,aX as S,y as X,R as O,B as b,h as E,bZ as H,j as x,x as M,t as h,b_ as _e,b$ as me,J as Z,e as Pe,s as ye,f as ge,u as ke,bK as $e,W as Te,r as D,i as Y,q as ee,w as Ce,M as V,aa as te,a8 as we,bM as Se,c0 as be,a7 as oe,a1 as Q,a0 as G,O as Ee,P as Me,I as Fe,H as z,a5 as Re,bN as Be,E as Ae,D as ne,F as Ne,c1 as Le}from"./index-D87Nr3Nw.js";import{_ as De}from"./more-vert-BNcWbRGO.js";const Ve={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Ge(c,_){return u(),f("svg",Ve,_[0]||(_[0]=[a("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},[a("path",{d:"M3 12a9 9 0 1 0 9-9a9.75 9.75 0 0 0-6.74 2.74L3 8"}),a("path",{d:"M3 3v5h5m4-1v5l4 2"})],-1)]))}const Oe=se({name:"lucide-history",render:Ge}),xe={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function qe(c,_){return u(),f("svg",xe,_[0]||(_[0]=[a("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M22 12H2m3.45-6.89L2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11M6 16h.01M10 16h.01"},null,-1)]))}const Ie=se({name:"lucide-hard-drive",render:qe}),Ue={class:"row"},je={class:"content"},He={class:"title-row"},Qe={class:"left"},ze={class:"icon","aria-hidden":"true"},Ke={class:"view-raw"},We={class:"title"},Je={key:0,class:"chip"},Xe={key:0,class:"progress"},Ze={key:1,class:"stats-row"},Ye={class:"muted"},et=ae({__name:"VolumeCard",props:{title:{type:String,required:!0},sub:{type:String,default:""},driveType:{type:String,default:""},usedPercent:{type:Number,default:0},percentClass:{type:String,default:""},count:{type:String,default:""},active:{type:Boolean,default:!1},showProgress:{type:Boolean,default:!0},data:{type:Object,default:()=>({})}},emits:["click"],setup(c){const _=c,m=S(()=>{const n=Number(_.usedPercent||0);return Number.isFinite(n)?Math.max(0,Math.min(100,n)):0});return(n,d)=>{const q=Ie,F=_e;return u(),f("div",{class:O(["volume-card",{active:c.active}]),role:"button",tabindex:"0",onClick:d[0]||(d[0]=$=>n.$emit("click")),onKeydown:[d[1]||(d[1]=X(b($=>n.$emit("click"),["prevent"]),["enter"])),d[2]||(d[2]=X(b($=>n.$emit("click"),["prevent"]),["space"]))]},[a("div",Ue,[a("div",je,[a("div",He,[a("div",Qe,[a("span",ze,[x(F,null,{content:M(()=>[a("pre",Ke,h(c.data),1)]),default:M(()=>[x(q)]),_:1})]),a("span",We,h(c.title),1),c.driveType?(u(),f("span",Je,h(c.driveType),1)):E("",!0)]),H(n.$slots,"actions")]),c.showProgress?(u(),f("div",Xe,[a("div",{class:"bar",style:me({width:m.value+"%"})},null,4)])):E("",!0),c.showProgress?(u(),f("div",Ze,[a("span",Ye,[H(n.$slots,"count",{},()=>[Z(h(c.count),1)])]),a("span",{class:O(["percent",c.percentClass])},[H(n.$slots,"percent",{},()=>[Z(h(Math.round(m.value))+"%",1)])],2)])):E("",!0)])])],34)}}}),tt={class:"nav"},ot=["onClick"],nt={class:"icon","aria-hidden":"true"},st={class:"title"},at={class:"section-title"},rt={class:"volumes"},it={class:"section-title"},lt={class:"nav"},ut=["onClick"],ct={class:"title"},_t=ae({__name:"FilesSidebar",setup(c){const _=Pe(),{app:m}=ye(ge()),{t:n}=ke(),{mounts:d}=$e(),{parseQ:q}=Se(),F=Te({showHidden:!1,type:"",rootPath:"",text:"",parent:""}),$=D(""),R=D(!1),T=D(!1),B=D(null);function re(){ne(_,"/files/recent")}function ie(t){B.value=t;const r=document.getElementById("favorite-"+t.fullPath);document.dispatchEvent(new CustomEvent("dropdown-toggle",{detail:{exclude:r}})),T.value=!0}const{mutate:le,loading:dt}=Y({document:be,options:{update:()=>{oe.emit("refetch_app")}}});function ue(t){le({fullPath:t.fullPath}).then(()=>{z(n("removed"))}).catch(r=>{console.error("Error removing favorite folder:",r),z(n("error"),"error")})}function ce(){var g;const t=B.value;if(!t)return;const r=(g=m.value.favoriteFolders)==null?void 0:g.find(y=>y.fullPath===t.fullPath),P=((r==null?void 0:r.alias)||"").trim(),C=()=>Y({document:Le,options:{update:()=>{oe.emit("refetch_app")}}});Re(Be,{title:n("name"),placeholder:t.title||"",value:P||"",mutation:C,getVariables:y=>({fullPath:t.fullPath,alias:(y||"").trim()}),done:()=>{z(n("saved"))}})}const I=S(()=>{const t=e=>{var v;const s=[...d.value.map(p=>p.mountPoint).filter(Boolean),...((v=m.value.favoriteFolders)==null?void 0:v.map(p=>p.fullPath))||[]];let i="";return s.forEach(p=>{e.startsWith(p)&&p.length>i.length&&(i=p)}),i},r=e=>{const s=(e.alias||"").trim();if(s)return s;const i=d.value.filter(l=>l.driveType==="USB_STORAGE").map(l=>l.mountPoint).filter(Boolean),v=new Map(i.map((l,w)=>[l,w+1])),p=l=>{if(!l)return"";if(l.driveType==="INTERNAL_STORAGE")return n("internal_storage");if(l.driveType==="APP")return n("app_data");if(l.driveType==="SDCARD")return n("sdcard");if(l.driveType==="USB_STORAGE"){const w=v.get(l.mountPoint)??1;return`${n("usb_storage")} ${w}`}return l.name||l.mountPoint},L=(()=>{const l=d.value.find(w=>w.mountPoint===e.rootPath);return p(l)||e.rootPath})(),J=e.fullPath.startsWith(e.rootPath)?e.fullPath.substring(e.rootPath.length).replace(/^\//,""):e.fullPath.split("/").pop()||"";return J?`${L}/${J}`:L},P=(e,s)=>s<=0?"":n("storage_free_total",{free:ee(e),total:ee(s)}),C=(e,s)=>s<=0?0:Math.max(0,s-e)/s*100,g=(e,s)=>{if(e.driveType==="INTERNAL_STORAGE")return n("internal_storage");if(e.driveType==="APP")return n("app_data");if(e.driveType==="SDCARD")return n("sdcard");if(e.driveType==="USB_STORAGE"){const i=s.get(e.mountPoint)??1;return`${n("usb_storage")} ${i}`}return e.name||e.mountPoint},y=R.value?"":t($.value),k=[];k.push({rootPath:"",fullPath:"",type:"RECENTS",title:n("recents"),isChecked:R.value,isFavoriteFolder:!1});const j=d.value.filter(e=>e.driveType==="USB_STORAGE").map(e=>e.mountPoint).filter(Boolean),A=new Map(j.map((e,s)=>[e,s+1])),o=e=>e.driveType==="INTERNAL_STORAGE"?0:e.driveType==="SDCARD"?1:e.driveType==="USB_STORAGE"?2:e.driveType==="APP"?3:9;return[...d.value].sort((e,s)=>{const i=o(e),v=o(s);return i!==v?i-v:(e.mountPoint||"").localeCompare(s.mountPoint||"")}).forEach(e=>{const s=e.mountPoint;if(!s)return;const i=Number(e.totalBytes||0),v=Number(e.freeBytes||0);k.push({rootPath:s,fullPath:s,type:e.driveType||"",title:g(e,A),isChecked:y===s,isFavoriteFolder:!1,count:P(v,i),usedPercent:C(v,i),showProgress:i>0})}),m.value.favoriteFolders&&m.value.favoriteFolders.length>0&&m.value.favoriteFolders.forEach((e,s)=>{var p;const i=r(e),v=((p=d.value.find(L=>L.mountPoint===e.rootPath))==null?void 0:p.driveType)??"";k.push({rootPath:e.rootPath,fullPath:e.fullPath,type:v,title:i,isChecked:y===e.fullPath,isFavoriteFolder:!0})}),k}),de=S(()=>I.value.filter(t=>t.type==="RECENTS")),ve=S(()=>I.value.filter(t=>t.type!=="RECENTS"&&!t.isFavoriteFolder)),K=S(()=>I.value.filter(t=>t.isFavoriteFolder));function pe(t){return Math.round(t||0)>=85?"warn":""}function U(t){if(t.type==="RECENTS"){re();return}const r=Ae([{name:"parent",op:"",value:t.fullPath},{name:"type",op:"",value:t.type},{name:"root_path",op:"",value:t.rootPath}]);ne(_,`/files?q=${Ne(r)}`)}function W(){var P;const t=te.currentRoute.value;if(t.path==="/files/recent"){R.value=!0;return}R.value=!1;const r=we(((P=t.query.q)==null?void 0:P.toString())??"");q(F,r),$.value=F.parent}return W(),Ce(()=>te.currentRoute.value.fullPath,()=>{W()}),(t,r)=>{const P=Oe,C=De,g=Fe,y=he,k=fe,j=Me("tooltip");return u(),V(k,{class:"files-sidebar"},{body:M(()=>{var A;return[a("ul",tt,[(u(!0),f(G,null,Q(de.value,o=>(u(),f("li",{key:o.type,class:O({active:o.isChecked}),onClick:b(N=>U(o),["prevent"])},[a("span",nt,[o.type==="RECENTS"?(u(),V(P,{key:0})):E("",!0)]),a("span",st,h(o.title),1)],10,ot))),128))]),a("div",at,h(t.$t("volumes")),1),a("div",rt,[(u(!0),f(G,null,Q(ve.value,o=>(u(),V(et,{key:o.fullPath,title:o.title,count:o.count||"",data:o,"used-percent":o.usedPercent||0,"percent-class":pe(o.usedPercent),active:o.isChecked,"show-progress":o.showProgress,onClick:N=>U(o)},null,8,["title","count","data","used-percent","percent-class","active","show-progress","onClick"]))),128))]),K.value.length?(u(),f(G,{key:0},[a("div",it,h(t.$t("favorites")),1),a("ul",lt,[(u(!0),f(G,null,Q(K.value,o=>(u(),f("li",{key:o.fullPath,class:O({active:o.isChecked}),onClick:b(N=>U(o),["prevent"])},[a("span",ct,h(o.title),1),Ee((u(),V(g,{id:"favorite-"+o.fullPath,class:"sm",onClick:b(N=>ie(o),["prevent","stop"])},{default:M(()=>[x(C)]),_:2},1032,["id","onClick"])),[[j,t.$t("actions")]])],10,ut))),128))])],64)):E("",!0),x(y,{modelValue:T.value,"onUpdate:modelValue":r[2]||(r[2]=o=>T.value=o),anchor:"favorite-"+((A=B.value)==null?void 0:A.fullPath)},{default:M(()=>[a("div",{class:"dropdown-item",onClick:r[0]||(r[0]=o=>{ce(),T.value=!1})},h(t.$t("rename")),1),a("div",{class:"dropdown-item",onClick:r[1]||(r[1]=o=>{ue(B.value),T.value=!1})},h(t.$t("remove_from_favorites")),1)]),_:1},8,["modelValue","anchor"])]}),_:1})}}});export{_t as default};
