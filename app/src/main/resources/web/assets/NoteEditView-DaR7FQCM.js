import{_ as te}from"./MonacoEditor.vuevuetypescriptsetuptruelang-BzOZFyyF.js";import{_ as ae}from"./print-outline-rounded-CTTNm2DO.js";import{bk as ne,bl as O,bm as oe,d as se,e as ie,u as ue,r as T,s as re,f as le,g as ce,Y as de,i as me,bn as _e,ai as fe,a4 as ve,a7 as x,aj as pe,c as P,o as b,a as y,O as E,P as ge,M as S,x as q,B,J as j,h as F,t as he,k as G,au as Te,j as M,T as be,a0 as z,w as ye,U as ke,I as we,bo as Me,H as J,bp as $e,bq as Ce,br as Le,Q as Ne,aa as xe,D as Ee,a5 as Se,a6 as Ie,bs as Ve,L as De}from"./index-D87Nr3Nw.js";import{_ as Re}from"./FieldId.vuevuetypescriptsetuptruelang-DRoBQnQY.js";import{u as Qe}from"./markdown-xl8b4e0K.js";var H=function(){return ne.Date.now()},Ue="Expected a function",qe=Math.max,Be=Math.min;function He(I,r,u){var d,n,o,i,s,l,_=0,C=!1,f=!1,v=!0;if(typeof I!="function")throw new TypeError(Ue);r=O(r)||0,oe(u)&&(C=!!u.leading,f="maxWait"in u,o=f?qe(O(u.maxWait)||0,r):o,v="trailing"in u?!!u.trailing:v);function k(a){var c=d,e=n;return d=n=void 0,_=a,i=I.apply(e,c),i}function L(a){return _=a,s=setTimeout(m,r),C?k(a):i}function V(a){var c=a-l,e=a-_,t=r-c;return f?Be(t,o-e):t}function p(a){var c=a-l,e=a-_;return l===void 0||c>=r||c<0||f&&e>=o}function m(){var a=H();if(p(a))return N(a);s=setTimeout(m,V(a))}function N(a){return s=void 0,v&&d?k(a):(d=n=void 0,i)}function D(){s!==void 0&&clearTimeout(s),_=0,d=l=n=s=void 0}function R(){return s===void 0?i:N(H())}function w(){var a=H(),c=p(a);if(d=arguments,n=this,l=a,c){if(s===void 0)return L(l);if(f)return clearTimeout(s),s=setTimeout(m,r),k(l)}return s===void 0&&(s=setTimeout(m,r)),i}return w.cancel=D,w.flush=R,w}const We={class:"top-app-bar"},Ae={class:"title"},Oe={class:"state-point"},Pe={class:"actions"},je={class:"panel-container"},Fe=["innerHTML"],$="NOTE",Ge=se({__name:"NoteEditView",setup(I){const r=ie(),{t:u}=ue(),d=ve(),n=T(""),o=T(),i=T(""),s=T(""),l=T(!1),{app:_,urlTokenKey:C}=re(le());function f(){const e=xe.currentRoute.value.query.q;let t="/notes";e&&(t+=`?q=${e}`),Ee(r,t)}const{render:v}=Qe(_,C),k=He(()=>{l.value=!1,N({id:n.value,input:{content:i.value,title:Ve(i.value,{length:250,omission:""})}})},500),L=()=>{ye(i,async e=>{l.value=!0,s.value=await v(e),k()})},V=()=>{window.print()},p=T();ce({handle:(e,t)=>{t?J(u(t),"error"):e&&(p.value=e.tags)},document:Me,variables:{type:$}});const{fetch:m}=de({handle:async(e,t)=>{t?J(u(t),"error"):(o.value=e.note,i.value=e.note.content,s.value=await v(i.value),L())},document:$e,variables:()=>({id:n.value}),options:{fetchPolicy:"no-cache"}}),{mutate:N,onDone:D}=me({document:Ce});D(e=>{var t,g;o.value=e.data.saveNote,!n.value&&((t=o.value)!=null&&t.id)&&(n.value=(g=o.value)==null?void 0:g.id,_e(r,`/notes/${n.value}`))});function R(){var t;const e=(t=o==null?void 0:o.value)==null?void 0:t.updatedAt;return e?`(${u("updated_at")}: ${ke(e)})`:""}function w(){var e,t;Se(Ie,{type:$,tags:p.value,item:{key:(e=o.value)==null?void 0:e.id,title:"",size:0},selected:(t=p.value)==null?void 0:t.filter(g=>{var h;return(h=o.value)==null?void 0:h.tags.some(Q=>Q.id===g.id)})})}const a=e=>{e.type===$&&m()},c=e=>{e.type===$&&m()};return fe(()=>{n.value=d.params.id,n.value==="create"&&(n.value=""),n.value?m():L(),x.on("item_tags_updated",c),x.on("items_tags_updated",a)}),pe(()=>{x.off("item_tags_updated",c),x.off("items_tags_updated",a)}),(e,t)=>{var W,A;const g=Le,h=we,Q=Re,K=be,X=Ne,Y=ae,Z=te,U=ge("tooltip");return b(),P(z,null,[y("div",We,[E((b(),S(h,{onClick:B(f,["prevent"])},{default:q(()=>[M(g)]),_:1})),[[U,e.$t("back")]]),y("div",Ae,[j(he(n.value?G(u)("edit"):G(u)("create"))+" ",1),E(y("span",Oe,"*",512),[[Te,l.value]]),t[1]||(t[1]=j()),(W=o.value)!=null&&W.updatedAt?(b(),S(Q,{key:0,id:R(),class:"time",raw:o.value},null,8,["id","raw"])):F("",!0)]),y("div",Pe,[M(K,{tags:(A=o.value)==null?void 0:A.tags,type:$,"only-links":!0},null,8,["tags"]),n.value?(b(),P(z,{key:0},[E((b(),S(h,{onClick:B(w,["prevent"])},{default:q(()=>[M(X)]),_:1})),[[U,e.$t("add_to_tags")]]),E((b(),S(h,{onClick:B(V,["prevent"])},{default:q(()=>[M(Y)]),_:1})),[[U,e.$t("print")]])],64)):F("",!0)])]),y("div",je,[M(Z,{modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=ee=>i.value=ee),language:"html"},null,8,["modelValue"]),y("div",{class:"md-container",innerHTML:s.value},null,8,Fe)])],64)}}}),Ze=De(Ge,[["__scopeId","data-v-2c4e12eb"]]);export{Ze as default};
