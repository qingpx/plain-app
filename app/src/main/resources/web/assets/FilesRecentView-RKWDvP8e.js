import{_ as be}from"./ListItemPhone.vuevuetypescriptsetuptruelang-CWNaKFsN.js";import{e as M,c as a,K as u,o,z as p,O as $e,a as l,k as v,bz as D,l as t,aH as Z,t as r,L as y,n as J,M as q,R as W,H as A,S as X,G as x,q as c,ak as ee,by as Fe,bY as Se,J as se,d as Ce,u as De,r as S,g as Te,s as Le,i as Ve,aw as Re,W as Ae,X as Me,Y as Pe,j as C,Z as Y,$ as ze,bZ as Be,br as Ne,a0 as Oe,bN as Ue,b_ as Ke,F as j,bM as He,bR as Ge,at as Qe,bS as Ze,bT as Je,a2 as We,a5 as I,bU as Xe,bV as Ye}from"./index-CjV_XHt1.js";import{_ as je}from"./FieldId.vuevuetypescriptsetuptruelang-CbUX_J17.js";import{_ as te}from"./VCheckbox-DkV6kTpI.js";import{_ as qe,u as xe,c as es}from"./key-events-DKZNx6TT.js";import{_ as ss}from"./DownloadMethodModal.vuevuetypescriptsetuptruelang-DbCc3DTC.js";const ts={class:"start"},ns={class:"number"},os={key:0,class:"svg",src:D},is=["src"],ls=["src"],as={key:3,class:"svg",src:D},ds={class:"title"},rs={class:"subtitle"},cs={class:"actions"},ms={class:"card card-info"},us={class:"key-value vertical"},ps={class:"key"},vs={class:"value"},fs={key:0,class:"svg",src:D},gs=["src"],hs=["src"],ks={key:3,class:"svg",src:D},_s={class:"actions"},ys={class:"card card-info"},Is={class:"key-value vertical"},ws={class:"key"},Es={class:"value"},bs=M({__name:"FileRecentItem",props:{item:{},index:{},selectedIds:{},shiftEffectingIds:{},shouldSelect:{type:Boolean},isPhone:{type:Boolean},imageErrorIds:{},extensionImageErrorIds:{},handleItemClick:{type:Function},handleMouseOver:{type:Function},toggleSelect:{type:Function},onImageError:{type:Function},onExtensionImageError:{type:Function},downloadFile:{type:Function},clickItem:{type:Function}},setup(P){return(e,s)=>{const g=te,w=je,E=ee,h=x,m=Fe,k=Se,b=be,_=q("tooltip");return e.isPhone?(o(),u(b,{key:1,"is-selected":e.selectedIds.includes(e.item.id),"is-selecting":e.shiftEffectingIds.includes(e.item.id),"checkbox-checked":e.shiftEffectingIds.includes(e.item.id)?e.shouldSelect:e.selectedIds.includes(e.item.id),onClick:s[12]||(s[12]=i=>e.handleItemClick(i,e.item,e.index,()=>e.clickItem(e.item))),onMouseenter:s[13]||(s[13]=p(i=>e.handleMouseOver(i,e.index),["stop"])),onCheckboxClick:s[14]||(s[14]=i=>e.toggleSelect(i,e.item,e.index))},{image:c(()=>[l("div",{class:"image",onClick:s[10]||(s[10]=p(i=>e.clickItem(e.item),["stop"]))},[e.extensionImageErrorIds.includes(e.item.id)?(o(),a("img",fs)):!e.imageErrorIds.includes(e.item.id)&&e.item.fileId?(o(),a("img",{key:1,class:"image-thumb",src:t(Z)(e.item.fileId,"&w=50&h=50"),onError:s[8]||(s[8]=i=>e.onImageError(e.item.id))},null,40,gs)):e.item.extension?(o(),a("img",{key:2,src:`/ficons/${e.item.extension}.svg`,class:"svg",onError:s[9]||(s[9]=i=>e.onExtensionImageError(e.item.id))},null,40,hs)):(o(),a("img",ks))])]),title:c(()=>[A(r(e.item.name),1)]),subtitle:c(()=>[l("span",null,r(t(J)(e.item.size)),1),y((o(),a("span",null,[A(r(t(X)(e.item.updatedAt)),1)])),[[_,t(W)(e.item.updatedAt)]])]),actions:c(()=>[l("div",_s,[y((o(),u(h,{onClick:s[11]||(s[11]=p(i=>e.downloadFile(e.item.path),["stop"]))},{default:c(()=>[v(E)]),_:1})),[[_,e.$t("download")]]),v(k,null,{content:c(()=>[l("section",ys,[l("div",Is,[l("div",ws,r(e.$t("path")),1),l("div",Es,r(e.item.path),1)])])]),default:c(()=>[y((o(),u(h,null,{default:c(()=>[v(m)]),_:1})),[[_,e.$t("info")]])]),_:1})])]),_:1},8,["is-selected","is-selecting","checkbox-checked"])):(o(),a("section",{key:0,class:$e(["file-item recent-file-item selectable-card",{selected:e.selectedIds.includes(e.item.id),selecting:e.shiftEffectingIds.includes(e.item.id)}]),onClick:s[6]||(s[6]=p(i=>e.handleItemClick(i,e.item,e.index,()=>e.clickItem(e.item)),["stop"])),onMouseenter:s[7]||(s[7]=p(i=>e.handleMouseOver(i,e.index),["stop"]))},[l("div",ts,[e.shiftEffectingIds.includes(e.item.id)?(o(),u(g,{key:0,class:"checkbox","touch-target":"wrapper",checked:e.shouldSelect,onClick:s[0]||(s[0]=p(i=>e.toggleSelect(i,e.item,e.index),["stop"]))},null,8,["checked"])):(o(),u(g,{key:1,class:"checkbox","touch-target":"wrapper",checked:e.selectedIds.includes(e.item.id),onClick:s[1]||(s[1]=p(i=>e.toggleSelect(i,e.item,e.index),["stop"]))},null,8,["checked"])),l("span",ns,[v(w,{id:e.index+1,raw:e.item},null,8,["id","raw"])])]),l("div",{class:"image",onClick:s[4]||(s[4]=p(i=>e.clickItem(e.item),["stop"]))},[e.extensionImageErrorIds.includes(e.item.id)?(o(),a("img",os)):!e.imageErrorIds.includes(e.item.id)&&e.item.fileId?(o(),a("img",{key:1,class:"image-thumb",src:t(Z)(e.item.fileId,"&w=50&h=50"),onError:s[2]||(s[2]=i=>e.onImageError(e.item.id))},null,40,is)):e.item.extension?(o(),a("img",{key:2,src:`/ficons/${e.item.extension}.svg`,class:"svg",onError:s[3]||(s[3]=i=>e.onExtensionImageError(e.item.id))},null,40,ls)):(o(),a("img",as))]),l("div",ds,r(e.item.name),1),l("div",rs,[l("span",null,r(t(J)(e.item.size)),1),y((o(),a("span",null,[A(r(t(X)(e.item.updatedAt)),1)])),[[_,t(W)(e.item.updatedAt)]])]),l("div",cs,[y((o(),u(h,{onClick:s[5]||(s[5]=p(i=>e.downloadFile(e.item.path),["stop"]))},{default:c(()=>[v(E)]),_:1})),[[_,e.$t("download")]]),v(k,null,{content:c(()=>[l("section",ms,[l("div",us,[l("div",ps,r(e.$t("path")),1),l("div",vs,r(e.item.path),1)])])]),default:c(()=>[y((o(),u(h,null,{default:c(()=>[v(m)]),_:1})),[[_,e.$t("info")]])]),_:1})])],34))}}}),$s=se(bs,[["__scopeId","data-v-7ca2e29e"]]),Fs={key:0,class:"file-item recent-file-item selectable-card-skeleton"},Ss={class:"start"},Cs={class:"number"},Ds=M({__name:"FileRecentSkeletonItem",props:{index:{},isPhone:{type:Boolean}},setup(P){return(e,s)=>{const g=qe;return e.isPhone?(o(),u(g,{key:1,"title-width":"60%",subtitles:[{width:"45%"},{width:"40%"}],"action-count":2})):(o(),a("section",Fs,[l("div",Ss,[s[0]||(s[0]=l("div",{class:"skeleton-checkbox"},null,-1)),l("span",Cs,r(e.index),1)]),s[1]||(s[1]=Ce('<div class="image" data-v-777f0631><div class="skeleton-image lg" data-v-777f0631></div></div><div class="title" data-v-777f0631><div class="skeleton-text lg" style="width:40%;" data-v-777f0631></div></div><div class="subtitle" data-v-777f0631><div class="skeleton-text" style="width:30%;" data-v-777f0631></div></div><div class="actions" data-v-777f0631><div class="skeleton-text lg" style="width:80px;" data-v-777f0631></div></div>',4))]))}}}),Ts=se(Ds,[["__scopeId","data-v-777f0631"]]),Ls={class:"top-app-bar"},Vs={key:0},Rs={key:1},As={key:0,class:"scroller main-list"},Ms={key:2,class:"no-data-placeholder"},Ks=M({__name:"FilesRecentView",setup(P){const{t:e}=De(),s=S([]),g=Be(),w=Te(),{app:E,urlTokenKey:h}=Le(w),m=S([]),{selectedIds:k,allChecked:b,realAllChecked:_,clearSelection:i,toggleAllChecked:ne,toggleSelect:oe,total:T,checked:z,shiftEffectingIds:ie,handleItemClick:le,handleMouseOver:ae,selectAll:de,shouldSelect:re}=xe(m),{downloadFile:$,downloadFiles:ce,downloadDir:me}=Re(h),{view:ue}=Je(s,(n,d)=>{w.lightbox={sources:n,index:d,visible:!0}}),{keyDown:B,keyUp:N}=es(de,i,()=>{}),O=S([]),U=S([]),pe=n=>{O.value.push(n)},ve=n=>{U.value.push(n)},{mutate:fe,onDone:ge}=Ve({document:Ue});ge(n=>{ce(n.data.setTempValue.key),i()});const he=n=>{Ge(n.name)?window.open(Qe(h.value,n.path),"_blank"):Ze(n.name)?ue(m.value,n):$(n.path)},{loading:L,fetch:V}=Ae({handle:async(n,d)=>{if(d)j(e(d),"error");else{const f=[];for(const R of n.recentFiles)f.push(He(R,h.value));m.value=f,T.value=f.length}},document:Ke}),ke=()=>{const n=m.value.filter(d=>k.value.includes(d.id));if(n.length===0){j(e("select_first"),"error");return}if(n.length===1&&!n[0].isDir){$(n[0].path),i();return}We(ss,{onEach:async()=>{for(const d of n)d.isDir?me(d.path):$(d.path),await new Promise(f=>setTimeout(f,250));i()},onZip:()=>{fe({key:Ye(),value:JSON.stringify(k.value.map(d=>({path:d})))})}})},K=n=>{n.status==="done"&&setTimeout(()=>{V()},1e3)},_e=n=>{n.forEach(d=>{Xe(m.value,f=>f.id===d.id)}),i()},H=n=>{_e([n.item])},G=n=>{V()};return Me(()=>{V(),I.on("upload_task_done",K),I.on("file_deleted",H),I.on("file_renamed",G),window.addEventListener("keydown",B),window.addEventListener("keyup",N)}),Pe(()=>{I.off("upload_task_done",K),I.off("file_deleted",H),I.off("file_renamed",G),window.removeEventListener("keydown",B),window.removeEventListener("keyup",N)}),(n,d)=>{const f=te,R=ee,ye=x,Ie=Ts,we=$s,Ee=q("tooltip");return o(),a(Y,null,[l("div",Ls,[v(f,{"touch-target":"wrapper",checked:t(b),indeterminate:!t(b)&&t(z),onChange:t(ne)},null,8,["checked","indeterminate","onChange"]),t(k).length?(o(),a("span",Vs,r(n.$t("x_selected",{count:t(_)?t(T).toLocaleString():t(k).length.toLocaleString()})),1)):(o(),a("span",Rs,r(n.$t("recent_files"))+" ("+r(t(T).toLocaleString())+")",1)),t(z)?y((o(),u(ye,{key:2,onClick:p(ke,["stop"])},{default:c(()=>[v(R)]),_:1})),[[Ee,n.$t("download")]]):C("",!0)]),t(L)&&m.value.length===0?(o(),a("div",As,[(o(),a(Y,null,ze(20,F=>v(Ie,{key:F,index:F,"is-phone":t(g)},null,8,["index","is-phone"])),64))])):C("",!0),m.value.length>0?(o(),u(t(Ne),{key:1,class:"scroller main-list","data-key":"id","data-sources":m.value,"estimate-size":t(g)?120:80},{item:c(({index:F,item:Q})=>[(o(),u(we,{key:Q.id,item:Q,index:F,"selected-ids":t(k),"shift-effecting-ids":t(ie),"should-select":t(re),"is-phone":t(g),"image-error-ids":O.value,"extension-image-error-ids":U.value,"handle-item-click":t(le),"handle-mouse-over":t(ae),"toggle-select":t(oe),"on-image-error":pe,"on-extension-image-error":ve,"download-file":t($),"click-item":he},null,8,["item","index","selected-ids","shift-effecting-ids","should-select","is-phone","image-error-ids","extension-image-error-ids","handle-item-click","handle-mouse-over","toggle-select","download-file"]))]),_:1},8,["data-sources","estimate-size"])):C("",!0),!t(L)&&m.value.length===0?(o(),a("div",Ms,r(n.$t(t(Oe)(t(L),t(E).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):C("",!0)],64)}}});export{Ks as default};
