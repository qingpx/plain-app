import{_ as Ae}from"./VPagination.vuevuetypescriptsetuptruelang-B7Sa-dGQ.js";import{_ as Ee,u as Pe,a as Be}from"./key-events-DeJMQ3Gp.js";import{d as B,c,M as f,o as a,a as l,N as De,t as m,O as L,P as F,I as se,B as y,x as w,j as r,Q as ne,R as ae,k as t,S as Y,T as qe,U as Z,J as Q,V as x,L as le,e as Ve,s as He,f as Ne,r as C,u as Re,W as Qe,X as Ue,Y as Fe,i as Ke,w as Oe,Z as ze,$ as je,h as E,a0 as U,a1 as ee,a2 as Ge,a3 as Je,H as We,K as Xe,v as Ye,a4 as Ze,D as xe,a5 as et,a6 as tt,a7 as P,a8 as st,a9 as nt}from"./index-DK2k7uUz.js";import{_ as at}from"./ListItemPhone.vuevuetypescriptsetuptruelang-QRqCHaZt.js";import{_ as lt}from"./FieldId.vuevuetypescriptsetuptruelang-BCKfQAtO.js";import{_ as oe}from"./VCheckbox-ChdySfCx.js";import{_ as ot}from"./call-outline-rounded-D-ziTXzp.js";import{_ as it}from"./AllCheckedAlert.vuevuetypescriptsetuptruelang-BaeCK0x8.js";import{u as dt,a as ct}from"./tags-DGia9o9R.js";const mt={key:0,class:"sms-item selectable-card-skeleton"},rt={class:"start"},ut={class:"number"},pt=B({__name:"MessageSkeletonItem",props:{index:{},isPhone:{type:Boolean}},setup(M){return(h,d)=>{const v=Ee;return h.isPhone?(a(),f(v,{key:1,"title-width":"70%",image:!1,subtitles:[{width:"45%"},{width:"30%"},{width:"40%"}],"action-count":2})):(a(),c("section",mt,[l("div",rt,[d[0]||(d[0]=l("div",{class:"skeleton-checkbox"},null,-1)),l("span",ut,m(h.index),1)]),d[1]||(d[1]=De('<div class="title"><div class="skeleton-text lg" style="width:120px;"></div></div><div class="subtitle"><div class="skeleton-text" style="width:80%;"></div><div class="skeleton-text" style="width:80%;margin-block-start:8px;"></div></div><div class="actions"><div class="skeleton-text" style="width:140px;"></div></div><div class="info"><div class="skeleton-text" style="width:60px;"></div></div><div class="time"><div class="skeleton-text" style="width:60px;"></div></div>',5))]))}}}),gt={class:"actions"},te=B({__name:"MessageActionButtons",props:{item:{},callLoading:{type:Boolean},callId:{}},emits:["addItemToTags","call"],setup(M,{emit:h}){const d=M,v=h;function u(){v("addItemToTags",d.item)}function e(){v("call",d.item)}return(n,S)=>{const p=ne,g=se,k=ot,_=F("tooltip");return a(),c("div",gt,[L((a(),f(g,{onClick:y(u,["stop"])},{default:w(()=>[r(p)]),_:1})),[[_,n.$t("add_to_tags")]]),L((a(),f(g,{loading:n.callLoading&&n.callId===n.item.id,onClick:y(e,["stop"])},{default:w(()=>[r(k)]),_:1},8,["loading"])),[[_,n.$t("make_a_phone_call")]])])}}}),_t={class:"start"},ht={class:"number"},vt={class:"title"},ft=["innerHTML"],kt={class:"info"},yt={class:"time"},It=["innerHTML"],Tt={class:"info"},$t={class:"time"},bt=B({__name:"MessageListItem",props:{item:{},index:{},selectedIds:{},shiftEffectingIds:{},shouldSelect:{type:Boolean},isPhone:{type:Boolean},dataType:{},callLoading:{type:Boolean},callId:{},handleItemClick:{type:Function},handleMouseOver:{type:Function},toggleSelect:{type:Function}},emits:["addItemToTags","call"],setup(M,{emit:h}){const d=h;function v(e){d("addItemToTags",e)}function u(e){d("call",e)}return(e,n)=>{const S=oe,p=lt,g=qe,k=at,_=F("tooltip");return e.isPhone?(a(),f(k,{key:1,"is-selected":e.selectedIds.includes(e.item.id),"is-selecting":e.shiftEffectingIds.includes(e.item.id),"checkbox-checked":e.shiftEffectingIds.includes(e.item.id)?e.shouldSelect:e.selectedIds.includes(e.item.id),onClick:n[4]||(n[4]=o=>e.handleItemClick(o,e.item,e.index,()=>{})),onMouseenter:n[5]||(n[5]=y(o=>e.handleMouseOver(o,e.index),["stop"])),onCheckboxClick:n[6]||(n[6]=o=>e.toggleSelect(o,e.item,e.index))},{title:w(()=>[Q(m(e.item.address),1)]),subtitle:w(()=>[l("div",{class:"subtitle",innerHTML:t(Y)(e.item.body)},null,8,It),l("div",Tt,[l("span",null,m(e.$t(`message_type.${e.item.type}`)),1),r(g,{tags:e.item.tags,type:e.dataType,"only-links":!0},null,8,["tags","type"])]),l("div",$t,[L((a(),c("span",null,[Q(m(t(x)(e.item.date)),1)])),[[_,t(Z)(e.item.date)]])])]),actions:w(()=>[r(te,{item:e.item,"call-loading":e.callLoading,"call-id":e.callId,onAddItemToTags:v,onCall:u},null,8,["item","call-loading","call-id"])]),_:1},8,["is-selected","is-selecting","checkbox-checked"])):(a(),c("section",{key:0,class:ae(["sms-item selectable-card",{selected:e.selectedIds.includes(e.item.id),selecting:e.shiftEffectingIds.includes(e.item.id)}]),onClick:n[2]||(n[2]=y(o=>e.handleItemClick(o,e.item,e.index,()=>{}),["stop"])),onMouseenter:n[3]||(n[3]=y(o=>e.handleMouseOver(o,e.index),["stop"]))},[l("div",_t,[e.shiftEffectingIds.includes(e.item.id)?(a(),f(S,{key:0,class:"checkbox","touch-target":"wrapper",checked:e.shouldSelect,onClick:n[0]||(n[0]=y(o=>e.toggleSelect(o,e.item,e.index),["stop"]))},null,8,["checked"])):(a(),f(S,{key:1,class:"checkbox","touch-target":"wrapper",checked:e.selectedIds.includes(e.item.id),onClick:n[1]||(n[1]=y(o=>e.toggleSelect(o,e.item,e.index),["stop"]))},null,8,["checked"])),l("span",ht,[r(p,{id:e.index+1,raw:e.item},null,8,["id","raw"])])]),l("div",vt,m(e.item.address),1),l("div",{class:"subtitle",innerHTML:t(Y)(e.item.body)},null,8,ft),r(te,{item:e.item,"call-loading":e.callLoading,"call-id":e.callId,onAddItemToTags:v,onCall:u},null,8,["item","call-loading","call-id"]),l("div",kt,[l("span",null,m(e.$t(`message_type.${e.item.type}`)),1),r(g,{tags:e.item.tags,type:e.dataType,"only-links":!0},null,8,["tags","type"])]),l("div",yt,[L((a(),c("span",null,[Q(m(t(x)(e.item.date)),1)])),[[_,t(Z)(e.item.date)]])])],34))}}}),wt=le(bt,[["__scopeId","data-v-5198fe2d"]]),St={class:"top-app-bar"},Ct={class:"title"},Lt={key:0},Mt={key:1},At={class:"scroll-content"},Et={key:0,class:"no-data-placeholder"},b=50,Pt=B({__name:"MessagesView",setup(M){const h=Ye("isPhone"),d=Ve(),{app:v}=He(Ne()),u=C([]),{t:e}=Re(),{parseQ:n}=nt(),S=Qe({tagIds:[]}),p=Ue.SMS,g=Ze(),k=C(1),_=C(""),{tags:o,fetch:ie}=dt(p),{addToTags:de}=ct(p,o),{selectedIds:A,allChecked:K,realAllChecked:D,selectRealAll:ce,allCheckedAlertVisible:me,clearSelection:q,toggleAllChecked:re,toggleSelect:ue,total:I,checked:V,shiftEffectingIds:pe,handleItemClick:ge,handleMouseOver:_e,selectAll:he,shouldSelect:ve}=Pe(u),O=s=>{const i=g.query.q;xe(d,i?`/messages?page=${s}&q=${i}`:`/messages?page=${s}`)},{keyDown:z,keyUp:j}=Be(I,b,k,he,q,O,()=>{}),{loading:H,fetch:N}=Fe({handle:(s,i)=>{i?We(e(i),"error"):s&&(u.value=s.messages,I.value=s.messageCount)},document:Je,variables:()=>({offset:(k.value-1)*b,limit:b,query:_.value})});function fe(s){et(tt,{type:p,tags:o.value,item:{key:s.id,title:"",size:0},selected:o.value.filter(i=>s.tags.some(T=>T.id===i.id))})}const G=C(""),{mutate:ke,loading:ye}=Ke({document:Xe});function Ie(s){G.value=s.id,ke({number:s.address})}const J=s=>{s.type===p&&(q(),N())},W=s=>{s.type===p&&N()},R=C(!1);function X(){var i,T;const s=parseInt(((i=g.query.page)==null?void 0:i.toString())??"1");k.value=Number.isFinite(s)&&s>0?s:1,_.value=st(((T=g.query.q)==null?void 0:T.toString())??""),n(S,_.value),N()}return Oe(()=>g.fullPath,()=>{R.value&&X()}),ze(()=>{ie(),R.value=!0,X(),P.on("item_tags_updated",W),P.on("items_tags_updated",J),window.addEventListener("keydown",z),window.addEventListener("keyup",j)}),je(()=>{R.value=!1,P.off("item_tags_updated",W),P.off("items_tags_updated",J),window.removeEventListener("keydown",z),window.removeEventListener("keyup",j)}),(s,i)=>{const T=oe,Te=ne,$e=se,be=it,we=wt,Se=pt,Ce=Ae,Le=F("tooltip");return a(),c(U,null,[l("div",St,[r(T,{"touch-target":"wrapper",checked:t(K),indeterminate:!t(K)&&t(V),onChange:t(re)},null,8,["checked","indeterminate","onChange"]),l("div",Ct,[t(A).length?(a(),c("span",Lt,m(s.$t("x_selected",{count:t(D)?t(I).toLocaleString():t(A).length.toLocaleString()})),1)):(a(),c("span",Mt,m(s.$t("page_title.messages"))+" ("+m(t(I).toLocaleString())+")",1)),t(V)?L((a(),f($e,{key:2,onClick:i[0]||(i[0]=y($=>t(de)(t(A),t(D),_.value),["stop"]))},{default:w(()=>[r(Te)]),_:1})),[[Le,s.$t("add_to_tags")]]):E("",!0)]),i[1]||(i[1]=l("div",{class:"actions"},null,-1))]),r(be,{limit:b,total:t(I),"all-checked-alert-visible":t(me),"real-all-checked":t(D),"select-real-all":t(ce),"clear-selection":t(q)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),l("div",At,[l("div",{class:ae(["main-list",{"select-mode":t(V)}])},[(a(!0),c(U,null,ee(u.value,($,Me)=>(a(),f(we,{key:$.id,item:$,index:Me,"selected-ids":t(A),"shift-effecting-ids":t(pe),"should-select":t(ve),"is-phone":t(h),"data-type":t(p),"call-loading":t(ye),"call-id":G.value,"handle-item-click":t(ge),"handle-mouse-over":t(_e),"toggle-select":t(ue),onAddItemToTags:fe,onCall:Ie},null,8,["item","index","selected-ids","shift-effecting-ids","should-select","is-phone","data-type","call-loading","call-id","handle-item-click","handle-mouse-over","toggle-select"]))),128)),t(H)&&u.value.length===0?(a(),c(U,{key:0},ee(20,$=>r(Se,{key:$,index:$,"is-phone":t(h)},null,8,["index","is-phone"])),64)):E("",!0)],2),!t(H)&&u.value.length===0?(a(),c("div",Et,m(s.$t(t(Ge)(t(H),t(v).permissions,"READ_SMS"))),1)):E("",!0),t(I)>b?(a(),f(Ce,{key:1,page:k.value,go:O,total:t(I),limit:b},null,8,["page","total"])):E("",!0)])],64)}}}),Ft=le(Pt,[["__scopeId","data-v-c70abb2d"]]);export{Ft as default};
