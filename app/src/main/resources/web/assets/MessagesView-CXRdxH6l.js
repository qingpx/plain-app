import{_ as Fe}from"./VPagination.vuevuetypescriptsetuptruelang-5kr-8pTI.js";import{_ as He,u as Ue,a as Ne}from"./key-events-KGPRn2if.js";import{e as q,c as r,K as _,o,a,d as Oe,t as p,L,M as R,G as ae,z as k,q as $,k as m,N as le,O as ie,l as t,P as x,Q as Qe,R as ee,H as O,S as te,J as de,f as Re,s as Ke,g as ze,r as B,u as je,T as Ge,U as Je,V as We,W as Xe,i as Ye,X as Ze,Y as xe,j as C,p as et,Z as Q,$ as se,a0 as tt,a1 as st,F as nt,I as ot,B as ne,a2 as at,a3 as lt,a4 as it,a5 as P}from"./index-Bu4wgWbt.js";import{_ as dt}from"./ListItemPhone.vuevuetypescriptsetuptruelang-D9G49LY3.js";import{_ as ct}from"./FieldId.vuevuetypescriptsetuptruelang-Ctm_Cw-m.js";import{_ as ce}from"./VCheckbox-DnXTY-KG.js";import{_ as mt}from"./call-outline-rounded-Ct8Rt4bF.js";import{_ as rt,a as pt,b as ut}from"./SearchInput-BGaoqv8l.js";import{u as gt,a as _t}from"./tags-Buu0XK4A.js";import{u as ht}from"./search-B9iTF4ht.js";import"./search-rounded-Cj_O5FHu.js";const ft={key:0,class:"sms-item selectable-card-skeleton"},vt={class:"start"},kt={class:"number"},yt=q({__name:"MessageSkeletonItem",props:{index:{},isPhone:{type:Boolean}},setup(M){return(d,i)=>{const h=He;return d.isPhone?(o(),_(h,{key:1,"title-width":"70%",image:!1,subtitles:[{width:"45%"},{width:"30%"},{width:"40%"}],"action-count":2})):(o(),r("section",ft,[a("div",vt,[i[0]||(i[0]=a("div",{class:"skeleton-checkbox"},null,-1)),a("span",kt,p(d.index),1)]),i[1]||(i[1]=Oe('<div class="title"><div class="skeleton-text lg" style="width:120px;"></div></div><div class="subtitle"><div class="skeleton-text" style="width:80%;"></div><div class="skeleton-text" style="width:80%;margin-block-start:8px;"></div></div><div class="actions"><div class="skeleton-text" style="width:140px;"></div></div><div class="info"><div class="skeleton-text" style="width:60px;"></div></div><div class="time"><div class="skeleton-text" style="width:60px;"></div></div>',5))]))}}}),It={class:"actions"},oe=q({__name:"MessageActionButtons",props:{item:{},callLoading:{type:Boolean},callId:{}},emits:["addItemToTags","call"],setup(M,{emit:d}){const i=M,h=d;function u(){h("addItemToTags",i.item)}function e(){h("call",i.item)}return(n,w)=>{const f=le,c=ae,I=mt,v=R("tooltip");return o(),r("div",It,[L((o(),_(c,{onClick:k(u,["stop"])},{default:$(()=>[m(f)]),_:1})),[[v,n.$t("add_to_tags")]]),L((o(),_(c,{loading:n.callLoading&&n.callId===n.item.id,onClick:k(e,["stop"])},{default:$(()=>[m(I)]),_:1},8,["loading"])),[[v,n.$t("make_a_phone_call")]])])}}}),Tt={class:"start"},bt={class:"number"},$t={class:"title"},wt=["innerHTML"],St={class:"info"},Ct={class:"time"},Lt=["innerHTML"],Mt={class:"info"},At={class:"time"},Et=q({__name:"MessageListItem",props:{item:{},index:{},selectedIds:{},shiftEffectingIds:{},shouldSelect:{type:Boolean},isPhone:{type:Boolean},dataType:{},callLoading:{type:Boolean},callId:{},handleItemClick:{type:Function},handleMouseOver:{type:Function},toggleSelect:{type:Function}},emits:["addItemToTags","call"],setup(M,{emit:d}){const i=d;function h(e){i("addItemToTags",e)}function u(e){i("call",e)}return(e,n)=>{const w=ce,f=ct,c=Qe,I=dt,v=R("tooltip");return e.isPhone?(o(),_(I,{key:1,"is-selected":e.selectedIds.includes(e.item.id),"is-selecting":e.shiftEffectingIds.includes(e.item.id),"checkbox-checked":e.shiftEffectingIds.includes(e.item.id)?e.shouldSelect:e.selectedIds.includes(e.item.id),onClick:n[4]||(n[4]=l=>e.handleItemClick(l,e.item,e.index,()=>{})),onMouseenter:n[5]||(n[5]=k(l=>e.handleMouseOver(l,e.index),["stop"])),onCheckboxClick:n[6]||(n[6]=l=>e.toggleSelect(l,e.item,e.index))},{title:$(()=>[O(p(e.item.address),1)]),subtitle:$(()=>[a("div",{class:"subtitle",innerHTML:t(x)(e.item.body)},null,8,Lt),a("div",Mt,[a("span",null,p(e.$t(`message_type.${e.item.type}`)),1),m(c,{tags:e.item.tags,type:e.dataType,"only-links":!0},null,8,["tags","type"])]),a("div",At,[L((o(),r("span",null,[O(p(t(te)(e.item.date)),1)])),[[v,t(ee)(e.item.date)]])])]),actions:$(()=>[m(oe,{item:e.item,"call-loading":e.callLoading,"call-id":e.callId,onAddItemToTags:h,onCall:u},null,8,["item","call-loading","call-id"])]),_:1},8,["is-selected","is-selecting","checkbox-checked"])):(o(),r("section",{key:0,class:ie(["sms-item selectable-card",{selected:e.selectedIds.includes(e.item.id),selecting:e.shiftEffectingIds.includes(e.item.id)}]),onClick:n[2]||(n[2]=k(l=>e.handleItemClick(l,e.item,e.index,()=>{}),["stop"])),onMouseenter:n[3]||(n[3]=k(l=>e.handleMouseOver(l,e.index),["stop"]))},[a("div",Tt,[e.shiftEffectingIds.includes(e.item.id)?(o(),_(w,{key:0,class:"checkbox","touch-target":"wrapper",checked:e.shouldSelect,onClick:n[0]||(n[0]=k(l=>e.toggleSelect(l,e.item,e.index),["stop"]))},null,8,["checked"])):(o(),_(w,{key:1,class:"checkbox","touch-target":"wrapper",checked:e.selectedIds.includes(e.item.id),onClick:n[1]||(n[1]=k(l=>e.toggleSelect(l,e.item,e.index),["stop"]))},null,8,["checked"])),a("span",bt,[m(f,{id:e.index+1,raw:e.item},null,8,["id","raw"])])]),a("div",$t,p(e.item.address),1),a("div",{class:"subtitle",innerHTML:t(x)(e.item.body)},null,8,wt),m(oe,{item:e.item,"call-loading":e.callLoading,"call-id":e.callId,onAddItemToTags:h,onCall:u},null,8,["item","call-loading","call-id"]),a("div",St,[a("span",null,p(e.$t(`message_type.${e.item.type}`)),1),m(c,{tags:e.item.tags,type:e.dataType,"only-links":!0},null,8,["tags","type"])]),a("div",Ct,[L((o(),r("span",null,[O(p(t(te)(e.item.date)),1)])),[[v,t(ee)(e.item.date)]])])],34))}}}),Bt=de(Et,[["__scopeId","data-v-5198fe2d"]]),Pt={class:"top-app-bar"},qt={class:"title"},Dt={key:0},Vt={key:1},Ft={class:"actions"},Ht={class:"scroll-content"},Ut={key:0,class:"no-data-placeholder"},b=50,Nt=q({__name:"MessagesView",setup(M){var Z;const d=et("isPhone"),i=Re(),{app:h}=Ke(ze()),u=B([]),{t:e}=je(),{parseQ:n,buildQ:w}=ht(),f=Ge({tagIds:[]}),c=Je.SMS,I=We(),v=I.query,l=B(parseInt(((Z=v.page)==null?void 0:Z.toString())??"1")),A=B(""),{tags:S,fetch:me}=gt(c),{addToTags:re}=_t(c,S),{selectedIds:E,allChecked:K,realAllChecked:D,selectRealAll:pe,allCheckedAlertVisible:ue,clearSelection:V,toggleAllChecked:ge,toggleSelect:_e,total:y,checked:F,shiftEffectingIds:he,handleItemClick:fe,handleMouseOver:ve,selectAll:ke,shouldSelect:ye}=Ue(u),z=s=>{const g=I.query.q;ne(i,g?`/messages?page=${s}&q=${g}`:`/messages?page=${s}`)},{keyDown:j,keyUp:G}=Ne(y,b,l,ke,V,z,()=>{}),{loading:H,fetch:U}=Xe({handle:(s,g)=>{g?nt(e(g),"error"):s&&(u.value=s.messages,y.value=s.messageCount)},document:st,variables:()=>({offset:(l.value-1)*b,limit:b,query:A.value})}),Ie=["1","2","3"].map(s=>({id:s,name:e("message_type."+s)}));function Te(s){at(lt,{type:c,tags:S.value,item:{key:s.id,title:"",size:0},selected:S.value.filter(g=>s.tags.some(N=>N.id===g.id))})}const J=B(""),{mutate:be,loading:$e}=Ye({document:ot});function we(s){J.value=s.id,be({number:s.address})}function W(s){return s?`/messages?q=${s}`:"/messages"}const X=s=>{s.type===c&&(V(),U())},Y=s=>{s.type===c&&U()};function Se(s){Object.assign(f,s),ne(i,W(w(f)))}return Ze(()=>{var s;A.value=it(((s=v.q)==null?void 0:s.toString())??""),n(f,A.value),me(),U(),P.on("item_tags_updated",Y),P.on("items_tags_updated",X),window.addEventListener("keydown",j),window.addEventListener("keyup",G)}),xe(()=>{P.off("item_tags_updated",Y),P.off("items_tags_updated",X),window.removeEventListener("keydown",j),window.removeEventListener("keyup",G)}),(s,g)=>{const N=ce,Ce=le,Le=ae,Me=rt,Ae=ut,Ee=pt,Be=Bt,Pe=yt,qe=Fe,De=R("tooltip");return o(),r(Q,null,[a("div",Pt,[m(N,{"touch-target":"wrapper",checked:t(K),indeterminate:!t(K)&&t(F),onChange:t(ge)},null,8,["checked","indeterminate","onChange"]),a("div",qt,[t(E).length?(o(),r("span",Dt,p(s.$t("x_selected",{count:t(D)?t(y).toLocaleString():t(E).length.toLocaleString()})),1)):(o(),r("span",Vt,p(s.$t("page_title.messages"))+" ("+p(t(y).toLocaleString())+")",1)),t(F)?L((o(),_(Le,{key:2,onClick:g[0]||(g[0]=k(T=>t(re)(t(E),t(D),A.value),["stop"]))},{default:$(()=>[m(Ce)]),_:1})),[[De,s.$t("add_to_tags")]]):C("",!0)]),a("div",Ft,[m(Me,{filter:f,tags:t(S),types:t(Ie),"get-url":W,"show-chips":!t(d),"is-phone":t(d)},null,8,["filter","tags","types","show-chips","is-phone"])])]),t(d)?(o(),_(Ae,{key:0,class:"mobile-search-filters",filter:f,tags:t(S),feeds:[],buckets:[],types:[],onFilterChange:Se},null,8,["filter","tags"])):C("",!0),m(Ee,{limit:b,total:t(y),"all-checked-alert-visible":t(ue),"real-all-checked":t(D),"select-real-all":t(pe),"clear-selection":t(V)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),a("div",Ht,[a("div",{class:ie(["main-list",{"select-mode":t(F)}])},[(o(!0),r(Q,null,se(u.value,(T,Ve)=>(o(),_(Be,{key:T.id,item:T,index:Ve,"selected-ids":t(E),"shift-effecting-ids":t(he),"should-select":t(ye),"is-phone":t(d),"data-type":t(c),"call-loading":t($e),"call-id":J.value,"handle-item-click":t(fe),"handle-mouse-over":t(ve),"toggle-select":t(_e),onAddItemToTags:Te,onCall:we},null,8,["item","index","selected-ids","shift-effecting-ids","should-select","is-phone","data-type","call-loading","call-id","handle-item-click","handle-mouse-over","toggle-select"]))),128)),t(H)&&u.value.length===0?(o(),r(Q,{key:0},se(20,T=>m(Pe,{key:T,index:T,"is-phone":t(d)},null,8,["index","is-phone"])),64)):C("",!0)],2),!t(H)&&u.value.length===0?(o(),r("div",Ut,p(s.$t(t(tt)(t(H),t(h).permissions,"READ_SMS"))),1)):C("",!0),t(y)>b?(o(),_(qe,{key:1,page:l.value,go:z,total:t(y),limit:b},null,8,["page","total"])):C("",!0)])],64)}}}),Zt=de(Nt,[["__scopeId","data-v-cb495d9c"]]);export{Zt as default};
