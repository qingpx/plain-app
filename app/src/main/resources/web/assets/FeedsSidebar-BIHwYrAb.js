import{_ as Le}from"./LeftSidebar.vuevuetypescriptsetuptruelang-VHUzKMSK.js";import{_ as Te,a as xe}from"./TagFilter.vuevuetypescriptsetuptruelang-DK5uZnv1.js";import{_ as Se}from"./VDropdownMenu-nAAHmswh.js";import{_ as qe}from"./more-vert-Cihez65j.js";import{e as j,az as ne,r,i as G,cg as Ie,aA as ae,aB as se,ae as le,aD as ce,aC as D,K as A,o as v,q as d,k as _,H as g,t as s,aj as de,l as n,A as ue,a as c,v as ie,x as re,y as _e,aE as fe,ch as De,u as Ae,f as Qe,s as Re,g as Be,T as Ge,W as Ke,w as Ne,h as Ue,bq as je,F as J,a5 as R,af as ze,a6 as X,a4 as Oe,ci as He,cj as Pe,ck as We,cl as Ye,c as T,z as B,O as K,j as N,$ as ee,L as te,M as Ze,G as Je,Z as oe,a2 as U,ac as Xe,cm as et,B as tt}from"./index-CHzD12Eh.js";import{_ as me}from"./VCheckbox-DmONehvd.js";import{u as ot}from"./feeds-Dt6BjYOY.js";import{u as nt}from"./search-BS0At8Rs.js";const at={class:"form-row"},st={class:"form-row"},lt={class:"form-check-label"},ct=j({__name:"AddFeedModal",props:{done:{type:Function,required:!0}},setup(x){const{handleSubmit:$}=ne(),k=r(),u=r(!1);function S(e){u.value=e.target.checked}const m=x,{mutate:w,loading:q,onDone:y}=G({document:Ie}),{value:l,resetField:f,errorMessage:p}=ae("inputValue",se().required());f();function h(){D()}le(async()=>{await ce(),requestAnimationFrame(()=>{setTimeout(()=>{var e;try{document.activeElement&&document.activeElement!==document.body&&document.activeElement.blur(),(e=k.value)==null||e.focus()}catch(i){console.debug("Focus blocked:",i)}},100)})});const C=$(()=>{w({url:l.value??"",fetchContent:u.value})});return y(()=>{var e;(e=m.done)==null||e.call(this),D()}),(e,i)=>{const F=_e,V=me,M=de,I=ue,L=fe;return v(),A(L,{onClose:h},{headline:d(()=>[g(s(e.$t("add_subscription")),1)]),content:d(()=>[c("div",at,[_(F,{ref_key:"inputRef",ref:k,modelValue:n(l),"onUpdate:modelValue":i[0]||(i[0]=E=>re(l)?l.value=E:null),label:e.$t("rss_url"),error:!!n(p),"error-text":n(p)?e.$t(n(p)):"",onKeyup:ie(n(C),["enter"])},null,8,["modelValue","label","error","error-text","onKeyup"])]),c("div",st,[c("label",lt,[_(V,{"touch-target":"wrapper",checked:u.value,onChange:S},null,8,["checked"]),g(" "+s(e.$t("fetch_content_automatically")),1)])])]),actions:d(()=>[_(M,{value:"cancel",onClick:h},{default:d(()=>[g(s(e.$t("cancel")),1)]),_:1}),_(I,{value:"save",loading:n(q),onClick:n(C)},{default:d(()=>[g(s(e.$t("save")),1)]),_:1},8,["loading","onClick"])]),_:1})}}}),dt={class:"form-label"},ut={class:"form-row"},it={class:"form-row"},rt={class:"form-check-label"},_t=j({__name:"FeedModal",props:{data:{type:Object,required:!0}},setup(x){var h,C;const{handleSubmit:$}=ne(),k=r(),u=r(!1);function S(e){u.value=e.target.checked}const m=x,{mutate:w,loading:q,onDone:y}=G({document:De}),{value:l,errorMessage:f}=ae("inputValue",se().required());l.value=((h=m.data)==null?void 0:h.name)??"",u.value=((C=m.data)==null?void 0:C.fetchContent)??!1,(async()=>(await ce(),requestAnimationFrame(()=>{setTimeout(()=>{var e;try{document.activeElement&&document.activeElement!==document.body&&document.activeElement.blur(),(e=k.value)==null||e.focus()}catch(i){console.debug("Focus blocked:",i)}},100)})))();const p=$(()=>{var e;w({id:(e=m.data)==null?void 0:e.id,name:l.value,fetchContent:u.value})});return y(()=>{D()}),(e,i)=>{const F=_e,V=me,M=de,I=ue,L=fe;return v(),A(L,{onClose:n(D)},{headline:d(()=>[g(s(e.$t("update_subscription")),1)]),content:d(()=>{var E;return[c("div",dt,s((E=x.data)==null?void 0:E.url),1),c("div",ut,[_(F,{ref_key:"inputRef",ref:k,modelValue:n(l),"onUpdate:modelValue":i[0]||(i[0]=Q=>re(l)?l.value=Q:null),class:"form-control",label:e.$t("name"),error:!!n(f),"error-text":n(f)?e.$t(n(f)):"",onKeyup:ie(n(p),["enter"])},null,8,["modelValue","label","error","error-text","onKeyup"])]),c("div",it,[c("label",rt,[_(V,{"touch-target":"wrapper",checked:u.value,onChange:S},null,8,["checked"]),g(" "+s(e.$t("fetch_content_automatically")),1)])])]}),actions:d(()=>[_(M,{value:"cancel",onClick:n(D)},{default:d(()=>[g(s(e.$t("cancel")),1)]),_:1},8,["onClick"]),_(I,{value:"save",loading:n(q),onClick:n(p)},{default:d(()=>[g(s(e.$t("save")),1)]),_:1},8,["loading","onClick"])]),_:1},8,["onClose"])}}}),ft={class:"nav"},mt={class:"title"},pt={key:0,class:"count"},vt={class:"title"},ht={key:0,class:"count"},gt=["onClick"],kt={class:"title"},yt={key:0,class:"count"},Ct=["onClick"],Tt=j({__name:"FeedsSidebar",setup(x){const{t:$}=Ae(),k=Qe(),{counter:u}=Re(Be()),{parseQ:S}=nt(),m=Ge({tagIds:[]}),w=r([]),q=[{text:"add_subscription",click:ve},{text:"import_opml_file",click:Ce},{text:"export_opml_file",click:be}],y=r(!1),l=r(""),f=r(""),p=r(!1),h=r(),C=r(new Map),e=r(!1),i=r(),{fetch:F}=Ke({handle:t=>{t&&(u.value.feedEntries=t.total,u.value.feedEntriesToday=t.today,t.feedsCount.forEach(o=>{C.value.set(o.id,o.count)}))},document:He,variables:()=>({})});function V(t){return C.value.get(t)??-1}function M(){var b;const t=X.currentRoute.value,o=Oe(((b=t.query.q)==null?void 0:b.toString())??"");S(m,o),l.value=m.tagIds.length===1?m.tagIds[0]:"",f.value=m.feedId??"",p.value=m.today??!1,p.value?(l.value="",f.value=""):l.value&&f.value&&(l.value=""),F()}M(),Ne(()=>X.currentRoute.value,()=>{M()});const{viewFeed:I,viewAll:L,viewToday:E}=ot(k),{refetch:Q}=Ue({handle:(t,o)=>{o?J($(o),"error"):t&&(w.value=t.feeds)},document:Pe});function pe(t){const o=t.target.files;if(!o)return;const b=new FileReader;b.addEventListener("load",()=>{ke({content:b.result})},!1),b.readAsText(o[0])}function ve(){U(ct,{done:()=>{Q()}})}const{mutate:he,onDone:ge}=G({document:We});ge(t=>{je(t.data.exportFeeds,"application/xml","feeds.xml")});const{mutate:ke,onDone:ye}=G({document:Ye});ye(()=>{J($("imported")),Q()});function Ce(){h.value.value="",h.value.click()}function be(){he()}function $e(t){i.value=t;const o=document.getElementById("feed-"+t.id);document.dispatchEvent(new CustomEvent("dropdown-toggle",{detail:{exclude:o}})),e.value=!0}function Fe(t){U(_t,{data:t})}function Ee(t){U(Xe,{id:t.id,name:t.name,gql:et,typeName:"Feed",done:()=>{tt(k,"/feeds")}})}const z=()=>{F()},O=()=>{F()};return le(()=>{R.on("feed_entries_deleted",z),R.on("feeds_fetched",O)}),ze(()=>{R.off("feed_entries_deleted",z),R.off("feeds_fetched",O)}),(t,o)=>{const b=xe,H=Je,we=qe,P=Se,Ve=Te,Me=Le,W=Ze("tooltip");return v(),A(Me,null,{title:d(()=>[g(s(t.$t("page_title.feeds")),1)]),actions:d(()=>[te((v(),A(H,{id:"add-feed-ref",onClick:o[0]||(o[0]=()=>y.value=!0)},{default:d(()=>[_(b)]),_:1})),[[W,n($)("add_subscription")]])]),body:d(()=>{var Y;return[c("ul",ft,[c("li",{class:K({active:!p.value&&!l.value&&!f.value}),onClick:o[1]||(o[1]=B((...a)=>n(L)&&n(L)(...a),["prevent"]))},[c("span",mt,s(t.$t("all")),1),n(u).feedEntries>=0?(v(),T("span",pt,s(n(u).feedEntries.toLocaleString()),1)):N("",!0)],2),c("li",{class:K({active:p.value}),onClick:o[2]||(o[2]=B((...a)=>n(E)&&n(E)(...a),["prevent"]))},[c("span",vt,s(t.$t("today")),1),n(u).feedEntriesToday>=0?(v(),T("span",ht,s(n(u).feedEntriesToday.toLocaleString()),1)):N("",!0)],2),(v(!0),T(oe,null,ee(w.value,a=>(v(),T("li",{key:a.id,class:K({active:f.value&&a.id===f.value}),onClick:B(Z=>n(I)(a),["stop","prevent"])},[c("span",kt,s(a.name),1),te((v(),A(H,{id:"feed-"+a.id,onClick:B(Z=>$e(a),["prevent","stop"])},{default:d(()=>[_(we)]),_:2},1032,["id","onClick"])),[[W,t.$t("actions")]]),V(a.id)>=0?(v(),T("span",yt,s(V(a.id).toLocaleString()),1)):N("",!0)],10,gt))),128))]),_(P,{modelValue:y.value,"onUpdate:modelValue":o[3]||(o[3]=a=>y.value=a),anchor:"add-feed-ref"},{default:d(()=>[(v(),T(oe,null,ee(q,a=>c("div",{key:a.text,class:"dropdown-item",onClick:Z=>{a.click(),y.value=!1}},s(t.$t(a.text)),9,Ct)),64))]),_:1},8,["modelValue"]),_(P,{modelValue:e.value,"onUpdate:modelValue":o[6]||(o[6]=a=>e.value=a),anchor:"feed-"+((Y=i.value)==null?void 0:Y.id)},{default:d(()=>[c("div",{class:"dropdown-item",onClick:o[4]||(o[4]=a=>{Fe(i.value),e.value=!1})},s(t.$t("edit")),1),c("div",{class:"dropdown-item",onClick:o[5]||(o[5]=a=>{Ee(i.value),e.value=!1})},s(t.$t("delete")),1)]),_:1},8,["modelValue","anchor"]),_(Ve,{type:"FEED_ENTRY",selected:l.value},null,8,["selected"]),c("input",{ref_key:"fileInput",ref:h,style:{display:"none"},accept:".xml",type:"file",onChange:pe},null,544)]}),_:1})}}});export{Tt as default};
