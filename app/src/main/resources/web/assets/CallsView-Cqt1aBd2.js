import{_ as Me}from"./VPagination.vuevuetypescriptsetuptruelang-DR_a4LYu.js";import{_ as Ve,b as Ne,u as Qe,a as Oe}from"./key-events-BbWVt8Hy.js";import{d as R,c as u,M as _,o as n,a,N as Re,t as d,O as w,P as j,I as de,B as y,x as b,j as c,ac as ce,Q as me,u as ue,R as re,k as t,ad as se,T as Fe,U as le,J as U,V as ne,L as pe,e as Ge,s as Ke,f as Ue,r as P,W as je,X as ze,Y as He,i as We,w as Je,Z as Xe,$ as Ye,h as Q,a0 as O,a1 as ae,a2 as Ze,ae as xe,H as et,K as tt,v as st,a4 as lt,D as nt,a5 as oe,a6 as at,af as ot,ag as it,a7 as C,a8 as dt,a9 as ct,ah as mt}from"./index-DZ3IxO2v.js";import{_ as ut}from"./AllCheckedAlert.vuevuetypescriptsetuptruelang-CzZUXFqs.js";import{_ as ge}from"./VCheckbox-BHBPE4Up.js";import{u as rt,a as pt}from"./tags-D55S98RS.js";import{_ as gt}from"./ListItemPhone.vuevuetypescriptsetuptruelang-DrTHKM3L.js";import{_ as _t}from"./FieldId.vuevuetypescriptsetuptruelang-C6gjdM58.js";import{_ as vt}from"./call-outline-rounded-Bo-O1ViI.js";const ht={key:0,class:"call-item selectable-card-skeleton"},ft={class:"start"},yt={class:"number"},kt=R({__name:"CallSkeletonItem",props:{index:{},isPhone:{type:Boolean}},setup(B){return(k,m)=>{const r=Ve;return k.isPhone?(n(),_(r,{key:1,"title-width":"70%",image:!1,subtitles:[{width:"45%"},{width:"30%"}],"action-count":3})):(n(),u("section",ht,[a("div",ft,[m[0]||(m[0]=a("div",{class:"skeleton-checkbox"},null,-1)),a("span",yt,d(k.index),1)]),m[1]||(m[1]=Re('<div class="title"><div class="skeleton-text lg" style="width:160px;"></div></div><div class="subtitle"><div class="skeleton-text" style="width:80px;"></div></div><div class="actions"><div class="skeleton-text lg" style="width:120px;"></div></div><div class="geo"><div class="skeleton-text" style="width:100px;"></div></div><div class="time"><div class="skeleton-text" style="width:60px;"></div></div>',5))]))}}}),It={class:"actions"},ie=R({__name:"CallActionButtons",props:{item:{},callLoading:{type:Boolean},callId:{}},emits:["deleteItem","call","addItemToTags"],setup(B,{emit:k}){const m=B,r=k;function v(){r("deleteItem",m.item)}function L(){r("call",m.item)}function S(){r("addItemToTags",m.item)}return(p,e)=>{const l=ce,g=de,h=vt,I=me,$=j("tooltip");return n(),u("div",It,[w((n(),_(g,{onClick:y(v,["stop"])},{default:b(()=>[c(l)]),_:1})),[[$,p.$t("delete")]]),w((n(),_(g,{loading:p.callLoading&&p.callId===p.item.id,onClick:y(L,["stop"])},{default:b(()=>[c(h)]),_:1},8,["loading"])),[[$,p.$t("make_a_phone_call")]]),w((n(),_(g,{onClick:y(S,["stop"])},{default:b(()=>[c(I)]),_:1})),[[$,p.$t("add_to_tags")]])])}}}),Ct={class:"start"},bt={class:"number"},$t={class:"title"},Tt={class:"subtitle"},wt={class:"geo"},Lt={class:"time"},St={class:"subtitle"},At={class:"geo"},Dt={class:"time"},qt=R({__name:"CallListItem",props:{item:{},index:{},selectedIds:{},shiftEffectingIds:{},shouldSelect:{type:Boolean},isPhone:{type:Boolean},dataType:{},callLoading:{type:Boolean},callId:{},handleItemClick:{type:Function},handleMouseOver:{type:Function},toggleSelect:{type:Function}},emits:["deleteItem","call","addItemToTags"],setup(B,{emit:k}){const{t:m}=ue(),r=k;function v(e){r("deleteItem",e)}function L(e){r("call",e)}function S(e){r("addItemToTags",e)}function p(e){if(!e)return"";const l=[];return e.isp&&l.push(m("phone_isp_type."+e.isp)),e.city===e.province?l.push(e.city):l.push(`${e.province}${e.city}`),l.join(", ")}return(e,l)=>{const g=ge,h=_t,I=Fe,$=gt,M=j("tooltip");return e.isPhone?(n(),_($,{key:1,"is-selected":e.selectedIds.includes(e.item.id),"is-selecting":e.shiftEffectingIds.includes(e.item.id),"checkbox-checked":e.shiftEffectingIds.includes(e.item.id)?e.shouldSelect:e.selectedIds.includes(e.item.id),onClick:l[4]||(l[4]=i=>e.handleItemClick(i,e.item,e.index,()=>{})),onMouseenter:l[5]||(l[5]=y(i=>e.handleMouseOver(i,e.index),["stop"])),onCheckboxClick:l[6]||(l[6]=i=>e.toggleSelect(i,e.item,e.index))},{title:b(()=>[U(d(e.item.name?e.item.name+" "+e.item.number:e.item.number),1)]),subtitle:b(()=>[a("div",St,[a("span",null,d(t(se)(e.item.duration)),1),a("span",null,d(e.$t("call_type."+e.item.type)),1),c(I,{tags:e.item.tags,type:e.dataType,"only-links":!0},null,8,["tags","type"])]),a("div",At,d(p(e.item.geo)),1),a("div",Dt,[w((n(),u("span",null,[U(d(t(ne)(e.item.startedAt)),1)])),[[M,t(le)(e.item.startedAt)]])])]),actions:b(()=>[c(ie,{item:e.item,"call-loading":e.callLoading,"call-id":e.callId,onDeleteItem:v,onCall:L,onAddItemToTags:S},null,8,["item","call-loading","call-id"])]),_:1},8,["is-selected","is-selecting","checkbox-checked"])):(n(),u("section",{key:0,class:re(["call-item selectable-card",{selected:e.selectedIds.includes(e.item.id),selecting:e.shiftEffectingIds.includes(e.item.id)}]),onClick:l[2]||(l[2]=y(i=>e.handleItemClick(i,e.item,e.index,()=>{}),["stop"])),onMouseenter:l[3]||(l[3]=y(i=>e.handleMouseOver(i,e.index),["stop"]))},[a("div",Ct,[e.shiftEffectingIds.includes(e.item.id)?(n(),_(g,{key:0,class:"checkbox","touch-target":"wrapper",checked:e.shouldSelect,onClick:l[0]||(l[0]=y(i=>e.toggleSelect(i,e.item,e.index),["stop"]))},null,8,["checked"])):(n(),_(g,{key:1,class:"checkbox","touch-target":"wrapper",checked:e.selectedIds.includes(e.item.id),onClick:l[1]||(l[1]=y(i=>e.toggleSelect(i,e.item,e.index),["stop"]))},null,8,["checked"])),a("span",bt,[c(h,{id:e.index+1,raw:e.item},null,8,["id","raw"])])]),a("div",$t,d(e.item.name?e.item.name+" "+e.item.number:e.item.number),1),a("div",Tt,[a("span",null,d(t(se)(e.item.duration)),1),a("span",null,d(e.$t("call_type."+e.item.type)),1),c(I,{tags:e.item.tags,type:e.dataType,"only-links":!0},null,8,["tags","type"])]),c(ie,{item:e.item,"call-loading":e.callLoading,"call-id":e.callId,onDeleteItem:v,onCall:L,onAddItemToTags:S},null,8,["item","call-loading","call-id"]),a("div",wt,d(p(e.item.geo)),1),a("div",Lt,[w((n(),u("span",null,[U(d(t(ne)(e.item.startedAt)),1)])),[[M,t(le)(e.item.startedAt)]])])],34))}}}),Et=pe(qt,[["__scopeId","data-v-b29c6d56"]]),Pt={class:"top-app-bar"},Bt={class:"title"},Mt={key:0},Vt={key:1},Nt={class:"scroll-content"},Qt={key:0,class:"no-data-placeholder"},q=50,Ot=R({__name:"CallsView",setup(B){const k=st("isPhone"),m=Ge(),{app:r}=Ke(Ue()),v=P([]),{t:L}=ue(),{parseQ:S}=ct(),p=je({tagIds:[]}),e=ze.CALL,l=lt(),g=P(1),h=P(""),{tags:I,fetch:$}=rt(e),{addToTags:M}=pt(e,I),{deleteItems:i}=Ne(mt,()=>{V(),N(),C.emit("refetch_tags",e),C.emit("calls_deleted")}),{selectedIds:A,allChecked:z,realAllChecked:E,selectRealAll:_e,allCheckedAlertVisible:ve,clearSelection:V,toggleAllChecked:he,toggleSelect:fe,total:f,checked:F,shiftEffectingIds:ye,handleItemClick:ke,handleMouseOver:Ie,selectAll:Ce,shouldSelect:be}=Qe(v),H=s=>{const o=l.query.q;nt(m,o?`/calls?page=${s}&q=${o}`:`/calls?page=${s}`)},{keyDown:W,keyUp:J}=Oe(f,q,g,Ce,V,H,()=>{i(A.value,E.value,f.value,h.value)}),{loading:G,fetch:N}=He({handle:(s,o)=>{o?et(L(o),"error"):s&&(v.value=s.calls,f.value=s.callCount)},document:xe,variables:()=>({offset:(g.value-1)*q,limit:q,query:h.value})});function $e(s){oe(at,{type:e,tags:I.value,item:{key:s.id,title:"",size:0},selected:I.value.filter(o=>s.tags.some(D=>D.id===o.id))})}const X=s=>{s.type===e&&(V(),N())},Y=s=>{s.type===e&&N()},Z=P(""),{mutate:Te,loading:we}=We({document:tt});function Le(s){Z.value=s.id,Te({number:s.number})}function Se(s){oe(it,{id:s.id,name:s.number,gql:ot`
      mutation DeleteCall($query: String!) {
        deleteCalls(query: $query)
      }
    `,variables:()=>({query:`ids:${s.id}`}),typeName:"Call",done:()=>{f.value--,s.tags.length&&C.emit("refetch_tags",e),C.emit("calls_deleted")}})}const K=P(!1);function x(){var o,D;const s=parseInt(((o=l.query.page)==null?void 0:o.toString())??"1");g.value=Number.isFinite(s)&&s>0?s:1,h.value=dt(((D=l.query.q)==null?void 0:D.toString())??""),S(p,h.value),N()}return Je(()=>l.fullPath,()=>{K.value&&x()}),Xe(()=>{$(),K.value=!0,x(),C.on("item_tags_updated",Y),C.on("items_tags_updated",X),window.addEventListener("keydown",W),window.addEventListener("keyup",J)}),Ye(()=>{K.value=!1,C.off("item_tags_updated",Y),C.off("items_tags_updated",X),window.removeEventListener("keydown",W),window.removeEventListener("keyup",J)}),(s,o)=>{const D=ge,Ae=ce,ee=de,De=me,qe=ut,Ee=kt,Pe=Me,te=j("tooltip");return n(),u(O,null,[a("div",Pt,[c(D,{"touch-target":"wrapper",checked:t(z),indeterminate:!t(z)&&t(F),onChange:t(he)},null,8,["checked","indeterminate","onChange"]),a("div",Bt,[t(A).length?(n(),u("span",Mt,d(s.$t("x_selected",{count:t(E)?t(f).toLocaleString():t(A).length.toLocaleString()})),1)):(n(),u("span",Vt,d(s.$t("page_title.calls"))+" ("+d(t(f).toLocaleString())+")",1)),t(F)?(n(),u(O,{key:2},[w((n(),_(ee,{onClick:o[0]||(o[0]=y(T=>t(i)(t(A),t(E),t(f),h.value),["stop"]))},{default:b(()=>[c(Ae)]),_:1})),[[te,s.$t("delete")]]),w((n(),_(ee,{onClick:o[1]||(o[1]=y(T=>t(M)(t(A),t(E),h.value),["stop"]))},{default:b(()=>[c(De)]),_:1})),[[te,s.$t("add_to_tags")]])],64)):Q("",!0)]),o[2]||(o[2]=a("div",{class:"actions"},null,-1))]),c(qe,{limit:q,total:t(f),"all-checked-alert-visible":t(ve),"real-all-checked":t(E),"select-real-all":t(_e),"clear-selection":t(V)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),a("div",Nt,[a("div",{class:re(["main-list",{"select-mode":t(F)}])},[(n(!0),u(O,null,ae(v.value,(T,Be)=>(n(),_(Et,{key:T.id,item:T,index:Be,"selected-ids":t(A),"shift-effecting-ids":t(ye),"should-select":t(be),"is-phone":t(k),"data-type":t(e),"call-loading":t(we),"call-id":Z.value,"handle-item-click":t(ke),"handle-mouse-over":t(Ie),"toggle-select":t(fe),onDeleteItem:Se,onCall:Le,onAddItemToTags:$e},null,8,["item","index","selected-ids","shift-effecting-ids","should-select","is-phone","data-type","call-loading","call-id","handle-item-click","handle-mouse-over","toggle-select"]))),128)),t(G)&&v.value.length===0?(n(),u(O,{key:0},ae(20,T=>c(Ee,{key:T,index:T,"is-phone":t(k)},null,8,["index","is-phone"])),64)):Q("",!0)],2),!t(G)&&v.value.length===0?(n(),u("div",Qt,d(s.$t(t(Ze)(t(G),t(r).permissions,"WRITE_CALL_LOG"))),1)):Q("",!0),t(f)>q?(n(),_(Pe,{key:1,page:g.value,go:H,total:t(f),limit:q},null,8,["page","total"])):Q("",!0)])],64)}}}),Jt=pe(Ot,[["__scopeId","data-v-01c705c2"]]);export{Jt as default};
