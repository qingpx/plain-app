import{_ as We}from"./VPagination.vuevuetypescriptsetuptruelang-B7Sa-dGQ.js";import{_ as Xe,u as Ye,b as Ze,a as xe}from"./key-events-DeJMQ3Gp.js";import{d as B,c as r,M as c,o as n,a as m,N as et,t as k,m as tt,i as j,bt as st,W as G,a7 as I,X as K,bu as ot,u as pe,a0 as N,O as $,P as J,k as t,I as ge,B as g,x as p,j as u,ac as he,aR as _e,aV as ve,Q as fe,R as ye,bv as le,T as nt,U as it,J as U,V as de,h as L,e as at,r as P,Y as lt,bw as dt,w as rt,Z as ut,$ as ct,a1 as mt,bx as pt,a2 as gt,an as ht,by as _t,H as vt,bz as ft,v as yt,a4 as kt,D as re,a5 as ue,a6 as $t,af as Tt,bs as bt,ag as wt,aa as ce,a8 as It,a9 as qt,bA as Ct,L as Lt}from"./index-DK2k7uUz.js";import{_ as Nt}from"./AllCheckedAlert.vuevuetypescriptsetuptruelang-BaeCK0x8.js";import{_ as ke}from"./VCheckbox-ChdySfCx.js";import{u as St,a as Ft}from"./tags-DGia9o9R.js";import{_ as Dt}from"./ListItemPhone.vuevuetypescriptsetuptruelang-QRqCHaZt.js";import{_ as Et}from"./FieldId.vuevuetypescriptsetuptruelang-BCKfQAtO.js";const Mt={key:0,class:"note-item selectable-card-skeleton"},Vt={class:"start"},At={class:"number"},Pt=B({__name:"NoteSkeletonItem",props:{index:{},isPhone:{type:Boolean}},setup(b){return(e,o)=>{const i=Xe;return e.isPhone?(n(),c(i,{key:1,"title-width":"70%",subtitles:[{width:"45%"},{width:"30%"},{width:"40%"}],"action-count":3})):(n(),r("section",Mt,[m("div",Vt,[o[0]||(o[0]=m("div",{class:"skeleton-checkbox"},null,-1)),m("span",At,k(e.index),1)]),o[1]||(o[1]=et('<div class="title"><div class="skeleton-text" style="width:40%;"></div><div class="skeleton-text" style="width:40%;margin-block-start:8px;"></div></div><div class="subtitle"><div class="skeleton-text" style="width:30%;"></div></div><div class="actions"><div class="skeleton-text" style="width:140px;"></div></div><div class="time"><div class="skeleton-text" style="width:60px;"></div></div>',4))]))}}}),Bt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Qt(b,e){return n(),r("svg",Bt,e[0]||(e[0]=[m("path",{fill:"currentColor",d:"M19 17.7v1.8q0 .2.15.35t.35.15t.35-.15t.15-.35v-3q0-.2-.15-.35T19.5 16h-3q-.2 0-.35.15t-.15.35t.15.35t.35.15h1.8l-2.45 2.45q-.15.15-.15.35t.15.35t.35.15t.35-.15zM5 21q-.825 0-1.412-.587T3 19V5q0-.825.588-1.412T5 3h14q.825 0 1.413.588T21 5v5q0 .425-.288.713T20 11t-.712-.288T19 10V5H5v14h5q.425 0 .713.288T11 20t-.288.713T10 21zm0-3v1V5v6.075V11zm2-2q0 .425.288.713T8 17h2.075q.425 0 .713-.288t.287-.712t-.287-.712t-.713-.288H8q-.425 0-.712.288T7 16m0-4q0 .425.288.713T8 13h5q.425 0 .713-.288T14 12t-.288-.712T13 11H8q-.425 0-.712.288T7 12m0-4q0 .425.288.713T8 9h8q.425 0 .713-.288T17 8t-.288-.712T16 7H8q-.425 0-.712.288T7 8m11 15q-2.075 0-3.537-1.463T13 18t1.463-3.537T18 13t3.538 1.463T23 18t-1.463 3.538T18 23"},null,-1)]))}const Rt=tt({name:"material-symbols-export-notes-outline-rounded",render:Qt}),zt=(b,e)=>{const{mutate:o,onDone:i}=j({document:st}),h=G(new Map);return i(a=>{h.delete(a.data.trashNotes),b(),e(),I.emit("refetch_tags",K.NOTE),I.emit("notes_actioned",{action:"trash"})}),{trashLoading(a){return h.get(a)??!1},trash(a){h.set(a,!0),o({query:a})}}},Ot=(b,e)=>{const{mutate:o,onDone:i}=j({document:ot}),h=G(new Map);return i(a=>{h.delete(a.data.restoreNotes),b(),e(),I.emit("refetch_tags",K.NOTE),I.emit("notes_actioned",{action:"restore"})}),{restoreLoading(a){return h.get(a)??!1},restore(a){h.set(a,!0),o({query:a})}}},Ht={class:"actions"},me=B({__name:"NoteActionButtons",props:{item:{},filter:{},deleteItem:{type:Function},addItemToTags:{type:Function},restoreLoading:{type:Function},trashLoading:{type:Function},restore:{type:Function},trash:{type:Function}},setup(b){const{t:e}=pe();return(o,i)=>{const h=he,a=ge,v=_e,f=ve,d=fe,T=J("tooltip");return n(),r("div",Ht,[o.filter.trash?(n(),r(N,{key:0},[$((n(),c(a,{class:"sm",onClick:i[0]||(i[0]=g(_=>o.deleteItem(o.item),["stop","prevent"]))},{default:p(()=>[u(h)]),_:1})),[[T,t(e)("delete")]]),$((n(),c(a,{class:"sm",loading:o.restoreLoading(`ids:${o.item.id}`),onClick:i[1]||(i[1]=g(_=>o.restore(`ids:${o.item.id}`),["stop","prevent"]))},{default:p(()=>[u(v)]),_:1},8,["loading"])),[[T,t(e)("restore")]])],64)):(n(),r(N,{key:1},[$((n(),c(a,{class:"sm",loading:o.trashLoading(`ids:${o.item.id}`),onClick:i[2]||(i[2]=g(_=>o.trash(`ids:${o.item.id}`),["stop","prevent"]))},{default:p(()=>[u(f)]),_:1},8,["loading"])),[[T,t(e)("move_to_trash")]]),$((n(),c(a,{class:"sm",onClick:i[3]||(i[3]=g(_=>o.addItemToTags(o.item),["stop","prevent"]))},{default:p(()=>[u(d)]),_:1})),[[T,t(e)("add_to_tags")]])],64))])}}}),Ut={class:"start"},jt={class:"number"},Gt={class:"title"},Kt={class:"subtitle"},Jt={class:"actions"},Wt={class:"time"},Xt={key:0,class:"subtitle"},Yt={class:"subtitle"},Zt={class:"time"},xt=B({__name:"NoteListItem",props:{item:{},index:{},selectedIds:{},shiftEffectingIds:{},shouldSelect:{type:Boolean},isPhone:{type:Boolean},filter:{},dataType:{},routeId:{},handleItemClick:{type:Function},handleMouseOver:{type:Function},toggleSelect:{type:Function},view:{type:Function},deleteItem:{type:Function},addItemToTags:{type:Function},restoreLoading:{type:Function},trashLoading:{type:Function},restore:{type:Function},trash:{type:Function}},setup(b){return(e,o)=>{const i=ke,h=Et,a=nt,v=Dt,f=J("tooltip");return e.isPhone?(n(),c(v,{key:1,"is-selected":e.selectedIds.includes(e.item.id)||e.item.id==e.routeId,"is-selecting":e.shiftEffectingIds.includes(e.item.id),"checkbox-checked":e.shiftEffectingIds.includes(e.item.id)?e.shouldSelect:e.selectedIds.includes(e.item.id),onClick:o[4]||(o[4]=d=>e.handleItemClick(d,e.item,e.index,()=>e.view(e.item))),onMouseenter:o[5]||(o[5]=g(d=>e.handleMouseOver(d,e.index),["stop"])),onCheckboxClick:o[6]||(o[6]=d=>e.toggleSelect(d,e.item,e.index))},{title:p(()=>[U(k(t(le)(e.item.title.split(`
`)[0].trimStart())||e.$t("meta_no_title")),1)]),subtitle:p(()=>[e.item.tags.length>0?(n(),r("div",Xt,[u(a,{tags:e.item.tags,type:e.dataType,"only-links":!0},null,8,["tags","type"])])):L("",!0),m("div",Yt,[m("span",Zt,k(t(de)(e.item.updatedAt)),1)])]),actions:p(()=>[u(me,{item:e.item,filter:e.filter,"delete-item":e.deleteItem,"add-item-to-tags":e.addItemToTags,"restore-loading":e.restoreLoading,"trash-loading":e.trashLoading,restore:e.restore,trash:e.trash},null,8,["item","filter","delete-item","add-item-to-tags","restore-loading","trash-loading","restore","trash"])]),_:1},8,["is-selected","is-selecting","checkbox-checked"])):(n(),r("section",{key:0,class:ye(["note-item selectable-card",{selected:e.selectedIds.includes(e.item.id)||e.item.id==e.routeId,selecting:e.shiftEffectingIds.includes(e.item.id)}]),onClick:o[2]||(o[2]=g(d=>e.handleItemClick(d,e.item,e.index,()=>e.view(e.item)),["stop","prevent"])),onMouseenter:o[3]||(o[3]=g(d=>e.handleMouseOver(d,e.index),["stop"]))},[m("div",Ut,[e.shiftEffectingIds.includes(e.item.id)?(n(),c(i,{key:0,class:"checkbox","touch-target":"wrapper",checked:e.shouldSelect,onClick:o[0]||(o[0]=g(d=>e.toggleSelect(d,e.item,e.index),["stop"]))},null,8,["checked"])):(n(),c(i,{key:1,class:"checkbox","touch-target":"wrapper",checked:e.selectedIds.includes(e.item.id),onClick:o[1]||(o[1]=g(d=>e.toggleSelect(d,e.item,e.index),["stop"]))},null,8,["checked"])),m("span",jt,[u(h,{id:e.index+1,raw:e.item},null,8,["id","raw"])])]),m("div",Gt,k(t(le)(e.item.title.split(`
`)[0].trimStart())||e.$t("meta_no_title")),1),m("div",Kt,[u(a,{tags:e.item.tags,type:e.dataType,"only-links":!0},null,8,["tags","type"])]),m("div",Jt,[u(me,{item:e.item,filter:e.filter,"delete-item":e.deleteItem,"add-item-to-tags":e.addItemToTags,"restore-loading":e.restoreLoading,"trash-loading":e.trashLoading,restore:e.restore,trash:e.trash},null,8,["item","filter","delete-item","add-item-to-tags","restore-loading","trash-loading","restore","trash"])]),m("div",Wt,[$((n(),r("span",null,[U(k(t(de)(e.item.updatedAt)),1)])),[[f,t(it)(e.item.updatedAt)]])])],34))}}}),es={class:"top-app-bar"},ts={class:"title"},ss={key:0},os={key:1},ns={class:"actions"},is={key:0,class:"scroller main-list"},as=["href"],ls={key:2,class:"no-data-placeholder"},E=50,ds=B({__name:"NotesView",setup(b){const e=yt("isPhone"),o=at(),i=P([]),{t:h}=pe(),{parseQ:a}=qt(),v=G({tagIds:[],trash:!1}),f=K.NOTE,d=kt(),T=P(1),_=P(""),{tags:Q,fetch:$e}=St(f),{selectedIds:q,allChecked:W,realAllChecked:S,selectRealAll:Te,allCheckedAlertVisible:be,clearSelection:C,toggleAllChecked:we,toggleSelect:Ie,total:y,checked:R,shiftEffectingIds:qe,handleItemClick:Ce,handleMouseOver:Le,selectAll:Ne,shouldSelect:Se}=Ye(i),{addToTags:Fe}=Ft(f,Q),X=s=>{const l=d.query.q;re(o,l?`/notes?page=${s}&q=${l}`:`/notes?page=${s}`)},{keyDown:Y,keyUp:Z}=xe(y,E,T,Ne,C,X,()=>{x(q.value,S.value,y.value,_.value)}),{loading:z,fetch:F}=lt({handle:(s,l)=>{l?vt(h(l),"error"):s&&(i.value=s.notes,y.value=s.noteCount)},document:_t,variables:()=>({offset:(T.value-1)*E,limit:E,query:_.value})});function De(s){ue($t,{type:f,tags:Q.value,item:{key:s.id,title:"",size:0},selected:Q.value.filter(l=>s.tags.some(D=>D.id===l.id))})}const{mutate:Ee,onDone:Me}=j({document:ft}),Ve=()=>{Ee({query:A()})},A=()=>{let s=_.value;return S.value||(s=`ids:${q.value.join(",")}`),s};Me(s=>{dt(s.data.exportNotes,"application/json","notes.json")});const{deleteItems:x}=Ze(Ct,()=>{C(),F()});function Ae(s){ue(wt,{id:s.id,name:bt(s.title,{length:20}),gql:Tt`
      mutation DeleteNote($query: String!) {
        deleteNotes(query: $query)
      }
    `,variables:()=>({query:`ids:${s.id}`}),done:()=>{C(),y.value--},typeName:"Note"})}const{trashLoading:Pe,trash:ee}=zt(C,F),{restoreLoading:te,restore:se}=Ot(C,F);function Be(s){re(o,oe(s))}function oe(s){const l=ce.currentRoute.value.query.q;return l?`/notes/${s.id}?q=${l}`:`/notes/${s.id}`}function Qe(){ce.push("/notes/create")}const ne=s=>{s.type===f&&(C(),F())},ie=s=>{s.type===f&&F()},O=P(!1);function ae(){var l,D;const s=parseInt(((l=d.query.page)==null?void 0:l.toString())??"1");T.value=Number.isFinite(s)&&s>0?s:1,_.value=It(((D=d.query.q)==null?void 0:D.toString())??""),a(v,_.value),v.trash===void 0&&(v.trash=!1),F()}return rt(()=>d.fullPath,()=>{O.value&&ae()}),ut(()=>{$e(),O.value=!0,ae(),I.on("item_tags_updated",ie),I.on("items_tags_updated",ne),window.addEventListener("keydown",Y),window.addEventListener("keyup",Z)}),ct(()=>{O.value=!1,I.off("item_tags_updated",ie),I.off("items_tags_updated",ne),window.removeEventListener("keydown",Y),window.removeEventListener("keyup",Z)}),(s,l)=>{const D=ke,Re=he,M=ge,ze=_e,Oe=ve,He=fe,Ue=Rt,je=ht,Ge=Nt,Ke=Pt,Je=We,V=J("tooltip");return n(),r(N,null,[m("div",es,[u(D,{"touch-target":"wrapper",checked:t(W),indeterminate:!t(W)&&t(R),onChange:t(we)},null,8,["checked","indeterminate","onChange"]),m("div",ts,[t(q).length?(n(),r("span",ss,k(s.$t("x_selected",{count:t(S)?t(y).toLocaleString():t(q).length.toLocaleString()})),1)):(n(),r("span",os,k(s.$t("page_title.notes"))+" ("+k(t(y).toLocaleString())+")",1)),t(R)?(n(),r(N,{key:2},[v.trash?(n(),r(N,{key:0},[$((n(),c(M,{onClick:l[0]||(l[0]=g(w=>t(x)(t(q),t(S),t(y),_.value),["stop"]))},{default:p(()=>[u(Re)]),_:1})),[[V,s.$t("delete")]]),$((n(),c(M,{loading:t(te)(A()),onClick:l[1]||(l[1]=g(w=>t(se)(A()),["stop"]))},{default:p(()=>[u(ze)]),_:1},8,["loading"])),[[V,s.$t("restore")]])],64)):(n(),r(N,{key:1},[$((n(),c(M,{onClick:l[2]||(l[2]=g(w=>t(ee)(A()),["stop"]))},{default:p(()=>[u(Oe)]),_:1})),[[V,s.$t("move_to_trash")]]),$((n(),c(M,{onClick:l[3]||(l[3]=g(w=>t(Fe)(t(q),t(S),_.value),["stop"]))},{default:p(()=>[u(He)]),_:1})),[[V,s.$t("add_to_tags")]]),$((n(),c(M,{onClick:g(Ve,["stop"])},{default:p(()=>[u(Ue)]),_:1})),[[V,s.$t("export_notes")]])],64))],64)):L("",!0)]),m("div",ns,[v.trash?L("",!0):(n(),c(je,{key:0,class:"btn-sm",onClick:g(Qe,["prevent"])},{default:p(()=>[U(k(s.$t("create")),1)]),_:1}))])]),u(Ge,{limit:E,total:t(y),"all-checked-alert-visible":t(be),"real-all-checked":t(S),"select-real-all":t(Te),"clear-selection":t(C)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),t(z)&&i.value.length===0?(n(),r("div",is,[(n(),r(N,null,mt(20,w=>u(Ke,{key:w,index:w,"is-phone":t(e)},null,8,["index","is-phone"])),64))])):L("",!0),i.value.length?(n(),c(t(pt),{key:1,class:ye(["scroller main-list",{"select-mode":t(R)}]),"data-key":"id","data-sources":i.value,"estimate-size":100},{item:p(({index:w,item:H})=>[(n(),r("a",{key:H.id,class:"item-link",href:oe(H)},[u(xt,{item:H,index:w,"selected-ids":t(q),"shift-effecting-ids":t(qe),"should-select":t(Se),"is-phone":t(e),filter:v,"data-type":t(f),"route-id":s.$route.params.id,"handle-item-click":t(Ce),"handle-mouse-over":t(Le),"toggle-select":t(Ie),view:Be,"delete-item":Ae,"add-item-to-tags":De,"restore-loading":t(te),"trash-loading":t(Pe),restore:t(se),trash:t(ee)},null,8,["item","index","selected-ids","shift-effecting-ids","should-select","is-phone","filter","data-type","route-id","handle-item-click","handle-mouse-over","toggle-select","restore-loading","trash-loading","restore","trash"])],8,as))]),footer:p(()=>[t(y)>E?(n(),c(Je,{key:0,page:T.value,go:X,total:t(y),limit:E},null,8,["page","total"])):L("",!0)]),_:1},8,["data-sources","class"])):L("",!0),!t(z)&&i.value.length===0?(n(),r("div",ls,k(s.$t(t(gt)(t(z)))),1)):L("",!0)],64)}}}),vs=Lt(ds,[["__scopeId","data-v-4c1ddbce"]]);export{vs as default};
