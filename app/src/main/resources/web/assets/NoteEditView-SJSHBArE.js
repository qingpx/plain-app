import{_ as te}from"./MonacoEditor.vuevuetypescriptsetuptruelang-BIc-sj7B.js";import{_ as ne}from"./print-outline-rounded-Bc6owBaU.js";import{bf as ae,bg as F,bh as oe,m as se,c as U,o as v,a as p,e as ie,f as ue,u as re,r as k,s as le,g as ce,h as de,W as me,i as _e,bi as fe,ae as ve,V as pe,a5 as x,af as ge,L as E,M as he,K as S,q as H,z as Q,H as G,j,t as Te,l as O,aq as be,k as $,Q as ke,Z as P,w as ye,R as we,G as $e,bj as Ce,F as K,bk as Le,bl as Me,N as Ne,a6 as qe,B as xe,a2 as Ee,a3 as Se,bm as Ve,J as Re}from"./index-CvrCHKkA.js";import{_ as Ie}from"./FieldId.vuevuetypescriptsetuptruelang-DKF_OuH8.js";import{u as De}from"./markdown-DHGBPK9q.js";var W=function(){return ae.Date.now()},Be="Expected a function",He=Math.max,Qe=Math.min;function We(L,i,r){var d,a,o,u,s,l,_=0,M=!1,f=!1,g=!0;if(typeof L!="function")throw new TypeError(Be);i=F(i)||0,oe(r)&&(M=!!r.leading,f="maxWait"in r,o=f?He(F(r.maxWait)||0,i):o,g="trailing"in r?!!r.trailing:g);function y(n){var c=d,e=a;return d=a=void 0,_=n,u=L.apply(e,c),u}function N(n){return _=n,s=setTimeout(m,i),M?y(n):u}function V(n){var c=n-l,e=n-_,t=i-c;return f?Qe(t,o-e):t}function h(n){var c=n-l,e=n-_;return l===void 0||c>=i||c<0||f&&e>=o}function m(){var n=W();if(h(n))return q(n);s=setTimeout(m,V(n))}function q(n){return s=void 0,g&&d?y(n):(d=a=void 0,u)}function R(){s!==void 0&&clearTimeout(s),_=0,d=l=a=s=void 0}function I(){return s===void 0?u:q(W())}function w(){var n=W(),c=h(n);if(d=arguments,a=this,l=n,c){if(s===void 0)return N(l);if(f)return clearTimeout(s),s=setTimeout(m,i),y(l)}return s===void 0&&(s=setTimeout(m,i)),u}return w.cancel=R,w.flush=I,w}const Ue={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function ze(L,i){return v(),U("svg",Ue,i[0]||(i[0]=[p("path",{fill:"currentColor",d:"m7.825 13l4.9 4.9q.3.3.288.7t-.313.7q-.3.275-.7.288t-.7-.288l-6.6-6.6q-.15-.15-.213-.325T4.426 12t.063-.375t.212-.325l6.6-6.6q.275-.275.688-.275t.712.275q.3.3.3.713t-.3.712L7.825 11H19q.425 0 .713.288T20 12t-.288.713T19 13z"},null,-1)]))}const Ae=se({name:"material-symbols-arrow-back-rounded",render:ze}),Fe={class:"top-app-bar"},Ge={class:"title"},je={class:"state-point"},Oe={class:"actions"},Pe={class:"panel-container"},Ke=["innerHTML"],C="NOTE",Je=ie({__name:"NoteEditView",setup(L){const i=ue(),{t:r}=re(),d=pe(),a=k(""),o=k(),u=k(""),s=k(""),l=k(!1),{app:_,urlTokenKey:M}=le(ce());function f(){const e=qe.currentRoute.value.query.q;let t="/notes";e&&(t+=`?q=${e}`),xe(i,t)}const{render:g}=De(_,M),y=We(()=>{l.value=!1,q({id:a.value,input:{content:u.value,title:Ve(u.value,{length:250,omission:""})}})},500),N=()=>{ye(u,async e=>{l.value=!0,s.value=await g(e),y()})},V=()=>{window.print()},h=k();de({handle:(e,t)=>{t?K(r(t),"error"):e&&(h.value=e.tags)},document:Ce,variables:{type:C}});const{fetch:m}=me({handle:async(e,t)=>{t?K(r(t),"error"):(o.value=e.note,u.value=e.note.content,s.value=await g(u.value),N())},document:Le,variables:()=>({id:a.value}),options:{fetchPolicy:"no-cache"}}),{mutate:q,onDone:R}=_e({document:Me});R(e=>{var t,T;o.value=e.data.saveNote,!a.value&&((t=o.value)!=null&&t.id)&&(a.value=(T=o.value)==null?void 0:T.id,fe(i,`/notes/${a.value}`))});function I(){var t;const e=(t=o==null?void 0:o.value)==null?void 0:t.updatedAt;return e?`(${r("updated_at")}: ${we(e)})`:""}function w(){var e,t;Ee(Se,{type:C,tags:h.value,item:{key:(e=o.value)==null?void 0:e.id,title:"",size:0},selected:(t=h.value)==null?void 0:t.filter(T=>{var b;return(b=o.value)==null?void 0:b.tags.some(D=>D.id===T.id)})})}const n=e=>{e.type===C&&m()},c=e=>{e.type===C&&m()};return ve(()=>{a.value=d.params.id,a.value==="create"&&(a.value=""),a.value?m():N(),x.on("item_tags_updated",c),x.on("items_tags_updated",n)}),ge(()=>{x.off("item_tags_updated",c),x.off("items_tags_updated",n)}),(e,t)=>{var z,A;const T=Ae,b=$e,D=Ie,J=ke,X=Ne,Z=ne,Y=te,B=he("tooltip");return v(),U(P,null,[p("div",Fe,[E((v(),S(b,{onClick:Q(f,["prevent"])},{default:H(()=>[$(T)]),_:1})),[[B,e.$t("back")]]),p("div",Ge,[G(Te(a.value?O(r)("edit"):O(r)("create"))+" ",1),E(p("span",je,"*",512),[[be,l.value]]),t[1]||(t[1]=G()),(z=o.value)!=null&&z.updatedAt?(v(),S(D,{key:0,id:I(),class:"time",raw:o.value},null,8,["id","raw"])):j("",!0)]),p("div",Oe,[$(J,{tags:(A=o.value)==null?void 0:A.tags,type:C,"only-links":!0},null,8,["tags"]),a.value?(v(),U(P,{key:0},[E((v(),S(b,{onClick:Q(w,["prevent"])},{default:H(()=>[$(X)]),_:1})),[[B,e.$t("add_to_tags")]]),E((v(),S(b,{onClick:Q(V,["prevent"])},{default:H(()=>[$(Z)]),_:1})),[[B,e.$t("print")]])],64)):j("",!0)])]),p("div",Pe,[$(Y,{modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=ee=>u.value=ee),language:"html"},null,8,["modelValue"]),p("div",{class:"md-container",innerHTML:s.value},null,8,Ke)])],64)}}}),nt=Re(Je,[["__scopeId","data-v-2c4e12eb"]]);export{nt as default};
