import{_ as xe}from"./VPagination.vuevuetypescriptsetuptruelang-CwPgzRnc.js";import{_ as et,b as tt,a as st}from"./SearchInput-yOq3VWVw.js";import{a5 as te,e as Q,r as q,c as r,o,Z as F,k as _,L as S,M as W,K as v,q as k,ah as nt,G as ne,$ as se,O as oe,t as i,J as $e,a,d as ot,H as K,ai as lt,aj as it,z as $,a8 as at,ak as be,l as t,n as ge,al as he,R,s as fe,g as dt,am as ct,an as pt,f as ut,u as rt,T as mt,V as _t,ao as gt,U as ht,i as ve,W as ke,X as ft,Y as vt,j as E,p as kt,ap as yt,aq as wt,a0 as $t,B as ye,ar as bt,as as It,F as H,at as Ct,au as St,av as Ut,aw as At,ax as Dt,a4 as Pt}from"./index-BMu8GHeM.js";import{_ as Ie}from"./VCheckbox-DWBGPCja.js";import{_ as Bt,u as Lt,a as Ft}from"./key-events-DYvieyDS.js";import{u as Et}from"./search-CkyBk6nh.js";import{_ as Mt,a as Vt}from"./upload-rounded-CqvGAhg5.js";import{_ as qt}from"./ListItemPhone.vuevuetypescriptsetuptruelang-BGFOlDQm.js";import{_ as Nt}from"./FieldId.vuevuetypescriptsetuptruelang-DsS2BrsR.js";import"./search-rounded-D7zDCqc2.js";const M=y=>{te.emit("tap_phone",y)};function Tt(y,u){const l=y.findIndex(m=>m.id===u);l!==-1&&y.splice(l,1)}const Kt=["onClick"],Qt=Q({__name:"AppsActionButtons",props:{filter:{},types:{},getUrl:{type:Function},showChips:{type:Boolean},isPhone:{type:Boolean},sorting:{type:Boolean},sortItems:{},appSortBy:{}},emits:["install","sort"],setup(y,{emit:u}){const l=u,m=q(!1);function w(){l("install")}function b(d){l("sort",d)}return(d,e)=>{const p=et,U=Mt,I=ne,C=Vt,A=nt,c=W("tooltip");return o(),r(F,null,[_(p,{filter:d.filter,types:d.types,"get-url":d.getUrl,"show-chips":d.showChips,"is-phone":d.isPhone},null,8,["filter","types","get-url","show-chips","is-phone"]),S((o(),v(I,{onClick:w},{default:k(()=>[_(U)]),_:1})),[[c,d.$t("install_app")]]),_(A,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=g=>m.value=g)},{trigger:k(()=>[S((o(),v(I,{loading:d.sorting},{default:k(()=>[_(C)]),_:1},8,["loading"])),[[c,d.$t("sort")]])]),default:k(()=>[(o(!0),r(F,null,se(d.sortItems,g=>(o(),r("div",{key:g.value,class:oe(["dropdown-item",{selected:g.value===d.appSortBy}]),onClick:D=>{b(g.value),m.value=!1}},i(d.$t(g.label)),11,Kt))),128))]),_:1},8,["modelValue"])],64)}}}),zt=$e(Qt,[["__scopeId","data-v-1beb52e9"]]),Gt={key:0,class:"app-item selectable-card-skeleton"},Ot={class:"start"},jt={class:"number"},Rt=Q({__name:"AppSkeletonItem",props:{index:{},isPhone:{type:Boolean}},setup(y){return(u,l)=>{const m=Bt;return u.isPhone?(o(),v(m,{key:1,"title-width":"70%",subtitles:[{width:"45%"},{width:"30%"},{width:"40%"},{width:"40%"}],"action-count":2})):(o(),r("section",Gt,[a("div",Ot,[l[0]||(l[0]=a("div",{class:"skeleton-checkbox"},null,-1)),a("span",jt,i(u.index),1)]),l[1]||(l[1]=ot('<div class="image"><div class="skeleton-image lg"></div></div><div class="title"><div class="skeleton-text lg" style="width:40%;"></div></div><div class="subtitle"><div class="skeleton-text" style="width:55%;"></div></div><div class="actions"><div class="skeleton-text lg" style="width:60px;"></div></div><div class="time"><div class="skeleton-text" style="width:120px;"></div><div class="skeleton-text" style="width:120px;"></div></div>',5))]))}}}),Ht={class:"actions"},we=Q({__name:"AppActionButtons",props:{item:{}},emits:["uninstall","download","cancelUninstall"],setup(y,{emit:u}){const l=u;function m(){l("uninstall")}function w(){l("download")}function b(){l("cancelUninstall")}return(d,e)=>{const p=lt,U=it,I=at,C=ne,A=be,c=W("tooltip");return o(),r("div",Ht,[d.item.isUninstalling?(o(),r(F,{key:0},[S(_(p,{indeterminate:"",class:"sm"},null,512),[[c,d.$t("uninstalling")]]),e[0]||(e[0]=K(" Â ")),_(U,{class:"btn-sm",onClick:$(b,["stop"])},{default:k(()=>[K(i(d.$t("cancel")),1)]),_:1})],64)):(o(),r(F,{key:1},[S((o(),v(C,{class:"sm",onClick:$(m,["stop"])},{default:k(()=>[_(I)]),_:1})),[[c,d.$t("uninstall")]]),S((o(),v(C,{class:"sm",onClick:$(w,["stop"])},{default:k(()=>[_(A)]),_:1})),[[c,d.$t("download")]])],64))])}}}),Wt={class:"start"},Jt={class:"number"},Xt=["src"],Yt={class:"title"},Zt={class:"subtitle"},xt={class:"actions"},es={class:"time"},ts=["src"],ss={class:"subtitle"},ns={class:"subtitle"},os={class:"subtitle"},ls={class:"subtitle"},is=Q({__name:"AppListItem",props:{item:{},index:{},selectedIds:{},shiftEffectingIds:{},shouldSelect:{type:Boolean},isPhone:{type:Boolean},handleItemClick:{type:Function},handleMouseOver:{type:Function},toggleSelect:{type:Function}},emits:["uninstall","download","cancelUninstall"],setup(y,{emit:u}){const l=y,m=u;function w(){m("uninstall",l.item)}function b(){m("download",l.item)}function d(){m("cancelUninstall",l.item)}return(e,p)=>{const U=Ie,I=Nt,C=qt,A=W("tooltip");return e.isPhone?(o(),v(C,{key:1,"is-selected":e.selectedIds.includes(e.item.id),"is-selecting":e.shiftEffectingIds.includes(e.item.id),"checkbox-checked":e.shiftEffectingIds.includes(e.item.id)?e.shouldSelect:e.selectedIds.includes(e.item.id),onClick:p[4]||(p[4]=c=>e.handleItemClick(c,e.item,e.index,()=>{})),onMouseover:p[5]||(p[5]=c=>e.handleMouseOver(c,e.index)),onCheckboxClick:p[6]||(p[6]=c=>e.toggleSelect(c,e.item,e.index))},{image:k(()=>[a("img",{class:"image",src:e.item.icon},null,8,ts)]),title:k(()=>[K(i(e.item.name)+" ("+i(e.item.version)+")",1)]),subtitle:k(()=>[a("div",ss,i(e.item.id),1),a("div",ns,[a("span",null,i(t(ge)(e.item.size)),1),a("span",null,i(e.$t("app_type."+e.item.type)),1)]),a("div",os,i(e.$t("installed_at"))+": "+i(t(R)(e.item.installedAt)),1),a("div",ls,i(e.$t("updated_at"))+": "+i(t(R)(e.item.updatedAt)),1)]),actions:k(()=>[_(we,{item:e.item,"is-phone":e.isPhone,onUninstall:w,onDownload:b,onCancelUninstall:d},null,8,["item","is-phone"])]),_:1},8,["is-selected","is-selecting","checkbox-checked"])):(o(),r("section",{key:0,class:oe(["app-item selectable-card",{selected:e.selectedIds.includes(e.item.id),selecting:e.shiftEffectingIds.includes(e.item.id)}]),onClick:p[2]||(p[2]=$(c=>e.handleItemClick(c,e.item,e.index,()=>{}),["stop"])),onMouseover:p[3]||(p[3]=c=>e.handleMouseOver(c,e.index))},[a("div",Wt,[e.shiftEffectingIds.includes(e.item.id)?(o(),v(U,{key:0,class:"checkbox","touch-target":"wrapper",checked:e.shouldSelect,onClick:p[0]||(p[0]=$(c=>e.toggleSelect(c,e.item,e.index),["stop"]))},null,8,["checked"])):(o(),v(U,{key:1,class:"checkbox","touch-target":"wrapper",checked:e.selectedIds.includes(e.item.id),onClick:p[1]||(p[1]=$(c=>e.toggleSelect(c,e.item,e.index),["stop"]))},null,8,["checked"])),a("span",Jt,[_(I,{id:e.index+1,raw:e.item},null,8,["id","raw"])])]),a("img",{class:"image",width:"50",height:"50",src:e.item.icon},null,8,Xt),a("div",Yt,i(e.item.name)+" ("+i(e.item.version)+")",1),a("div",Zt,[a("span",null,i(e.item.id),1),a("span",null,i(t(ge)(e.item.size)),1),a("span",null,i(e.$t("app_type."+e.item.type)),1)]),a("div",xt,[_(we,{item:e.item,"is-phone":e.isPhone,onUninstall:w,onDownload:b,onCancelUninstall:d},null,8,["item","is-phone"])]),a("div",es,[S((o(),r("span",null,[K(i(e.$t("installed_at"))+": "+i(t(R)(e.item.installedAt)),1)])),[[A,t(he)(e.item.installedAt)]]),S((o(),r("span",null,[K(i(e.$t("updated_at"))+": "+i(t(R)(e.item.updatedAt)),1)])),[[A,t(he)(e.item.updatedAt)]])])],34))}}}),as={class:"top-app-bar"},ds={class:"title"},cs={key:0},ps={key:1},us={key:0,class:"actions"},rs={key:0,class:"no-data-placeholder"},V=50,ms=Q({__name:"AppsView",setup(y){var _e;const u=kt("isPhone"),l=q([]),{app:m,urlTokenKey:w,uploads:b}=fe(dt()),{input:d,upload:e,uploadChanged:p}=ct(b),{dropping:U,fileDragEnter:I,fileDragLeave:C,dropFiles:A}=pt(b),c=ut(),g=q([]),{t:D}=rt(),{appSortBy:z}=fe(c),{parseQ:Ce,buildQ:Se}=Et(),N=mt({tagIds:[]}),Ue=yt(),J=q(!1),le=_t(),ie=le.query,X=q(parseInt(((_e=ie.page)==null?void 0:_e.toString())??"1")),G=q(""),{selectedIds:O,allChecked:ae,realAllChecked:Y,selectRealAll:Ae,allCheckedAlertVisible:De,clearSelection:Z,toggleAllChecked:Pe,toggleSelect:Be,total:B,checked:j,shiftEffectingIds:Le,handleItemClick:Fe,handleMouseOver:Ee,selectAll:Me,shouldSelect:Ve}=Lt(g),{downloadItems:qe}=gt(w,ht.PACKAGE,Z,()=>Dt("apps")),{downloadFile:Ne}=At(w),x=s=>{const n=le.query.q;ye(c,n?`/apps?page=${s}&q=${n}`:`/apps?page=${s}`)},{keyDown:de,keyUp:ce}=Ft(B,V,X,Me,Z,x,()=>{}),Te=()=>{e(m.value.downloadsDir)},{mutate:Ke}=ve({document:bt}),pe=["user","system"].map(s=>({id:s,name:D("app_type."+s)})),Qe=s=>{s.isUninstalling=!1},{loading:ee,fetch:ue}=ke({handle:(s,n)=>{J.value=!1,n?H(D(n),"error"):s&&(g.value=s.packages.map(h=>({...h,isUninstalling:!1,icon:Ct(w.value,"pkgicon://"+h.id)})),B.value=s.packageCount)},document:It,variables:()=>({offset:(X.value-1)*V,limit:V,query:G.value,sortBy:z.value})});function re(s){return s?`/apps?q=${s}`:"/apps"}function ze(s){z.value!==s&&(J.value=!0,z.value=s,x(1))}function Ge(s){Object.assign(N,s);const n=Se(N);ye(c,re(n))}const{mutate:Oe}=ve({document:St});function je(s){s.isUninstalling=!0,M(D("confirm_uninstallation_on_phone")),Oe({id:s.id})}function Re(s){Ne(s.path,`${s.name.replace(" ","")}-${s.id}.apk`)}const{loading:He,fetch:We}=ke({handle:s=>{if(s)for(const n of s.packageStatuses){const h=l.value.find(P=>P.id===n.id);if(h){const P=h.isNew&&n.exist,T=!h.isNew&&n.exist&&h.updatedAt<n.updatedAt;(P||T)&&(l.value=l.value.filter(L=>L.id!==n.id),M(""),P?H(D("app_installation_completed")):H(D("app_upgrade_completed")),ue())}else n.exist||(Tt(g.value,n.id),M(""))}},document:Ut,variables:()=>({ids:[...g.value.filter(s=>s.isUninstalling).map(s=>s.id),...l.value.map(s=>s.id)]})}),me=s=>{s.status==="done"&&Ke({path:s.dir+"/"+s.fileName}).then(n=>{if(M(D("confirm_installation_on_phone")),n&&n.data&&n.data.installPackage){const{packageName:h,updatedAt:P,isNew:T}=n.data.installPackage;h&&(l.value.push({id:h,updatedAt:P,isNew:T}),setTimeout(()=>{l.value.some(L=>L.id===h)&&(l.value=l.value.filter(L=>L.id!==h),M(""))},12e4))}}).catch(n=>{M(""),H(D("app_installation_failed")+": "+n.message,"error")})};function Je(s){A(s,m.value.downloadsDir,n=>n.name.endsWith(".apk"))}return ft(()=>{var s;setInterval(()=>{(g.value.some(n=>n.isUninstalling)||l.value.length>0)&&!He.value&&We()},1e3),G.value=Pt(((s=ie.q)==null?void 0:s.toString())??""),Ce(N,G.value),ue(),te.on("upload_task_done",me),window.addEventListener("keydown",de),window.addEventListener("keyup",ce)}),vt(()=>{te.off("upload_task_done",me),window.removeEventListener("keydown",de),window.removeEventListener("keyup",ce)}),(s,n)=>{const h=Ie,P=be,T=ne,L=st,Xe=xe,Ye=W("tooltip");return o(),r(F,null,[a("div",as,[_(h,{"touch-target":"wrapper",checked:t(ae),indeterminate:!t(ae)&&t(j),onChange:t(Pe)},null,8,["checked","indeterminate","onChange"]),a("div",ds,[t(O).length?(o(),r("span",cs,i(s.$t("x_selected",{count:t(Y)?t(B).toLocaleString():t(O).length.toLocaleString()})),1)):(o(),r("span",ps,i(s.$t("page_title.apps"))+" ("+i(t(B).toLocaleString())+")",1)),t(j)?S((o(),v(T,{key:2,onClick:n[0]||(n[0]=$(f=>t(qe)(t(Y),t(O),G.value),["stop"]))},{default:k(()=>[_(P)]),_:1})),[[Ye,s.$t("download")]]):E("",!0)]),!t(u)||!t(j)?(o(),r("div",us,[_(zt,{filter:N,types:t(pe),"get-url":re,"show-chips":!t(u),"is-phone":t(u),sorting:J.value,"sort-items":t(Ue),"app-sort-by":t(z),onInstall:Te,onSort:ze},null,8,["filter","types","show-chips","is-phone","sorting","sort-items","app-sort-by"])])):E("",!0)]),t(u)?(o(),v(tt,{key:0,class:"mobile-search-filters",filter:N,tags:[],feeds:[],buckets:[],types:t(pe),onFilterChange:Ge},null,8,["filter","types"])):E("",!0),_(L,{limit:V,total:t(B),"all-checked-alert-visible":t(De),"real-all-checked":t(Y),"select-real-all":t(Ae),"clear-selection":t(Z)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),a("div",{class:"scroll-content",onDragover:n[3]||(n[3]=$((...f)=>t(I)&&t(I)(...f),["stop","prevent"]))},[S(a("div",{class:"drag-mask",onDrop:$(Je,["stop","prevent"]),onDragleave:n[1]||(n[1]=$((...f)=>t(C)&&t(C)(...f),["stop","prevent"]))},i(s.$t("release_to_send_files")),545),[[wt,t(U)]]),a("div",{class:oe(["main-list",{"select-mode":t(j)}])},[(o(!0),r(F,null,se(g.value,(f,Ze)=>(o(),v(is,{key:f.id,item:f,index:Ze,"selected-ids":t(O),"shift-effecting-ids":t(Le),"should-select":t(Ve),"is-phone":t(u),"handle-item-click":t(Fe),"handle-mouse-over":t(Ee),"toggle-select":t(Be),onUninstall:je,onDownload:Re,onCancelUninstall:Qe},null,8,["item","index","selected-ids","shift-effecting-ids","should-select","is-phone","handle-item-click","handle-mouse-over","toggle-select"]))),128)),t(ee)&&g.value.length===0?(o(),r(F,{key:0},se(20,f=>_(Rt,{key:f,index:f,"is-phone":t(u)},null,8,["index","is-phone"])),64)):E("",!0)],2),!t(ee)&&g.value.length===0?(o(),r("div",rs,i(s.$t(t($t)(t(ee)))),1)):E("",!0),t(B)>V?(o(),v(Xe,{key:1,page:X.value,go:x,total:t(B),limit:V},null,8,["page","total"])):E("",!0),a("input",{ref_key:"fileInput",ref:d,style:{display:"none"},type:"file",accept:".apk",multiple:"",onChange:n[2]||(n[2]=(...f)=>t(p)&&t(p)(...f))},null,544)],32)],64)}}}),Is=$e(ms,[["__scopeId","data-v-ba4fa49a"]]);export{Is as default};
