import{_ as Ue}from"./VPagination.vuevuetypescriptsetuptruelang-C9ADezde.js";import{_ as Ke,b as Re,u as je,a as ze}from"./key-events-bksEpACg.js";import{e as O,c as p,K as g,o as n,a,d as He,t as i,L as S,M as R,G as me,z as $,q as C,k as d,a8 as re,N as ue,u as pe,O as ge,l as t,a9 as le,Q as We,R as ne,H as K,S as ae,J as _e,f as Je,s as Xe,g as Ye,r as F,T as Ze,U as xe,V as et,W as tt,i as st,X as lt,Y as nt,j as B,Z as N,p as at,$ as oe,a0 as ot,aa as it,F as dt,I as ct,B as ie,a2 as de,a3 as mt,ab as rt,ac as ut,a4 as pt,a5 as b,ad as gt}from"./index-BCT-9m6o.js";import{_ as _t,a as ht,b as ft}from"./SearchInput-CX3GRscs.js";import{_ as he}from"./VCheckbox-DK1bVh_W.js";import{u as vt}from"./search-B4xQo8eu.js";import{u as yt,a as kt}from"./tags-DsE5A2JD.js";import{_ as It}from"./ListItemPhone.vuevuetypescriptsetuptruelang-BVVMF_FZ.js";import{_ as bt}from"./FieldId.vuevuetypescriptsetuptruelang-ClQ92ZnI.js";import{_ as $t}from"./call-outline-rounded-BCHGTj4C.js";import"./search-rounded-BPv3KEVl.js";const Ct={key:0,class:"call-item selectable-card-skeleton"},Tt={class:"start"},wt={class:"number"},St=O({__name:"CallSkeletonItem",props:{index:{},isPhone:{type:Boolean}},setup(M){return(m,c)=>{const _=Ke;return m.isPhone?(n(),g(_,{key:1,"title-width":"70%",image:!1,subtitles:[{width:"45%"},{width:"30%"}],"action-count":3})):(n(),p("section",Ct,[a("div",Tt,[c[0]||(c[0]=a("div",{class:"skeleton-checkbox"},null,-1)),a("span",wt,i(m.index),1)]),c[1]||(c[1]=He('<div class="title"><div class="skeleton-text lg" style="width:160px;"></div></div><div class="subtitle"><div class="skeleton-text" style="width:80px;"></div></div><div class="actions"><div class="skeleton-text lg" style="width:120px;"></div></div><div class="geo"><div class="skeleton-text" style="width:100px;"></div></div><div class="time"><div class="skeleton-text" style="width:60px;"></div></div>',5))]))}}}),Lt={class:"actions"},ce=O({__name:"CallActionButtons",props:{item:{},callLoading:{type:Boolean},callId:{}},emits:["deleteItem","call","addItemToTags"],setup(M,{emit:m}){const c=M,_=m;function f(){_("deleteItem",c.item)}function T(){_("call",c.item)}function L(){_("addItemToTags",c.item)}return(h,e)=>{const l=re,y=me,A=$t,k=ue,r=R("tooltip");return n(),p("div",Lt,[S((n(),g(y,{onClick:$(f,["stop"])},{default:C(()=>[d(l)]),_:1})),[[r,h.$t("delete")]]),S((n(),g(y,{loading:h.callLoading&&h.callId===h.item.id,onClick:$(T,["stop"])},{default:C(()=>[d(A)]),_:1},8,["loading"])),[[r,h.$t("make_a_phone_call")]]),S((n(),g(y,{onClick:$(L,["stop"])},{default:C(()=>[d(k)]),_:1})),[[r,h.$t("add_to_tags")]])])}}}),At={class:"start"},qt={class:"number"},Dt={class:"title"},Et={class:"subtitle"},Bt={class:"geo"},Mt={class:"time"},Pt={class:"subtitle"},Vt={class:"geo"},Ft={class:"time"},Nt=O({__name:"CallListItem",props:{item:{},index:{},selectedIds:{},shiftEffectingIds:{},shouldSelect:{type:Boolean},isPhone:{type:Boolean},dataType:{},callLoading:{type:Boolean},callId:{},handleItemClick:{type:Function},handleMouseOver:{type:Function},toggleSelect:{type:Function}},emits:["deleteItem","call","addItemToTags"],setup(M,{emit:m}){const{t:c}=pe(),_=m;function f(e){_("deleteItem",e)}function T(e){_("call",e)}function L(e){_("addItemToTags",e)}function h(e){if(!e)return"";const l=[];return e.isp&&l.push(c("phone_isp_type."+e.isp)),e.city===e.province?l.push(e.city):l.push(`${e.province}${e.city}`),l.join(", ")}return(e,l)=>{const y=he,A=bt,k=We,r=It,I=R("tooltip");return e.isPhone?(n(),g(r,{key:1,"is-selected":e.selectedIds.includes(e.item.id),"is-selecting":e.shiftEffectingIds.includes(e.item.id),"checkbox-checked":e.shiftEffectingIds.includes(e.item.id)?e.shouldSelect:e.selectedIds.includes(e.item.id),onClick:l[4]||(l[4]=o=>e.handleItemClick(o,e.item,e.index,()=>{})),onMouseover:l[5]||(l[5]=o=>e.handleMouseOver(o,e.index)),onCheckboxClick:l[6]||(l[6]=o=>e.toggleSelect(o,e.item,e.index))},{title:C(()=>[K(i(e.item.name?e.item.name+" "+e.item.number:e.item.number),1)]),subtitle:C(()=>[a("div",Pt,[a("span",null,i(t(le)(e.item.duration)),1),a("span",null,i(e.$t("call_type."+e.item.type)),1),d(k,{tags:e.item.tags,type:e.dataType,"only-links":!0},null,8,["tags","type"])]),a("div",Vt,i(h(e.item.geo)),1),a("div",Ft,[S((n(),p("span",null,[K(i(t(ae)(e.item.startedAt)),1)])),[[I,t(ne)(e.item.startedAt)]])])]),actions:C(()=>[d(ce,{item:e.item,"call-loading":e.callLoading,"call-id":e.callId,onDeleteItem:f,onCall:T,onAddItemToTags:L},null,8,["item","call-loading","call-id"])]),_:1},8,["is-selected","is-selecting","checkbox-checked"])):(n(),p("section",{key:0,class:ge(["call-item selectable-card",{selected:e.selectedIds.includes(e.item.id),selecting:e.shiftEffectingIds.includes(e.item.id)}]),onClick:l[2]||(l[2]=$(o=>e.handleItemClick(o,e.item,e.index,()=>{}),["stop"])),onMouseover:l[3]||(l[3]=o=>e.handleMouseOver(o,e.index))},[a("div",At,[e.shiftEffectingIds.includes(e.item.id)?(n(),g(y,{key:0,class:"checkbox","touch-target":"wrapper",checked:e.shouldSelect,onClick:l[0]||(l[0]=$(o=>e.toggleSelect(o,e.item,e.index),["stop"]))},null,8,["checked"])):(n(),g(y,{key:1,class:"checkbox","touch-target":"wrapper",checked:e.selectedIds.includes(e.item.id),onClick:l[1]||(l[1]=$(o=>e.toggleSelect(o,e.item,e.index),["stop"]))},null,8,["checked"])),a("span",qt,[d(A,{id:e.index+1,raw:e.item},null,8,["id","raw"])])]),a("div",Dt,i(e.item.name?e.item.name+" "+e.item.number:e.item.number),1),a("div",Et,[a("span",null,i(t(le)(e.item.duration)),1),a("span",null,i(e.$t("call_type."+e.item.type)),1),d(k,{tags:e.item.tags,type:e.dataType,"only-links":!0},null,8,["tags","type"])]),d(ce,{item:e.item,"call-loading":e.callLoading,"call-id":e.callId,onDeleteItem:f,onCall:T,onAddItemToTags:L},null,8,["item","call-loading","call-id"]),a("div",Bt,i(h(e.item.geo)),1),a("div",Mt,[S((n(),p("span",null,[K(i(t(ae)(e.item.startedAt)),1)])),[[I,t(ne)(e.item.startedAt)]])])],34))}}}),Ot=_e(Nt,[["__scopeId","data-v-4322ecc8"]]),Qt={class:"top-app-bar"},Gt={class:"title"},Ut={key:0},Kt={key:1},Rt={class:"actions"},jt={class:"scroll-content"},zt={key:0,class:"no-data-placeholder"},D=50,Ht=O({__name:"CallsView",setup(M){var ee;const m=at("isPhone"),c=Je(),{app:_}=Xe(Ye()),f=F([]),{t:T}=pe(),{parseQ:L,buildQ:h}=vt(),e=Ze({tagIds:[]}),l=xe.CALL,y=et(),A=y.query,k=F(parseInt(((ee=A.page)==null?void 0:ee.toString())??"1")),r=F(""),{tags:I,fetch:o}=yt(l),{addToTags:fe}=kt(l,I),{deleteItems:j}=Re(gt,()=>{P(),V(),b.emit("refetch_tags",l),b.emit("calls_deleted")}),{selectedIds:q,allChecked:z,realAllChecked:E,selectRealAll:ve,allCheckedAlertVisible:ye,clearSelection:P,toggleAllChecked:ke,toggleSelect:Ie,total:v,checked:Q,shiftEffectingIds:be,handleItemClick:$e,handleMouseOver:Ce,selectAll:Te,shouldSelect:we}=je(f),H=s=>{const u=y.query.q;ie(c,u?`/calls?page=${s}&q=${u}`:`/calls?page=${s}`)},{keyDown:W,keyUp:J}=ze(v,D,k,Te,P,H,()=>{j(q.value,E.value,v.value,r.value)}),{loading:G,fetch:V}=tt({handle:(s,u)=>{u?dt(T(u),"error"):s&&(f.value=s.calls,v.value=s.callCount)},document:it,variables:()=>({offset:(k.value-1)*D,limit:D,query:r.value})}),Se=["1","2","3"].map(s=>({id:s,name:T("call_type."+s)}));function Le(s){de(mt,{type:l,tags:I.value,item:{key:s.id,title:"",size:0},selected:I.value.filter(u=>s.tags.some(U=>U.id===u.id))})}function X(s){return s?`/calls?q=${s}`:"/calls"}const Y=s=>{s.type===l&&(P(),V())},Z=s=>{s.type===l&&V()},x=F(""),{mutate:Ae,loading:qe}=st({document:ct});function De(s){x.value=s.id,Ae({number:s.number})}function Ee(s){de(ut,{id:s.id,name:s.number,gql:rt`
      mutation DeleteCall($query: String!) {
        deleteCalls(query: $query)
      }
    `,variables:()=>({query:`ids:${s.id}`}),typeName:"Call",done:()=>{v.value--,s.tags.length&&b.emit("refetch_tags",l),b.emit("calls_deleted")}})}function Be(s){Object.assign(e,s),ie(c,X(h(e)))}return lt(()=>{var s;r.value=pt(((s=A.q)==null?void 0:s.toString())??""),L(e,r.value),o(),V(),b.on("item_tags_updated",Z),b.on("items_tags_updated",Y),window.addEventListener("keydown",W),window.addEventListener("keyup",J)}),nt(()=>{b.off("item_tags_updated",Z),b.off("items_tags_updated",Y),window.removeEventListener("keydown",W),window.removeEventListener("keyup",J)}),(s,u)=>{const U=he,Me=re,te=me,Pe=ue,Ve=_t,Fe=ft,Ne=ht,Oe=St,Qe=Ue,se=R("tooltip");return n(),p(N,null,[a("div",Qt,[d(U,{"touch-target":"wrapper",checked:t(z),indeterminate:!t(z)&&t(Q),onChange:t(ke)},null,8,["checked","indeterminate","onChange"]),a("div",Gt,[t(q).length?(n(),p("span",Ut,i(s.$t("x_selected",{count:t(E)?t(v).toLocaleString():t(q).length.toLocaleString()})),1)):(n(),p("span",Kt,i(s.$t("page_title.calls"))+" ("+i(t(v).toLocaleString())+")",1)),t(Q)?(n(),p(N,{key:2},[S((n(),g(te,{onClick:u[0]||(u[0]=$(w=>t(j)(t(q),t(E),t(v),r.value),["stop"]))},{default:C(()=>[d(Me)]),_:1})),[[se,s.$t("delete")]]),S((n(),g(te,{onClick:u[1]||(u[1]=$(w=>t(fe)(t(q),t(E),r.value),["stop"]))},{default:C(()=>[d(Pe)]),_:1})),[[se,s.$t("add_to_tags")]])],64)):B("",!0)]),a("div",Rt,[d(Ve,{filter:e,tags:t(I),types:t(Se),"get-url":X,"show-chips":!t(m),"is-phone":t(m)},null,8,["filter","tags","types","show-chips","is-phone"])]),t(m)?(n(),g(Fe,{key:0,class:"mobile-search-filters",filter:e,tags:t(I),feeds:[],buckets:[],types:[],onFilterChange:Be},null,8,["filter","tags"])):B("",!0)]),d(Ne,{limit:D,total:t(v),"all-checked-alert-visible":t(ye),"real-all-checked":t(E),"select-real-all":t(ve),"clear-selection":t(P)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),a("div",jt,[a("div",{class:ge(["main-list",{"select-mode":t(Q)}])},[(n(!0),p(N,null,oe(f.value,(w,Ge)=>(n(),g(Ot,{key:w.id,item:w,index:Ge,"selected-ids":t(q),"shift-effecting-ids":t(be),"should-select":t(we),"is-phone":t(m),"data-type":t(l),"call-loading":t(qe),"call-id":x.value,"handle-item-click":t($e),"handle-mouse-over":t(Ce),"toggle-select":t(Ie),onDeleteItem:Ee,onCall:De,onAddItemToTags:Le},null,8,["item","index","selected-ids","shift-effecting-ids","should-select","is-phone","data-type","call-loading","call-id","handle-item-click","handle-mouse-over","toggle-select"]))),128)),t(G)&&f.value.length===0?(n(),p(N,{key:0},oe(20,w=>d(Oe,{key:w,index:w,"is-phone":t(m)},null,8,["index","is-phone"])),64)):B("",!0)],2),!t(G)&&f.value.length===0?(n(),p("div",zt,i(s.$t(t(ot)(t(G),t(_).permissions,"WRITE_CALL_LOG"))),1)):B("",!0),t(v)>D?(n(),g(Qe,{key:1,page:k.value,go:H,total:t(v),limit:D},null,8,["page","total"])):B("",!0)])],64)}}}),as=_e(Ht,[["__scopeId","data-v-80b90693"]]);export{as as default};
