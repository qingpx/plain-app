import{d as se,aD as oe,r as k,u as te,aE as re,aF as ie,cK as ae,cL as ce,cM as le,cN as N,cO as M,cP as ue,cQ as de,aa as U,cR as D,c as O,o as E,a as p,h as $,j as T,cS as me,t as y,O as I,au as P,B as we,M as W,cT as fe,y as ve,k as d,z as pe,x as K,c9 as be,an as ge,a0 as he,cU as _e,cV as Ve,cW as ye,A as ke,C as Se,J as F,L as Ae}from"./index-DK2k7uUz.js";function H(s){let o=s;if(typeof o>"u"){if(typeof navigator>"u"||!navigator)return"";o=navigator.userAgent||""}return o.toLowerCase()}function j(s,o){try{return new RegExp(s,"g").exec(o)}catch{return null}}function q(){if(typeof navigator>"u"||!navigator||!navigator.userAgentData)return!1;const o=navigator.userAgentData.brands;return!!(o&&o.length)}function Ee(s,o){const t=j(`(${s})((?:\\/|\\s|:)([0-9|\\.|_]+))`,o);return t?t[3]:""}function R(s){return s.replace(/_/g,".")}function A(s,o){let t=null,e="-1";return s.some(r=>{const c=j(`(${r.test})((?:\\/|\\s|:)([0-9|\\.|_]+))?`,o);return!c||r.brand?!1:(t=r,e=c[3]||"-1",r.versionAlias?e=r.versionAlias:r.versionTest&&(e=Ee(r.versionTest.toLowerCase(),o)||e),e=R(e),!0)}),{preset:t,version:e}}function S(s,o){const t={brand:"",version:"-1"};return s.some(e=>{const r=z(o,e);return r?(t.brand=e.id,t.version=e.versionAlias||r.version,t.version!=="-1"):!1}),t}function z(s,o){return s.find(t=>j(`${o.test}`,t.brand.toLowerCase()))}const L=[{test:"phantomjs",id:"phantomjs"},{test:"whale",id:"whale"},{test:"edgios|edge|edg",id:"edge"},{test:"msie|trident|windows phone",id:"ie",versionTest:"iemobile|msie|rv"},{test:"miuibrowser",id:"miui browser"},{test:"samsungbrowser",id:"samsung internet"},{test:"samsung",id:"samsung internet",versionTest:"version"},{test:"chrome|crios",id:"chrome"},{test:"firefox|fxios",id:"firefox"},{test:"android",id:"android browser",versionTest:"version"},{test:"safari|iphone|ipad|ipod",id:"safari",versionTest:"version"}],J=[{test:"(?=.*applewebkit/(53[0-7]|5[0-2]|[0-4]))(?=.*\\schrome)",id:"chrome",versionTest:"chrome"},{test:"chromium",id:"chrome"},{test:"whale",id:"chrome",versionAlias:"-1",brand:!0}],C=[{test:"applewebkit",id:"webkit",versionTest:"applewebkit|safari"}],G=[{test:"(?=(iphone|ipad))(?!(.*version))",id:"webview"},{test:"(?=(android|iphone|ipad))(?=.*(naver|daum|; wv))",id:"webview"},{test:"webview",id:"webview"}],Q=[{test:"windows phone",id:"windows phone"},{test:"windows 2000",id:"window",versionAlias:"5.0"},{test:"windows nt",id:"window"},{test:"win32|windows",id:"window"},{test:"iphone|ipad|ipod",id:"ios",versionTest:"iphone os|cpu os"},{test:"macos|macintel|mac os x",id:"mac"},{test:"android|linux armv81",id:"android"},{test:"tizen",id:"tizen"},{test:"webos|web0s",id:"webos"}];function X(s){return!!A(G,s).preset}function Te(s){const o=H(s),t=!!/mobi/g.exec(o),e={name:"unknown",version:"-1",majorVersion:-1,webview:X(o),chromium:!1,chromiumVersion:"-1",webkit:!1,webkitVersion:"-1"},r={name:"unknown",version:"-1",majorVersion:-1},{preset:c,version:w}=A(L,o),{preset:n,version:l}=A(Q,o),h=A(J,o);if(e.chromium=!!h.preset,e.chromiumVersion=h.version,!e.chromium){const m=A(C,o);e.webkit=!!m.preset,e.webkitVersion=m.version}return n&&(r.name=n.id,r.version=l,r.majorVersion=parseInt(l,10)),c&&(e.name=c.id,e.version=w,e.webview&&r.name==="ios"&&e.name!=="safari"&&(e.webview=!1)),e.majorVersion=parseInt(e.version,10),{browser:e,os:r,isMobile:t,isHints:!1}}function Y(s){const o=navigator.userAgentData,t=[...o.brands],e=s&&s.fullVersionList,r=o.mobile||!1,c=t[0],w=(s&&s.platform||o.platform||navigator.platform).toLowerCase(),n={name:c.brand,version:c.version,majorVersion:-1,webkit:!1,webkitVersion:"-1",chromium:!1,chromiumVersion:"-1",webview:!!S(G,t).brand||X(H())},l={name:"unknown",version:"-1",majorVersion:-1};n.webkit=!n.chromium&&C.some(a=>z(t,a));const h=S(J,t);if(n.chromium=!!h.brand,n.chromiumVersion=h.version,!n.chromium){const a=S(C,t);n.webkit=!!a.brand,n.webkitVersion=a.version}const m=Q.find(a=>new RegExp(`${a.test}`,"g").exec(w));if(l.name=m?m.id:"",s&&(l.version=s.platformVersion),e&&e.length){const a=S(L,e);n.name=a.brand||n.name,n.version=a.version||n.version}else{const a=S(L,t);n.name=a.brand||n.name,n.version=a.brand&&s?s.uaFullVersion:a.version}return n.webkit&&(l.name=r?"ios":"mac"),l.name==="ios"&&n.webview&&(n.version="-1"),l.version=R(l.version),n.version=R(n.version),l.majorVersion=parseInt(l.version,10),n.majorVersion=parseInt(n.version,10),{browser:n,os:l,isMobile:r,isHints:!0}}async function Be(){if(q()){const s=await navigator.userAgentData.getHighEntropyValues(["architecture","model","platform","platformVersion","uaFullVersion","fullVersionList"]);return Y(s)}return xe()}function xe(s){return q()?Y():Te(s)}const $e={class:"header"},Ie={class:"login-block"},Pe={class:"alert alert-danger show",role:"alert"},Re={class:"body"},Le={class:"tap-phone"},Ce={class:"tap-phone-text"},je={key:0,class:"tips"},Ne=se({__name:"LoginView",setup(s){const{handleSubmit:o,isSubmitting:t}=oe(),e=k(!1),r=k(!0),c=k(!1),w=k("");let n;const l=window.location.protocol==="http:"?!1:!window.navigator.userAgentData,{t:h}=te(),{value:m,errorMessage:a}=re("password",ie().required()),B=k(!1);async function Z(){var v;const u=localStorage.getItem("auth_token")??"",f={method:"POST",headers:_e()};if(u){const V=Ve(),g=ye(u),ne=N(g,V);f.body=M(ne)}const b=await fetch(`${D()}/init`,f);if(b.status===403){e.value=!0,r.value=!0,w.value="web_access_disabled";return}r.value=!1;const _=await b.text();if(b.status===200&&u&&!_){window.location.href=((v=U.currentRoute.value.query.redirect)==null?void 0:v.toString())??"/";return}const i=_;i?(m.value=i,B.value=!1):B.value=!0}Z();const x=o(async()=>{const u=localStorage.getItem("client_id");n=new WebSocket(`${ae()}?cid=${u}&auth=1`);const f=m.value??"",b=ce(f),_=le(b);w.value="",e.value=!1,n.onopen=async()=>{t.value=!0;const i=await Be(),v=N(_,JSON.stringify({password:b,browserName:i.browser.name,browserVersion:i.browser.version,osName:i.os.name,osVersion:i.os.version,isMobile:i.isMobile}));n.send(M(v))},n.onmessage=async i=>{var g;const v=ue(_,de(await i.data.arrayBuffer())),V=JSON.parse(v);V.status==="PENDING"?c.value=!0:(localStorage.setItem("auth_token",V.token),n.close(),window.location.href=((g=U.currentRoute.value.query.redirect)==null?void 0:g.toString())??"/")},n.onclose=async i=>{if(!(i.reason==="abort"||i.reason==="OK")){if(t.value=!1,e.value=!0,c.value=!1,!i.reason&&(await fetch(`${D()}/health_check`)).status===200){w.value="failed_connect_ws";return}w.value=`login.${i.reason?i.reason:"failed"}`}},window.setTimeout(function(){n.readyState!==1&&n.close(3001,"timeout")},2e3)});function ee(){c.value=!1,e.value=!1,t.value=!1,n.close(3001,"abort")}return(u,f)=>{const b=me,_=fe,i=ke,v=Se,V=ge;return E(),O(he,null,[p("header",$e,[T(b,{"logged-in":!1})]),p("h1",null,y(u.$t("app_name")),1),p("div",Ie,[I(p("form",{onSubmit:f[1]||(f[1]=we((...g)=>d(x)&&d(x)(...g),["prevent"]))},[I(p("div",Pe,[T(_),p("div",Re,y(w.value?u.$t(w.value):""),1)],512),[[P,e.value]]),B.value?(E(),W(i,{key:0,modelValue:d(m),"onUpdate:modelValue":f[0]||(f[0]=g=>pe(m)?m.value=g:null),label:d(h)("password"),type:"password",class:"form-control",error:d(a),autocomplete:"current-password","error-text":d(a)?u.$t(d(a)):"",onKeydown:ve(d(x),["enter"])},null,8,["modelValue","label","error","error-text","onKeydown"])):$("",!0),r.value?$("",!0):(E(),W(v,{key:1,disabled:d(t),loading:d(t)},{default:K(()=>[F(y(u.$t(d(t)?"logging_in":"log_in")),1)]),_:1},8,["disabled","loading"]))],544),[[P,!c.value]]),I(p("div",null,[p("div",Le,[T(d(be))]),p("div",Ce,y(u.$t("login.to_continue")),1),T(V,{onClick:ee},{default:K(()=>[F(y(u.$t("cancel")),1)]),_:1})],512),[[P,c.value]])]),d(l)?(E(),O("div",je,y(u.$t("browser_warning")),1)):$("",!0)],64)}}}),Ue=Ae(Ne,[["__scopeId","data-v-e7054d80"]]);export{Ue as default};
