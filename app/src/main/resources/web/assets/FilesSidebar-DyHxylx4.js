import{_ as A}from"./LeftSidebar.vuevuetypescriptsetuptruelang-DbEpnYs1.js";import{_ as L}from"./VDropdownMenu-CiRCvjti.js";import{e as G,f as I,s as O,g as Q,u as W,T as z,r as d,i as H,aT as U,bW as j,w as K,K as C,o as p,q as f,a6 as S,a4 as X,bE as Z,bX as J,a5 as Y,a as _,k as b,c as D,$ as ee,z as E,O as te,L as ae,j as oe,t as m,M as se,G as re,Z as le,H as ne,F as $,C as ie,B as T,D as ue,V as ce}from"./index-CvrCHKkA.js";import{_ as he}from"./more-vert-BqhhPS58.js";const ve={class:"nav"},de=["onClick"],pe={class:"title"},ke=G({__name:"FilesSidebar",setup(fe){ce();const g=I(),{app:e}=O(Q()),{t:r}=W(),{parseQ:x}=Z(),F=z({showHidden:!1,type:"",rootPath:"",text:"",parent:""}),k=d(""),h=d(!1),v=d(!1),P=d(null);function R(){T(g,"/files/recent")}function w(a){P.value=a;const s=document.getElementById("favorite-"+a.fullPath);document.dispatchEvent(new CustomEvent("dropdown-toggle",{detail:{exclude:s}})),v.value=!0}const{mutate:B,loading:Pe}=H({document:J,options:{update:()=>{Y.emit("refetch_app")}}});function M(a){B({fullPath:a.fullPath}).then(()=>{$(r("removed"))}).catch(s=>{console.error("Error removing favorite folder:",s),$(r("error"),"error")})}const N=U(()=>{const a=t=>{var i;const c=[e.value.internalStoragePath,e.value.externalFilesDir,...e.value.sdcardPath?[e.value.sdcardPath]:[],...e.value.usbDiskPaths,...((i=e.value.favoriteFolders)==null?void 0:i.map(o=>o.fullPath))||[]];let n="";return c.forEach(o=>{t.startsWith(o)&&o.length>n.length&&(n=o)}),n},s=t=>{const c=(()=>{if(t.rootPath===e.value.internalStoragePath)return r("internal_storage");if(t.rootPath===e.value.externalFilesDir)return r("app_data");if(t.rootPath===e.value.sdcardPath)return r("sdcard");const i=e.value.usbDiskPaths.indexOf(t.rootPath);return i!==-1?`${r("usb_storage")} ${i+1}`:t.rootPath})(),n=t.fullPath.startsWith(t.rootPath)?t.fullPath.substring(t.rootPath.length).replace(/^\//,""):t.fullPath.split("/").pop()||"";return n?`${c}/${n}`:c},l=h.value?"":a(k.value),u=[];return u.push({rootPath:"",fullPath:"",type:"RECENTS",title:r("recents"),isChecked:h.value,isFavoriteFolder:!1}),u.push({rootPath:e.value.internalStoragePath,fullPath:e.value.internalStoragePath,type:"INTERNAL_STORAGE",title:r("internal_storage"),isChecked:l===e.value.internalStoragePath,isFavoriteFolder:!1}),e.value.sdcardPath&&u.push({rootPath:e.value.sdcardPath,fullPath:e.value.sdcardPath,type:"SDCARD",title:r("sdcard"),isChecked:l===e.value.sdcardPath,isFavoriteFolder:!1}),e.value.usbDiskPaths.forEach((t,c)=>{u.push({rootPath:t,fullPath:t,type:"USB_STORAGE",title:`${r("usb_storage")} ${c+1}`,isChecked:l===t,isFavoriteFolder:!1})}),u.push({rootPath:e.value.externalFilesDir,fullPath:e.value.externalFilesDir,type:"APP",title:r("app_data"),isChecked:l===e.value.externalFilesDir,isFavoriteFolder:!1}),e.value.favoriteFolders&&e.value.favoriteFolders.length>0&&e.value.favoriteFolders.forEach((t,c)=>{const n=s(t),i=j(t.rootPath,{internalStoragePath:e.value.internalStoragePath,externalFilesDir:e.value.externalFilesDir,sdcardPath:e.value.sdcardPath,usbDiskPaths:e.value.usbDiskPaths});u.push({rootPath:t.rootPath,fullPath:t.fullPath,type:i,title:n,isChecked:l===t.fullPath,isFavoriteFolder:!0})}),u});function V(a){if(a.type==="RECENTS"){R();return}const s=ie([{name:"parent",op:"",value:a.fullPath},{name:"type",op:"",value:a.type},{name:"root_path",op:"",value:a.rootPath}]);T(g,`/files?q=${ue(s)}`)}function y(){var l;const a=S.currentRoute.value;if(a.path==="/files/recent"){h.value=!0;return}h.value=!1;const s=X(((l=a.query.q)==null?void 0:l.toString())??"");x(F,s),k.value=F.parent}return y(),K(()=>S.currentRoute.value.fullPath,()=>{y()}),(a,s)=>{const l=he,u=re,t=L,c=A,n=se("tooltip");return p(),C(c,null,{title:f(()=>[ne(m(a.$t("page_title.files")),1)]),body:f(()=>{var i;return[_("ul",ve,[(p(!0),D(le,null,ee(N.value,o=>(p(),D("li",{key:o.fullPath,class:te({active:o.isChecked}),onClick:E(q=>V(o),["prevent"])},[_("span",pe,m(o.title),1),o.isFavoriteFolder?ae((p(),C(u,{key:0,id:"favorite-"+o.fullPath,class:"sm",onClick:E(q=>w(o),["prevent","stop"])},{default:f(()=>[b(l)]),_:2},1032,["id","onClick"])),[[n,a.$t("actions")]]):oe("",!0)],10,de))),128))]),b(t,{modelValue:v.value,"onUpdate:modelValue":s[1]||(s[1]=o=>v.value=o),anchor:"favorite-"+((i=P.value)==null?void 0:i.fullPath)},{default:f(()=>[_("div",{class:"dropdown-item",onClick:s[0]||(s[0]=o=>{M(P.value),v.value=!1})},m(a.$t("remove_from_favorites")),1)]),_:1},8,["modelValue","anchor"])]}),_:1})}}});export{ke as default};
